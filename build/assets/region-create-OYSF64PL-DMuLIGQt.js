import{u as $,a as G,b as Q}from"./chunk-NOAFLTPV-B2feSq4-.js";import{f as U}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{m as Z,j as e,r as w,u as J,t as C,bW as P,g as K,H as Y,T as p,I as ee}from"./index-DQ7iaOIo.js";import{S as b}from"./chunk-6WYMDHSN-0x6WvE4o.js";import{C as se}from"./chunk-UY4EBCIZ-BkMu1ycI.js";import{c as re}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{u as ie,D as te}from"./chunk-MOFW5DA3-BBRzwwAr.js";import"./lodash-BbEdBw2P.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{c as oe}from"./chunk-TAOSOO55-C3xZaLGt.js";import{R as j,u as ne}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as ae,a as le,F as i}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{b as ce}from"./chunk-QHCOJC4V-B0UJ2So3.js";import{t as de}from"./zod-DqtdDTUb.js";import{o as T,s as h,b as I,a as k}from"./index-yuYasa5Y.js";import{X as me}from"./x-mark-mini-DjxzaqmQ.js";import{B as f}from"./label-DsyTUQgE.js";import{S as g}from"./select-CYzOnLAx.js";import{S as z}from"./switch-CHhgpYt_.js";import{C as E}from"./checkbox-BXdKf1Kl.js";import{c as ue}from"./index-DW7vLJga.js";import"./chunk-C76H5USB-BzcnRuay.js";import"./triangles-mini-BMU6OfpM.js";import"./plus-mini-DfhjBeEB.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./format-CJ2FegFx.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./triangle-left-mini-o3U9ykef.js";import"./prompt-BKfKBHyN.js";import"./index-CIxKSFC7.js";var xe=T({name:h().min(1),currency_code:h().min(2,"Select a currency"),automatic_taxes:I(),is_tax_inclusive:I(),countries:k(T({code:h(),name:h()})),payment_providers:k(h()).min(1)}),_="cr",S=50,pe=({currencies:n,paymentProviders:o})=>{const[m,d]=w.useState(!1),[x,u]=w.useState({}),{handleSuccess:y}=ne(),c=ae({defaultValues:{name:"",currency_code:"",automatic_taxes:!0,is_tax_inclusive:!1,countries:[],payment_providers:[]},resolver:de(xe)}),v=le({control:c.control,name:"countries",defaultValue:[]}),{t}=J(),{mutateAsync:F,isPending:H}=ce(),M=c.handleSubmit(async s=>{await F({name:s.name,countries:s.countries.map(r=>r.code),currency_code:s.currency_code,payment_providers:s.payment_providers,automatic_taxes:s.automatic_taxes,is_tax_inclusive:s.is_tax_inclusive},{onError:r=>{C.error(t("general.error"),{description:r.message,dismissLabel:t("actions.close")})},onSuccess:({region:r})=>{C.success(t("regions.toast.create")),y(`../${r.id}`)},onError:r=>{C.error(r.message)}})}),{searchParams:L,raw:V}=$({pageSize:S,prefix:_}),{countries:D,count:N}=G({countries:P.map((s,r)=>({display_name:s.display_name,name:s.name,id:r,iso_2:s.iso_2,iso_3:s.iso_3,num_code:s.num_code,region_id:null,region:{}})),...L}),R=fe(),{table:A}=ie({data:D||[],columns:R,count:N,enablePagination:!0,enableRowSelection:!0,rowSelection:{state:x,updater:u},getRowId:s=>s.iso_2,pageSize:S,prefix:_}),B=()=>{const s=Object.keys(x).filter(r=>x[r]);c.setValue("countries",s.map(r=>({code:r,name:P.find(a=>a.iso_2===r).display_name})),{shouldDirty:!0,shouldTouch:!0}),d(!1)},O=s=>{if(d(s),!s){const r=v.reduce((a,l)=>(a[l.code]=!0,a),{});requestAnimationFrame(()=>{u(r)})}},X=s=>{const r=v.filter(l=>l.code!==s),a=r.map(l=>l.code).reduce((l,W)=>(l[W]=!0,l),{});c.setValue("countries",r,{shouldDirty:!0,shouldTouch:!0}),u(a)},q=()=>{c.setValue("countries",[],{shouldDirty:!0,shouldTouch:!0}),u({})};return e.jsx(j.Form,{form:c,children:e.jsxs("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:M,children:[e.jsx(j.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(j.Close,{asChild:!0,children:e.jsx(f,{size:"small",variant:"secondary",children:t("actions.cancel")})}),e.jsx(f,{size:"small",type:"submit",isLoading:H,children:t("actions.save")})]})}),e.jsx(j.Body,{className:"flex overflow-hidden",children:e.jsxs(b,{open:m,onOpenChange:O,children:[e.jsx(b.Content,{children:e.jsx("div",{className:K("flex h-full w-full flex-col items-center overflow-y-auto p-16"),id:"form-section",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsxs("div",{children:[e.jsx(Y,{children:t("regions.createRegion")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:t("regions.createRegionHint")})]}),e.jsx("div",{className:"flex flex-col gap-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(i.Field,{control:c.control,name:"name",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:t("fields.name")}),e.jsx(i.Control,{children:e.jsx(ee,{...s})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:c.control,name:"currency_code",render:({field:{onChange:s,ref:r,...a}})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:t("fields.currency")}),e.jsx(i.Control,{children:e.jsxs(g,{...a,onValueChange:s,children:[e.jsx(g.Trigger,{ref:r,children:e.jsx(g.Value,{})}),e.jsx(g.Content,{children:n.map(l=>e.jsx(g.Item,{value:l.code,children:l.name},l.code))})]})}),e.jsx(i.ErrorMessage,{})]})})]})}),e.jsx(i.Field,{control:c.control,name:"automatic_taxes",render:({field:{value:s,onChange:r,...a}})=>e.jsx(i.Item,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(i.Label,{children:t("fields.automaticTaxes")}),e.jsx(i.Control,{children:e.jsx(z,{...a,checked:s,onCheckedChange:r})})]}),e.jsx(i.Hint,{children:t("regions.automaticTaxesHint")}),e.jsx(i.ErrorMessage,{})]})})}),e.jsx(i.Field,{control:c.control,name:"is_tax_inclusive",render:({field:{value:s,onChange:r,...a}})=>e.jsx(i.Item,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(i.Label,{children:t("fields.taxInclusivePricing")}),e.jsx(i.Control,{children:e.jsx(z,{...a,checked:s,onCheckedChange:r})})]}),e.jsx(i.Hint,{children:t("regions.taxInclusiveHint")}),e.jsx(i.ErrorMessage,{})]})})}),e.jsx("div",{className:"bg-ui-border-base h-px w-full"}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:t("fields.countries")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:t("regions.countriesHint")})]}),v.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[v.map(s=>e.jsx(ge,{country:s,onRemove:X},s.code)),e.jsx(f,{variant:"transparent",size:"small",className:"text-ui-fg-muted hover:text-ui-fg-subtle",onClick:q,children:t("actions.clearAll")})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(f,{variant:"secondary",size:"small",onClick:()=>d(!0),type:"button",children:t("regions.addCountries")})})]}),e.jsx("div",{className:"bg-ui-border-base h-px w-full"}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:t("fields.providers")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:t("regions.providersHint")})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:e.jsx(i.Field,{control:c.control,name:"payment_providers",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:t("fields.paymentProviders")}),e.jsx(i.Control,{children:e.jsx(se,{options:o.map(r=>({label:U(r.id),value:r.id})),...s})}),e.jsx(i.ErrorMessage,{})]})})})]})]})})}),e.jsx(b.Drawer,{children:e.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[e.jsx(te,{table:A,columns:R,count:N,pageSize:S,orderBy:["name","code"],pagination:!0,search:!0,layout:"fill",queryObject:V,prefix:_}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2 border-t p-4",children:[e.jsx(b.Close,{type:"button",children:t("actions.cancel")}),e.jsx(f,{size:"small",type:"button",onClick:B,children:t("actions.save")})]})]})})]})})]})})},he=ue(),fe=()=>{const n=Q();return w.useMemo(()=>[he.display({id:"select",header:({table:o})=>e.jsx(E,{checked:o.getIsSomePageRowsSelected()?"indeterminate":o.getIsAllPageRowsSelected(),onCheckedChange:m=>o.toggleAllPageRowsSelected(!!m)}),cell:({row:o})=>{const m=!o.getCanSelect();return e.jsx(E,{checked:o.getIsSelected()||m,disabled:m,onCheckedChange:d=>o.toggleSelected(!!d),onClick:d=>{d.stopPropagation()}})}}),...n],[n])},ge=({country:n,onRemove:o})=>e.jsxs("div",{className:"bg-ui-bg-field shadow-borders-base transition-fg hover:bg-ui-bg-field-hover flex h-7 items-center overflow-hidden rounded-md",children:[e.jsx("div",{className:"txt-compact-small-plus flex h-full select-none items-center justify-center px-2 py-0.5",children:n.name}),e.jsx("button",{type:"button",onClick:()=>o(n.code),className:"focus-visible:bg-ui-bg-field-hover transition-fg hover:bg-ui-bg-field-hover flex h-full w-7 items-center justify-center border-l outline-none",children:e.jsx(me,{className:"text-ui-fg-muted"})})]}),is=()=>{const{store:n,isPending:o,isError:m,error:d}=Z(),x=((n==null?void 0:n.supported_currencies)??[]).map(y=>re[y.currency_code.toUpperCase()]),{payment_providers:u=[]}=oe();if(m)throw d;return e.jsx(j,{children:!o&&n&&e.jsx(pe,{currencies:x,paymentProviders:u})})};export{is as Component};
