import{g as $}from"./chunk-VZRDVNEY-twUt44Gw.js";import{D as z,c as B}from"./chunk-FUHEDN6F-DJm8RBCj.js";import{c as D}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{R as m,u as C}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as H,a as R}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{w as W,j as e,u as S,r as E,m as G,o as k}from"./index-DQ7iaOIo.js";import{u as F}from"./chunk-QHCOJC4V-B0UJ2So3.js";import{f as L,k as U}from"./chunk-4N7PLYUW-DRfoew5M.js";import{t as q}from"./zod-DqtdDTUb.js";import{o as P,a as A,r as J,s as w,n as K}from"./index-yuYasa5Y.js";import{B as N}from"./label-DsyTUQgE.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./index.esm-C23H4hs_.js";import"./chunk-GH77ZQI2-CyzKiLW4.js";import"./index-DW7vLJga.js";import"./index-LtR7LJbL.js";import"./prompt-BKfKBHyN.js";import"./chunk-DMYZ6SLX-CvGU_oYL.js";var O=({children:r})=>e.jsx("div",{role:"cell","data-cell-type":"readonly",className:"bg-ui-bg-base size-full cursor-not-allowed px-4 py-2.5",children:r}),Q=({form:r})=>{const{store:t}=G(),{regions:i}=F({limit:9999}),{price_preferences:a}=k({}),{setCloseOnEscape:s}=C(),n=Y({currencies:t==null?void 0:t.supported_currencies,regions:i,pricePreferences:a}),l=R({control:r.control,name:"variants"});return e.jsx(z,{columns:n,data:l,state:r,onEditingChange:v=>s(!v)})},X=B(),Y=({currencies:r=[],regions:t=[],pricePreferences:i=[]})=>{const{t:a}=S();return E.useMemo(()=>[X.column({id:a("fields.title"),header:a("fields.title"),cell:({row:s})=>{const n=s.original;return e.jsx(O,{children:e.jsx("div",{className:"flex h-full w-full items-center gap-x-2 overflow-hidden",children:e.jsx("span",{className:"truncate",children:n.title})})})},disableHiding:!0}),...$({currencies:r.map(s=>s.currency_code),regions:t,pricePreferences:i,getFieldName:(s,n)=>s.column.id.startsWith("currency_prices")?`variants.${s.row.index}.prices.${n}`:`variants.${s.row.index}.prices.${n}`,t:a})],[a,r,t,i])},Z=P({variants:A(P({prices:J(w(),w().or(K()).optional()).optional()}))}),I=({product:r,variantId:t})=>{const{t:i}=S(),{handleSuccess:a}=C(),{mutateAsync:s,isPending:n}=U(r.id),{regions:l}=F({limit:9999}),v=E.useMemo(()=>l!=null&&l.length?l.reduce((o,c)=>(o[c.id]=c.currency_code,o),{}):{},[l]),f=t?r.variants.filter(o=>o.id===t):r.variants,g=H({defaultValues:{variants:f.map(o=>({title:o.title,prices:o.prices.reduce((c,u)=>{var d;return(d=u.rules)!=null&&d.region_id?c[u.rules.region_id]=u.amount:c[u.currency_code]=u.amount,c},{})}))},resolver:q(Z,{})}),T=g.handleSubmit(async o=>{const c=o.variants.map((u,d)=>({id:f[d].id,prices:Object.entries(u.prices||{}).map(([x,M])=>{var _,b;const p=x.startsWith("reg_")?x:void 0,j=x.startsWith("reg_")?v[p]:x;let y;p?y=(_=f[d].prices.find(h=>h.rules.region_id===p))==null?void 0:_.id:y=(b=f[d].prices.find(h=>h.currency_code===j&&Object.keys(h.rules??{}).length===0))==null?void 0:b.id;const V=D(M);return{id:y,currency_code:j,amount:V,...p?{rules:{region_id:p}}:{}}})}));await s(c,{onSuccess:()=>{a("..")}})});return e.jsx(m.Form,{form:g,children:e.jsxs("form",{onSubmit:T,className:"flex size-full flex-col",children:[e.jsx(m.Header,{}),e.jsx(m.Body,{className:"flex flex-col overflow-hidden",children:e.jsx(Q,{form:g})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex w-full items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(N,{variant:"secondary",size:"small",children:i("actions.cancel")})}),e.jsx(N,{type:"submit",variant:"primary",size:"small",isLoading:n,children:i("actions.save")})]})})]})})},ge=()=>{const{id:r,variant_id:t}=W(),{product:i,isLoading:a,isError:s,error:n}=L(r);if(s)throw n;return e.jsx(m,{children:!a&&i&&e.jsx(I,{product:i,variantId:t})})};export{ge as Component};
