import{u as z,a as D,b as F}from"./chunk-DJPQV344-Q3LjscJv.js";import{w as G,j as e,u as y,r as p,t as S,y as H}from"./index-DQ7iaOIo.js";import{u as B,D as I}from"./chunk-MOFW5DA3-BBRzwwAr.js";import"./lodash-BbEdBw2P.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{g as M}from"./chunk-YVTBRLIE-QBelkXWc.js";import{u as N}from"./chunk-RYVWLLZ2-CmEHdxLZ.js";import{R as n,u as O}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as L,H as V}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{t as $}from"./zod-DqtdDTUb.js";import{o as q,a as Q,s as Z}from"./index-yuYasa5Y.js";import{B as x}from"./label-DsyTUQgE.js";import{C}from"./checkbox-BXdKf1Kl.js";import{c as J}from"./index-DW7vLJga.js";import"./chunk-C76H5USB-BzcnRuay.js";import"./chunk-B4FQDBC3-vSBK5DkU.js";import"./chunk-P3UUX2T6-OlAXa1VC.js";import"./format-CJ2FegFx.js";import"./chunk-ADOCJB6L-DwJI6LYz.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./plus-mini-DfhjBeEB.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangle-left-mini-o3U9ykef.js";import"./prompt-BKfKBHyN.js";import"./index-CIxKSFC7.js";var K=q({customer_ids:Q(Z()).min(1)}),d=10,U=({customerGroupId:r})=>{const{t:a}=y(),{handleSuccess:h}=O(),s=L({defaultValues:{customer_ids:[]},resolver:$(K)}),{setValue:o}=s,[i,u]=p.useState({});p.useEffect(()=>{o("customer_ids",Object.keys(i).filter(t=>i[t]),{shouldDirty:!0,shouldTouch:!0})},[i,o]);const{searchParams:m,raw:j}=z({pageSize:d}),b=D(),{customers:_,count:f,isLoading:T,isError:v,error:w}=N({fields:"id,email,first_name,last_name,*groups",...m}),R=t=>{const c=typeof t=="function"?t(i):t,l=Object.keys(c);o("customer_ids",l,{shouldDirty:!0,shouldTouch:!0}),u(c)},g=X(),{table:P}=B({data:_??[],columns:g,count:f,enablePagination:!0,enableRowSelection:t=>{var c;return!((c=t.original.groups)!=null&&c.map(l=>l.id).includes(r))},getRowId:t=>t.id,pageSize:d,rowSelection:{state:i,updater:R}}),{mutateAsync:A,isPending:k}=M(r),E=s.handleSubmit(async t=>{await A({customer_ids:t.customer_ids},{onSuccess:()=>{S.success(a("customerGroups.customers.add.successToast",{count:t.customer_ids.length})),h(`/customer-groups/${r}`)},onError:c=>{S.error(c.message)}})});if(v)throw w;return e.jsx(n.Form,{form:s,children:e.jsxs("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:E,children:[e.jsx(n.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[s.formState.errors.customer_ids&&e.jsx(V,{variant:"error",children:s.formState.errors.customer_ids.message}),e.jsx(n.Close,{asChild:!0,children:e.jsx(x,{variant:"secondary",size:"small",children:a("actions.cancel")})}),e.jsx(x,{type:"submit",variant:"primary",size:"small",isLoading:k,children:a("actions.save")})]})}),e.jsx(n.Body,{className:"size-full overflow-hidden",children:e.jsx(I,{table:P,columns:g,pageSize:d,count:f,filters:b,orderBy:["email","first_name","last_name","has_account","created_at","updated_at"],isLoading:T,layout:"fill",search:!0,queryObject:j,noRecords:{message:a("customerGroups.customers.add.list.noRecordsMessage")}})})]})})},W=J(),X=()=>{const{t:r}=y(),a=F();return p.useMemo(()=>[W.display({id:"select",header:({table:s})=>e.jsx(C,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:o=>s.toggleAllPageRowsSelected(!!o)}),cell:({row:s})=>{const o=!s.getCanSelect(),i=s.getIsSelected()||o,u=e.jsx(C,{checked:i,disabled:o,onCheckedChange:m=>s.toggleSelected(!!m),onClick:m=>{m.stopPropagation()}});return o?e.jsx(H,{content:r("customerGroups.customers.alreadyAddedTooltip"),side:"right",children:u}):u}}),...a],[r,a])},Fe=()=>{const{id:r}=G();return e.jsx(n,{children:e.jsx(U,{customerGroupId:r})})};export{Fe as Component};
