import{a as L}from"./chunk-R2O6QX4D-CX21ziz_.js";import{S as k}from"./chunk-OUAFSZKF-BpzSoAuD.js";import{f as O}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{S as T}from"./chunk-ARXK2O3B-CLA1-3Mx.js";import{u as g}from"./chunk-KKUJQ3HN-B-RHKr58.js";import{C as j}from"./chunk-UY4EBCIZ-BkMu1ycI.js";import{u as E,c as F}from"./chunk-RJJ3HJT5-0qvBrSK4.js";import{u as S,w as V,N as I,j as e,H as P,s as b,t as y,I as w,D as N}from"./index-DQ7iaOIo.js";import{a as m,u as B}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as R,F as o}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{o as q,s as f,c as D,b as M}from"./index-yuYasa5Y.js";import{R as x}from"./radio-group-CqMTuXTE.js";import{B as v}from"./label-DsyTUQgE.js";import"./switch-CHhgpYt_.js";import"./index-CIxKSFC7.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangles-mini-BMU6OfpM.js";import"./plus-mini-DfhjBeEB.js";import"./chunk-3UMDCRM2-NSGJIubw.js";import"./prompt-BKfKBHyN.js";function H(l,r){const s={};return r.forEach(n=>{n in l&&(s[n]=l[n])}),s}q({name:f().min(1),price_type:D(k),enabled_in_store:M().optional(),shipping_profile_id:f(),provider_id:f()});var z=({locationId:l,shippingOption:r})=>{const{t:s}=S(),{handleSuccess:n}=B(),p=g({queryFn:i=>b.admin.shippingProfile.list(i),queryKey:["shipping_profiles"],getOptions:i=>i.shipping_profiles.map(a=>({label:a.name,value:a.id})),defaultValue:r.shipping_profile_id}),d=g({queryFn:i=>b.admin.fulfillmentProvider.list({...i,stock_location_id:l}),queryKey:["fulfillment_providers"],getOptions:i=>i.fulfillment_providers.map(a=>({label:O(a.id),value:a.id})),defaultValue:r.provider_id}),t=R({defaultValues:{name:r.name,price_type:r.price_type,enabled_in_store:L(r),shipping_profile_id:r.shipping_profile_id,provider_id:r.provider_id}}),{mutateAsync:h,isPending:u}=F(r.id),C=t.handleSubmit(async i=>{const a=r.rules.map(c=>({...H(c,["id","attribute","operator","value"])})),_=a.find(c=>c.attribute==="enabled_in_store");_?_.value=i.enabled_in_store?"true":"false":a.push({value:i.enabled_in_store?"true":"false",attribute:"enabled_in_store",operator:"eq"}),await h({name:i.name,price_type:i.price_type,shipping_profile_id:i.shipping_profile_id,provider_id:i.provider_id,rules:a},{onSuccess:({shipping_option:c})=>{y.success(s("stockLocations.shippingOptions.edit.successToast",{name:c.name})),n(`/settings/locations/${l}`)},onError:c=>{y.error(c.message)}})});return e.jsx(m.Form,{form:t,children:e.jsxs("form",{onSubmit:C,className:"flex flex-1 flex-col",children:[e.jsx(m.Body,{children:e.jsx("div",{className:"flex flex-col gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsx(o.Field,{control:t.control,name:"price_type",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("stockLocations.shippingOptions.fields.priceType.label")}),e.jsx(o.Control,{children:e.jsxs(x,{...i,onValueChange:i.onChange,children:[e.jsx(x.ChoiceBox,{className:"flex-1",value:"flat",label:s("stockLocations.shippingOptions.fields.priceType.options.fixed.label"),description:s("stockLocations.shippingOptions.fields.priceType.options.fixed.hint")}),e.jsx(x.ChoiceBox,{className:"flex-1",value:"calculated",label:s("stockLocations.shippingOptions.fields.priceType.options.calculated.label"),description:s("stockLocations.shippingOptions.fields.priceType.options.calculated.hint")})]})}),e.jsx(o.ErrorMessage,{})]})}),e.jsxs("div",{className:"grid gap-y-4",children:[e.jsx(o.Field,{control:t.control,name:"name",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("fields.name")}),e.jsx(o.Control,{children:e.jsx(w,{...i})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:t.control,name:"shipping_profile_id",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:s("stockLocations.shippingOptions.fields.profile")}),e.jsx(o.Control,{children:e.jsx(j,{...i,options:p.options,searchValue:p.searchValue,onSearchValueChange:p.onSearchValueChange,disabled:p.disabled})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:t.control,name:"provider_id",render:({field:i})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{tooltip:s("stockLocations.fulfillmentProviders.shippingOptionsTooltip"),children:s("stockLocations.shippingOptions.fields.provider")}),e.jsx(o.Control,{children:e.jsx(j,{...i,options:d.options,searchValue:d.searchValue,onSearchValueChange:d.onSearchValueChange,disabled:d.disabled})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsx(N,{}),e.jsx(T,{control:t.control,name:"enabled_in_store",label:s("stockLocations.shippingOptions.fields.enableInStore.label"),description:s("stockLocations.shippingOptions.fields.enableInStore.hint")})]})})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(v,{size:"small",variant:"secondary",children:s("actions.cancel")})}),e.jsx(v,{size:"small",type:"submit",isLoading:u,children:s("actions.save")})]})})]})})},pe=()=>{const{t:l}=S(),{location_id:r,so_id:s}=V(),{shipping_options:n,isPending:p,isError:d,error:t}=E({id:s}),h=n==null?void 0:n.find(u=>u.id===s);if(d)throw t;if(!p&&!h)throw I({message:`Shipping option with ID ${s} was not found`},404);return e.jsxs(m,{children:[e.jsx(m.Header,{children:e.jsx(P,{children:l("stockLocations.shippingOptions.edit.header")})}),!p&&h&&e.jsx(z,{shippingOption:h,locationId:r})]})};export{pe as Component};
