import{u as z,a as E}from"./chunk-XDVPCCFF-DPhfBuez.js";import{u as M}from"./chunk-LSEYENCI-CbqWCFFl.js";import{w as F,ch as H,j as e,u as k,ci as B,r as w,c3 as N,t as v,y as b,k as O}from"./index-DQ7iaOIo.js";import{u as L,D as V}from"./chunk-MOFW5DA3-BBRzwwAr.js";import"./lodash-BbEdBw2P.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{R as p,u as q}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as G,H as Q}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{t as Z}from"./zod-DqtdDTUb.js";import{o as $,a as J,s as K}from"./index-yuYasa5Y.js";import{B as A}from"./label-DsyTUQgE.js";import{C as R}from"./checkbox-BXdKf1Kl.js";import{c as U}from"./index-DW7vLJga.js";import"./chunk-KDXAFTVE-BIJQy-Te.js";import"./chunk-IQRVIEMV-CAyGAynz.js";import"./chunk-P3UUX2T6-OlAXa1VC.js";import"./chunk-ADOCJB6L-DwJI6LYz.js";import"./chunk-C76H5USB-BzcnRuay.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./plus-mini-DfhjBeEB.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./format-CJ2FegFx.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangle-left-mini-o3U9ykef.js";import"./prompt-BKfKBHyN.js";import"./index-CIxKSFC7.js";var W=$({promotion_ids:J(K()).min(1)}),P=50,X=({campaign:t})=>{var _,T;const{t:s}=k(),{handleSuccess:o}=q(),r=G({defaultValues:{promotion_ids:[]},resolver:Z(W)}),{setValue:u}=r,{mutateAsync:x,isPending:S}=B(t.id),[g,n]=w.useState({}),c=i=>{const y=typeof i=="function"?i(g):i,I=Object.keys(y);u("promotion_ids",I,{shouldDirty:!0,shouldTouch:!0}),n(y)},{searchParams:m,raw:j}=z({pageSize:P}),{promotions:C,count:a,isPending:h}=N({...m},{placeholderData:O}),d=ee(),f=M(),{table:l}=L({data:C??[],columns:d,enableRowSelection:i=>i.original.campaign_id!==t.id,enablePagination:!0,getRowId:i=>i.id,pageSize:P,count:a,rowSelection:{state:g,updater:c},meta:{campaignId:t.id,currencyCode:(_=t==null?void 0:t.budget)==null?void 0:_.currency_code,budgetType:(T=t==null?void 0:t.budget)==null?void 0:T.type}}),D=r.handleSubmit(async i=>{await x({add:i.promotion_ids},{onSuccess:()=>{v.success(s("campaigns.promotions.toast.success",{count:i.promotion_ids.length})),o()},onError:y=>v.error(y.message)})});return e.jsx(p.Form,{form:r,children:e.jsxs("form",{onSubmit:D,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(p.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[r.formState.errors.promotion_ids&&e.jsx(Q,{variant:"error",children:r.formState.errors.promotion_ids.message}),e.jsx(p.Close,{asChild:!0,children:e.jsx(A,{size:"small",variant:"secondary",children:s("actions.cancel")})}),e.jsx(A,{size:"small",type:"submit",isLoading:S,children:s("actions.save")})]})}),e.jsx(p.Body,{className:"flex size-full flex-col overflow-y-auto",children:e.jsx(V,{table:l,count:a,columns:d,pageSize:P,isLoading:h,filters:f,orderBy:["title","status","created_at","updated_at"],queryObject:j,layout:"fill",pagination:!0,search:!0,noRecords:{message:s("campaigns.promotions.add.list.noRecordsMessage")}})})]})})},Y=U(),ee=()=>{const t=E(),{t:s}=k();return w.useMemo(()=>[Y.display({id:"select",header:({table:o})=>e.jsx(R,{checked:o.getIsSomePageRowsSelected()?"indeterminate":o.getIsAllPageRowsSelected(),onCheckedChange:r=>o.toggleAllRowsSelected(!!r)}),cell:({row:o,table:r})=>{var h,d,f;const{campaignId:u,currencyCode:x,budgetType:S}=r.options.meta,g=S==="spend",n=o.original.campaign_id===u,c=!!o.original.campaign_id&&o.original.campaign_id!==u,m=g&&((h=o.original.application_method)==null?void 0:h.currency_code)!==x,j=o.getIsSelected()||n,C=m||c,a=e.jsx(R,{checked:C?"indeterminate":j,disabled:n||c||m,onCheckedChange:l=>o.toggleSelected(!!l),onClick:l=>{l.stopPropagation()}});return c?e.jsx(b,{content:s("campaigns.promotions.alreadyAddedDiffCampaign",{name:(f=(d=o.original)==null?void 0:d.campaign)==null?void 0:f.name}),side:"right",children:a}):m?e.jsx(b,{content:s("campaigns.promotions.currencyMismatch"),side:"right",children:a}):n?e.jsx(b,{content:s("campaigns.promotions.alreadyAdded"),side:"right",children:a}):a}}),...t],[s,t])},Fe=()=>{const{id:t}=F(),{campaign:s,isError:o,error:r}=H(t);if(o)throw r;return e.jsx(p,{children:s&&e.jsx(X,{campaign:s})})};export{Fe as Component};
