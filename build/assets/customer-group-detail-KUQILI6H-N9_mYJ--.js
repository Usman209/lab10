import{u as E,a as I,b as z}from"./chunk-DJPQV344-Q3LjscJv.js";import{h as L,w as M,j as s,cl as Q,q as x,r as v,u as l,C,H as w,L as H,b as O,A as S,T as h,v as $,t as y}from"./index-DQ7iaOIo.js";import{S as B}from"./chunk-FGHVNTU2-B17BbdmQ.js";import"./chunk-3IW4HYUP-DTbTbYs9.js";import{u as F,D as K}from"./chunk-MOFW5DA3-BBRzwwAr.js";import"./lodash-BbEdBw2P.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{e as J,a as b,b as Z}from"./chunk-YVTBRLIE-QBelkXWc.js";import{u as U}from"./chunk-RYVWLLZ2-CmEHdxLZ.js";import{p as V}from"./chunk-4N7PLYUW-DRfoew5M.js";import{P as G}from"./pencil-square-C2dQ88SM.js";import{T}from"./trash-AHlgA58B.js";import{u as d}from"./use-prompt-DSUtE_64.js";import{B as W}from"./label-DsyTUQgE.js";import{C as f}from"./checkbox-BXdKf1Kl.js";import{c as X}from"./index-DW7vLJga.js";import"./chunk-C76H5USB-BzcnRuay.js";import"./chunk-B4FQDBC3-vSBK5DkU.js";import"./chunk-P3UUX2T6-OlAXa1VC.js";import"./format-CJ2FegFx.js";import"./chunk-ADOCJB6L-DwJI6LYz.js";import"./arrow-up-right-on-box-CErxVq_8.js";import"./Trans-LG4CmYWt.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangle-down-mini-CMQwg4p-.js";import"./square-two-stack-0Hf-pV3m.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./plus-mini-DfhjBeEB.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./triangle-left-mini-o3U9ykef.js";import"./chunk-DMYZ6SLX-CvGU_oYL.js";import"./prompt-BKfKBHyN.js";import"./index-CIxKSFC7.js";const Y={widgets:[]},ee={widgets:[]};var u=10,te=({group:o})=>{const[t,e]=v.useState({}),{t:r}=l(),a=d(),{searchParams:i,raw:n}=E({pageSize:u}),{customers:p,count:m,isLoading:P,isError:k,error:R}=U({...i,groups:o.id}),g=oe(),D=I(["groups"]),{table:A}=F({data:p??[],columns:g,count:m,getRowId:c=>c.id,enablePagination:!0,enableRowSelection:!0,pageSize:u,rowSelection:{state:t,updater:e},meta:{customerGroupId:o.id}});if(k)throw R;const{mutateAsync:_}=b(o.id),q=async()=>{const c=Object.keys(t);await a({title:r("customerGroups.customers.remove.title",{count:c.length}),description:r("customerGroups.customers.remove.description",{count:c.length}),confirmText:r("actions.continue"),cancelText:r("actions.cancel")})&&await _({customer_ids:c.map(N=>({id:N}))},{onSuccess:()=>{e({})}})};return s.jsxs(C,{className:"divide-y p-0",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsx(w,{level:"h2",children:r("customers.domain")}),s.jsx(H,{to:`/customer-groups/${o.id}/add-customers`,children:s.jsx(W,{variant:"secondary",size:"small",children:r("general.add")})})]}),s.jsx(K,{table:A,columns:g,pageSize:u,isLoading:P,count:m,navigateTo:c=>`/customers/${c.id}`,filters:D,search:!0,pagination:!0,orderBy:["email","first_name","last_name","has_account","created_at","updated_at"],queryObject:n,commands:[{action:q,label:r("actions.remove"),shortcut:"r"}],noRecords:{message:r("customerGroups.customers.list.noRecordsMessage")}})]})},se=({customer:o,customerGroupId:t})=>{const{t:e}=l(),{mutateAsync:r}=b(t),a=d(),i=async()=>{await a({title:e("customerGroups.customers.remove.title",{count:1}),description:e("customerGroups.customers.remove.description",{count:1}),confirmText:e("actions.continue"),cancelText:e("actions.cancel")})&&await r({customer_ids:[{id:o.id}]})};return s.jsx(S,{groups:[{actions:[{icon:s.jsx(G,{}),label:e("actions.edit"),to:`/customers/${o.id}/edit`}]},{actions:[{icon:s.jsx(T,{}),label:e("actions.remove"),onClick:i}]}]})},j=X(),oe=()=>{const o=z();return v.useMemo(()=>[j.display({id:"select",header:({table:t})=>s.jsx(f,{checked:t.getIsSomePageRowsSelected()?"indeterminate":t.getIsAllPageRowsSelected(),onCheckedChange:e=>t.toggleAllPageRowsSelected(!!e)}),cell:({row:t})=>s.jsx(f,{checked:t.getIsSelected(),onCheckedChange:e=>t.toggleSelected(!!e),onClick:e=>{e.stopPropagation()}})}),...o,j.display({id:"actions",cell:({row:t,table:e})=>{const{customerGroupId:r}=e.options.meta;return s.jsx(se,{customer:t.original,customerGroupId:r})}})],[o])},re=({group:o})=>{var n;const{t}=l(),e=d(),r=O(),{mutateAsync:a}=Z(o.id),i=async()=>{await e({title:t("customerGroups.delete.title"),description:t("customerGroups.delete.description",{name:o.name}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await a(void 0,{onSuccess:()=>{y.success(t("customerGroups.delete.successToast",{name:o.name})),r("/customer-groups",{replace:!0})},onError:m=>{y.error(m.message)}})};return s.jsxs(C,{className:"divide-y p-0",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsx(w,{children:o.name}),s.jsx(S,{groups:[{actions:[{icon:s.jsx(G,{}),label:t("actions.edit"),to:`/customer-groups/${o.id}/edit`}]},{actions:[{icon:s.jsx(T,{}),label:t("actions.delete"),onClick:i}]}]})]}),s.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[s.jsx(h,{size:"small",leading:"compact",weight:"plus",children:t("customers.domain")}),s.jsx(h,{size:"small",leading:"compact",children:((n=o.customers)==null?void 0:n.length)||"-"})]})]})},Ue=()=>{const o=L(),{id:t}=M(),{customer_group:e,isLoading:r,isError:a,error:i}=J(t,{fields:"+customers.id"},{initialData:o});if(r||!e)return s.jsx(Q,{sections:2,showJSON:!0,showMetadata:!0});if(a)throw i;return s.jsxs(B,{widgets:{before:ee,after:Y},showJSON:!0,showMetadata:!0,data:e,children:[s.jsx(re,{group:e}),s.jsx(te,{group:e})]})},ae=o=>({queryKey:V.detail(o),queryFn:async()=>$.customerGroups.retrieve(o,{fields:"+customers.id"})}),Ve=async({params:o})=>{const t=o.id,e=ae(t);return x.getQueryData(e.queryKey)??await x.fetchQuery(e)};export{Ue as Component,Ve as loader};
