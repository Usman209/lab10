import{f as we}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{u as M}from"./chunk-JCVALELX-CXrRyc-h.js";import{D as ie}from"./chunk-HCRBCECO-DmzhLN6S.js";import{f as U}from"./chunk-R6CEB3GW-1KtZJKxo.js";import{g as ze,a as Oe}from"./chunk-MRWYX6AY-DEPn52yn.js";import{a as R,g as f}from"./chunk-FSMQADBD-DQ6u7KYm.js";import{i as Ce,a as W}from"./chunk-OIAPXGI2-CCQfJ697.js";import{J as Q}from"./chunk-3IW4HYUP-DTbTbYs9.js";import{T as re}from"./chunk-PHMALPVO-BXYfPvrg.js";import{u as le}from"./chunk-QAF7PVQE-D70u5tsT.js";import{r as u,q as K,h as Pe,w as Se,a3 as Ae,j as e,O as Le,a4 as Ie,s as Ee,u as x,C as v,H as y,T as n,L as T,a5 as ke,A as _,P as $e,z as Be,b as ne,a6 as Me,y as F,$ as Re,a7 as Te,E as Fe,a8 as De,n as qe,g as B,a9 as He,aa as Ve,ab as Ue,t as O,B as We,ac as j}from"./index-DQ7iaOIo.js";import{u as Qe}from"./chunk-3UMDCRM2-NSGJIubw.js";import{u as Ke}from"./chunk-TAOSOO55-C3xZaLGt.js";import{u as ce}from"./chunk-KWVVOB4B-Ch3DSjg4.js";import{u as Ge,F as z}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{t as Je}from"./zod-DqtdDTUb.js";import{z as G}from"./index-yuYasa5Y.js";import{A as Xe}from"./arrow-path--xNxCUH4.js";import{X as D}from"./x-circle-DtLjBqH9.js";import{A as q}from"./arrow-down-right-mini-DIwWk90s.js";import{u as H}from"./use-prompt-DSUtE_64.js";import{C as b}from"./copy-BZS7_ZG6.js";import{S as N}from"./status-badge-CrS-Pq0N.js";import{f as k}from"./format-CJ2FegFx.js";import{B as S}from"./label-DsyTUQgE.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./arrow-up-right-on-box-CErxVq_8.js";import"./Trans-LG4CmYWt.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangle-down-mini-CMQwg4p-.js";import"./square-two-stack-0Hf-pV3m.js";import"./chunk-DMYZ6SLX-CvGU_oYL.js";import"./prompt-BKfKBHyN.js";var Ye=Object.defineProperty,A=Object.getOwnPropertySymbols,de=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,J=(s,t,a)=>t in s?Ye(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,Ze=(s,t)=>{for(var a in t||(t={}))de.call(t,a)&&J(s,a,t[a]);if(A)for(var a of A(t))oe.call(t,a)&&J(s,a,t[a]);return s},es=(s,t)=>{var a={};for(var i in s)de.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&A)for(var i of A(s))t.indexOf(i)<0&&oe.call(s,i)&&(a[i]=s[i]);return a};const me=u.forwardRef((s,t)=>{var a=s,{color:i="currentColor"}=a,r=es(a,["color"]);return u.createElement("svg",Ze({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:t},r),u.createElement("path",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M13.056 7.5H1.944M9.278 3.722 13.056 7.5l-3.778 3.778"}))});me.displayName="ArrowLongRight";var ss=Object.defineProperty,L=Object.getOwnPropertySymbols,ue=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable,X=(s,t,a)=>t in s?ss(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,ts=(s,t)=>{for(var a in t||(t={}))ue.call(t,a)&&X(s,a,t[a]);if(L)for(var a of L(t))xe.call(t,a)&&X(s,a,t[a]);return s},as=(s,t)=>{var a={};for(var i in s)ue.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&L)for(var i of L(s))t.indexOf(i)<0&&xe.call(s,i)&&(a[i]=s[i]);return a};const pe=u.forwardRef((s,t)=>{var a=s,{color:i="currentColor"}=a,r=as(a,["color"]);return u.createElement("svg",ts({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:t},r),u.createElement("g",{clipPath:"url(#a)"},u.createElement("path",{fill:i,d:"M7.5.389C3.58.389.389 3.579.389 7.5s3.19 7.111 7.111 7.111 7.111-3.19 7.111-7.111S11.421.389 7.5.389m2.693 6.915a.665.665 0 0 1-.942 0L8.167 6.22v4.168a.667.667 0 0 1-1.334 0V6.221L5.75 7.305a.667.667 0 1 1-.943-.943L7.028 4.14c.26-.26.683-.26.943 0l2.222 2.222c.26.26.26.683 0 .943"})),u.createElement("defs",null,u.createElement("clipPath",{id:"a"},u.createElement("path",{fill:"#fff",d:"M0 0h15v15H0z"}))))});pe.displayName="ArrowUpCircleSolid";var is=Object.defineProperty,I=Object.getOwnPropertySymbols,fe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable,Y=(s,t,a)=>t in s?is(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,rs=(s,t)=>{for(var a in t||(t={}))fe.call(t,a)&&Y(s,a,t[a]);if(I)for(var a of I(t))he.call(t,a)&&Y(s,a,t[a]);return s},ls=(s,t)=>{var a={};for(var i in s)fe.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&I)for(var i of I(s))t.indexOf(i)<0&&he.call(s,i)&&(a[i]=s[i]);return a};const ge=u.forwardRef((s,t)=>{var a=s,{color:i="currentColor"}=a,r=ls(a,["color"]);return u.createElement("svg",rs({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:t},r),u.createElement("g",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,clipPath:"url(#a)"},u.createElement("path",{d:"M1.056 4.611 7.07 7.93a.89.89 0 0 0 .858 0l6.015-3.318"}),u.createElement("path",{d:"M2.833 12.611h9.334c.982 0 1.777-.796 1.777-1.778V4.167c0-.982-.796-1.778-1.777-1.778H2.833c-.981 0-1.777.796-1.777 1.778v6.666c0 .982.796 1.778 1.777 1.778"})),u.createElement("defs",null,u.createElement("clipPath",{id:"a"},u.createElement("path",{fill:"#fff",d:"M0 0h15v15H0z"}))))});ge.displayName="Envelope";var ns=Object.defineProperty,E=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable,Z=(s,t,a)=>t in s?ns(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,cs=(s,t)=>{for(var a in t||(t={}))je.call(t,a)&&Z(s,a,t[a]);if(E)for(var a of E(t))ve.call(t,a)&&Z(s,a,t[a]);return s},ds=(s,t)=>{var a={};for(var i in s)je.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&E)for(var i of E(s))t.indexOf(i)<0&&ve.call(s,i)&&(a[i]=s[i]);return a};const ye=u.forwardRef((s,t)=>{var a=s,{color:i="currentColor"}=a,r=ds(a,["color"]);return u.createElement("svg",cs({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:t},r),u.createElement("path",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7.5 1.5v5.333M11.278 4.167H3.722c-.982 0-1.778.796-1.778 1.778v5.333c0 .982.796 1.778 1.778 1.778h7.556c.982 0 1.778-.796 1.778-1.778V5.945c0-.982-.796-1.778-1.778-1.778"}),u.createElement("path",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m2.167 5.086 1.288-2.598c.3-.605.917-.988 1.593-.988h4.904c.676 0 1.293.383 1.593.988l1.288 2.599M4.167 10.833h1.777"}))});ye.displayName="FlyingBox";const os={widgets:[]},ms={widgets:[]},us={widgets:[]},xs={widgets:[]};var ps=s=>({queryKey:Ie.detail(s),queryFn:async()=>Ee.admin.order.retrieve(s,{fields:ie})}),Pt=async({params:s})=>{const t=s.id,a=ps(t);return K.getQueryData(a.queryKey)??await K.fetchQuery(a)},fs=G.object({value:G.string().min(1)}),hs=({order:s})=>{const{t}=x(),a=u.useRef(null),i=Ge({defaultValues:{value:""},resolver:Je(fs)}),{mutateAsync:r,isLoading:l}={},c=i.handleSubmit(async m=>{r({resource_id:s.id,resource_type:"order",value:m.value},{onSuccess:()=>{i.reset(),o()}})}),d=()=>{const m=a.current;m&&(m.style.height="auto",m.style.height=m.scrollHeight+"px")},o=()=>{const m=a.current;m&&(m.style.height="auto")};return e.jsx("div",{children:e.jsx(z,{...i,children:e.jsx("form",{onSubmit:c,children:e.jsxs("div",{className:"bg-ui-bg-field shadow-borders-base flex flex-col gap-y-2 rounded-md px-2 py-1.5",children:[e.jsx(z.Field,{control:i.control,name:"value",render:({field:m})=>e.jsxs(z.Item,{children:[e.jsx(z.Label,{hidden:!0,children:t("orders.activity.comment.label")}),e.jsx(z.Control,{children:e.jsx("textarea",{...m,ref:a,onInput:d,className:"txt-small text-ui-fg-base placeholder:text-ui-fg-muted resize-none overflow-hidden bg-transparent outline-none",placeholder:t("orders.activity.comment.placeholder"),rows:1})})]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(qe,{type:"submit",isLoading:l,variant:"transparent",size:"small",className:"text-ui-fg-muted hover:text-ui-fg-subtle active:text-ui-fg-subtle",children:[e.jsx("span",{className:"sr-only",children:t("orders.activity.comment.addButtonText")}),e.jsx(pe,{})]})})]})})})})},gs=({order:s})=>{const t=js(s);if(t.length<=3)return e.jsx("div",{className:"flex flex-col gap-y-0.5",children:t.map((l,c)=>e.jsx(P,{title:l.title,timestamp:l.timestamp,isFirst:c===t.length-1,children:l.children},c))});const a=t.slice(0,2),i=t.slice(2,t.length-1),r=t[t.length-1];return e.jsxs("div",{className:"flex flex-col gap-y-0.5",children:[a.map((l,c)=>e.jsx(P,{title:l.title,timestamp:l.timestamp,children:l.children},c)),e.jsx(vs,{activities:i}),e.jsx(P,{title:r.title,timestamp:r.timestamp,isFirst:!0,children:r.children})]})},js=s=>{const{t}=x(),{returns:a=[]}=M({order_id:s.id,fields:"+received_at,*items"}),i=[];return u.useMemo(()=>{const l=[];for(const o of s.fulfillments)l.push({title:t("orders.activity.events.fulfillment.created"),timestamp:o.created_at,children:e.jsx(ee,{fulfillment:o})}),o.shipped_at&&l.push({title:t("orders.activity.events.fulfillment.shipped"),timestamp:o.shipped_at,children:e.jsx(ee,{fulfillment:o,isShipment:!0})}),o.canceled_at&&l.push({title:t("orders.activity.events.fulfillment.canceled"),timestamp:o.canceled_at});for(const o of a)l.push({title:t("orders.activity.events.return.created",{returnId:o.id.slice(-7)}),timestamp:o.created_at,children:e.jsx(se,{orderReturn:o})}),(o.status==="received"||o.status==="partially_received")&&l.push({title:t("orders.activity.events.return.received",{returnId:o.id.slice(-7)}),timestamp:o.received_at,children:e.jsx(se,{orderReturn:o})});s.canceled_at&&l.push({title:t("orders.activity.events.canceled.title"),timestamp:s.canceled_at});const c=l.sort((o,m)=>new Date(m.timestamp).getTime()-new Date(o.timestamp).getTime()),d={title:t("orders.activity.events.placed.title"),timestamp:s.created_at,children:e.jsx(n,{size:"small",className:"text-ui-fg-subtle",children:R(s.total,s.currency_code)})};return[...c,d]},[s,i,!1,t])},P=({title:s,timestamp:t,isFirst:a=!1,children:i})=>{const{getFullDate:r,getRelativeDate:l}=le();return e.jsxs("div",{className:"grid grid-cols-[20px_1fr] items-start gap-2",children:[e.jsxs("div",{className:"flex size-full flex-col items-center gap-y-0.5",children:[e.jsx("div",{className:"flex size-5 items-center justify-center",children:e.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-2.5 items-center justify-center rounded-full",children:e.jsx("div",{className:"bg-ui-tag-neutral-icon size-1.5 rounded-full"})})}),!a&&e.jsx("div",{className:"bg-ui-border-base w-px flex-1"})]}),e.jsxs("div",{className:B({"pb-4":!a}),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",children:s}),t&&e.jsx(F,{content:r({date:t,includeTime:!0}),children:e.jsx(n,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:l(t)})})]}),e.jsx("div",{children:i})]})]})},vs=({activities:s})=>{const[t,a]=u.useState(!1),{t:i}=x();return s.length?e.jsxs(He,{open:t,onOpenChange:a,children:[!t&&e.jsxs("div",{className:"grid grid-cols-[20px_1fr] items-start gap-2",children:[e.jsx("div",{className:"flex size-full flex-col items-center",children:e.jsx("div",{className:"border-ui-border-strong w-px flex-1 bg-[linear-gradient(var(--border-strong)_33%,rgba(255,255,255,0)_0%)] bg-[length:1px_3px] bg-right bg-repeat-y"})}),e.jsx("div",{className:"pb-4",children:e.jsx(Ve,{className:"text-left",children:e.jsx(n,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-muted",children:i("orders.activity.showMoreActivities",{count:s.length})})})})]}),e.jsx(Ue,{children:e.jsx("div",{className:"flex flex-col gap-y-0.5",children:s.map((r,l)=>e.jsx(P,{title:r.title,timestamp:r.timestamp,children:r.children},l))})})]}):null},ee=({fulfillment:s})=>{const{t}=x(),a=s.items.reduce((i,r)=>i+r.quantity,0);return e.jsx("div",{children:e.jsx(n,{size:"small",className:"text-ui-fg-subtle",children:t("orders.activity.events.fulfillment.items",{count:a})})})},se=({orderReturn:s})=>{const{t}=x(),a=s.items.reduce((i,r)=>i+r.quantity,0);return e.jsx("div",{children:e.jsx(n,{size:"small",className:"text-ui-fg-subtle",children:t("orders.activity.events.return.items",{count:a})})})},ys=({order:s})=>{const{t}=x();return e.jsxs(v,{className:"flex flex-col gap-y-8 px-6 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(y,{level:"h2",children:t("orders.activity.header")})}),e.jsx(hs,{order:s})]}),e.jsx(gs,{order:s})]})},bs=({data:s})=>{const{t}=x(),a=s.customer_id,i=zs(s),r=s.email,l=(i||r).charAt(0).toUpperCase();return e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",children:t("fields.id")}),e.jsx(T,{to:`/customers/${a}`,className:"focus:shadow-borders-focus rounded-[4px] outline-none transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-x-2 overflow-hidden",children:[e.jsx(ke,{size:"2xsmall",fallback:l}),e.jsx(n,{size:"small",leading:"compact",className:"text-ui-fg-subtle hover:text-ui-fg-base transition-fg truncate",children:i||r})]})})]})},_s=({data:s})=>{var i,r;const{t}=x(),a=((i=s.shipping_address)==null?void 0:i.company)||((r=s.billing_address)==null?void 0:r.company);return a?e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",children:t("fields.company")}),e.jsx(n,{size:"small",leading:"compact",className:"truncate",children:a})]}):null},Ns=({data:s})=>{var r,l;const{t}=x(),a=((r=s.shipping_address)==null?void 0:r.phone)||((l=s.billing_address)==null?void 0:l.phone),i=s.email;return e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",children:t("orders.customer.contactLabel")}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_20px] items-start gap-x-2",children:[e.jsx(n,{size:"small",leading:"compact",className:"text-pretty break-all",children:i}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{content:i,className:"text-ui-fg-muted"})})]}),a&&e.jsxs("div",{className:"grid grid-cols-[1fr_20px] items-start gap-x-2",children:[e.jsx(n,{size:"small",leading:"compact",className:"text-pretty break-all",children:a}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{content:i,className:"text-ui-fg-muted"})})]})]})]})},te=({address:s,type:t})=>{const{t:a}=x();return e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",children:a(t==="shipping"?"addresses.shippingAddress.label":"addresses.billingAddress.label")}),s?e.jsxs("div",{className:"grid grid-cols-[1fr_20px] items-start gap-x-2",children:[e.jsx(n,{size:"small",leading:"compact",children:W({address:s}).map((i,r)=>e.jsxs("span",{className:"break-words",children:[i,e.jsx("br",{})]},r))}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{content:W({address:s}).join(`
`),className:"text-ui-fg-muted"})})]}):e.jsx(n,{size:"small",leading:"compact",children:"-"})]})},ws=({data:s})=>{const{t}=x();return e.jsxs("div",{className:"divide-y",children:[e.jsx(te,{address:s.shipping_address,type:"shipping"}),Ce(s.shipping_address,s.billing_address)?e.jsxs("div",{className:"grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-subtle",children:t("addresses.billingAddress.label")}),e.jsx(n,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:t("addresses.billingAddress.sameAsShipping")})]}):e.jsx(te,{address:s.billing_address,type:"billing"})]})},C=Object.assign({},{ID:bs,Company:_s,Contact:Ns,Addresses:ws}),zs=s=>{const{first_name:t,last_name:a}=s.shipping_address||{},{first_name:i,last_name:r}=s.billing_address||{},{first_name:l,last_name:c}=s.customer||{},d=[l,c].filter(Boolean).join(" "),o=[t,a].filter(Boolean).join(" "),m=[i,r].filter(Boolean).join(" ");return d||o||m},Os=({order:s})=>e.jsxs(v,{className:"divide-y p-0",children:[e.jsx(Cs,{}),e.jsx(C.ID,{data:s}),e.jsx(C.Contact,{data:s}),e.jsx(C.Company,{data:s}),e.jsx(C.Addresses,{data:s})]}),Cs=()=>{const{t:s}=x();return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{level:"h2",children:s("fields.customer")}),e.jsx(_,{groups:[{actions:[{label:s("transferOwnership.label"),to:"transfer-ownership",icon:e.jsx(Xe,{})}]},{actions:[{label:s("addresses.shippingAddress.editLabel"),to:"shipping-address",icon:e.jsx(ye,{})},{label:s("addresses.billingAddress.editLabel"),to:"billing-address",icon:e.jsx($e,{})}]},{actions:[{label:s("email.editLabel"),to:"email",icon:e.jsx(ge,{})}]}]})]})},Ps=({order:s})=>{const t=s.fulfillments||[];return e.jsxs("div",{className:"flex flex-col gap-y-3",children:[e.jsx(As,{order:s}),t.map((a,i)=>e.jsx(Ls,{index:i,fulfillment:a,order:s},a.id))]})},Ss=({item:s,currencyCode:t})=>e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsxs("div",{className:"flex items-start gap-x-4",children:[e.jsx(re,{src:s.thumbnail}),e.jsxs("div",{children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-base",children:s.title}),s.variant.sku&&e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(n,{size:"small",children:s.variant.sku}),e.jsx(b,{content:s.variant.sku,className:"text-ui-fg-muted"})]}),e.jsx(n,{size:"small",children:s.variant.options.map(a=>a.value).join(" · ")})]})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-x-4",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(n,{size:"small",children:f(s.unit_price,t)})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(n,{children:[e.jsx("span",{className:"tabular-nums",children:s.quantity-s.detail.fulfilled_quantity}),"x"]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(n,{size:"small",children:f(s.subtotal||0,t)})})]})]},s.id),As=({order:s})=>{const{t}=x(),a=s.items.filter(i=>i.detail.fulfilled_quantity<i.quantity);return a.length?e.jsxs(v,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{level:"h2",children:t("orders.fulfillment.unfulfilledItems")}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(N,{color:"red",className:"text-nowrap",children:t("orders.fulfillment.awaitingFulfillmentBadge")}),e.jsx(_,{groups:[{actions:[{label:t("orders.fulfillment.fulfillItems"),icon:e.jsx(Be,{}),to:`/orders/${s.id}/fulfillment`}]}]})]})]}),e.jsx("div",{children:a.map(i=>e.jsx(Ss,{item:i,currencyCode:s.currency_code},i.id))})]}):null},Ls=({fulfillment:s,order:t,index:a})=>{const{t:i}=x(),r=H(),l=ne(),c=!!s.location_id,{stock_location:d,isError:o,error:m}=Qe(s.location_id,void 0,{enabled:c});let h="Awaiting shipping",w="blue",g=s.created_at;s.canceled_at?(h="Canceled",w="red",g=s.canceled_at):s.shipped_at&&(h="Shipped",w="green",g=s.shipped_at);const{mutateAsync:$}=Me(t.id,s.id),_e=!s.canceled_at&&!s.shipped_at,Ne=async()=>{if(s.shipped_at){O.warning(i("orders.fulfillment.toast.fulfillmentShipped"));return}await r({title:i("general.areYouSure"),description:i("orders.fulfillment.cancelWarning"),confirmText:i("actions.continue"),cancelText:i("actions.cancel")})&&await $(void 0,{onSuccess:()=>{O.success(i("orders.fulfillment.toast.canceled"))},onError:V=>{O.error(V.message)}})};if(o)throw m;return e.jsxs(v,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{level:"h2",children:i("orders.fulfillment.number",{number:a+1})}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(F,{content:k(new Date(g),"dd MMM, yyyy, HH:mm:ss"),children:e.jsx(N,{color:w,className:"text-nowrap",children:h})}),e.jsx(_,{groups:[{actions:[{label:i("actions.cancel"),icon:e.jsx(D,{}),onClick:Ne,disabled:!!s.canceled_at}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",children:i("orders.fulfillment.itemsLabel")}),e.jsx("ul",{children:s.items.map(p=>e.jsx("li",{children:e.jsxs(n,{size:"small",leading:"compact",children:[p.quantity,"x ",p.title]})},p.line_item_id))})]}),c&&e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",children:i("orders.fulfillment.shippingFromLabel")}),d?e.jsx(T,{to:`/settings/locations/${d.id}`,className:"text-ui-fg-interactive hover:text-ui-fg-interactive-hover transition-fg",children:e.jsx(n,{size:"small",leading:"compact",children:d.name})}):e.jsx(Re,{className:"w-16"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",children:i("fields.provider")}),e.jsx(n,{size:"small",leading:"compact",children:we(s.provider_id)})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-start px-6 py-4",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",children:i("orders.fulfillment.trackingLabel")}),e.jsx("div",{children:s.labels&&s.labels.length>0?e.jsx("ul",{children:s.labels.map(p=>p.url&&p.url.length>0&&p.url!=="#"?e.jsx("li",{children:e.jsx("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",className:"text-ui-fg-interactive hover:text-ui-fg-interactive-hover transition-fg",children:e.jsx(n,{size:"small",leading:"compact",children:p.tracking_number})})},p.tracking_number):e.jsx("li",{children:e.jsx(n,{size:"small",leading:"compact",children:p.tracking_number})},p.tracking_number))}):e.jsx(n,{size:"small",leading:"compact",children:"-"})})]}),_e&&e.jsx("div",{className:"bg-ui-bg-subtle flex items-center justify-end rounded-b-xl px-4 py-4",children:e.jsx(S,{onClick:()=>l(`./${s.id}/create-shipment`),variant:"secondary",children:i("orders.fulfillment.markAsShipped")})})]})},Is=({order:s})=>{var l;const{t}=x(),a=H(),{mutateAsync:i}=Te(s.id),r=async()=>{await a({title:t("general.areYouSure"),description:t("orders.cancelWarning",{id:`#${s.display_id}`}),confirmText:t("actions.continue"),cancelText:t("actions.cancel")})&&await i()};return e.jsxs(v,{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsxs(y,{children:["#",s.display_id]}),e.jsx(b,{content:`#${s.display_id}`,className:"text-ui-fg-muted"})]}),e.jsx(n,{size:"small",className:"text-ui-fg-subtle",children:t("orders.onDateFromSalesChannel",{date:k(new Date(s.created_at),"dd MMM, yyyy, HH:mm:ss"),salesChannel:(l=s.sales_channel)==null?void 0:l.name})})]}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsxs("div",{className:"flex items-center gap-x-1.5",children:[e.jsx(ks,{order:s}),e.jsx(Es,{order:s})]}),e.jsx(_,{groups:[{actions:[{label:t("actions.cancel"),onClick:r,icon:e.jsx(D,{})}]}]})]})]})},Es=({order:s})=>{const{t}=x(),{label:a,color:i}=ze(t,s.fulfillment_status);return e.jsx(N,{color:i,className:"text-nowrap",children:a})},ks=({order:s})=>(x(),null),$s=s=>s.payment_collections.map(t=>t.payments).flat(1).filter(Boolean),Bs=({order:s})=>{const t=$s(s),a=t.map(i=>i==null?void 0:i.refunds).flat(1).filter(Boolean);return e.jsxs(v,{className:"divide-y divide-dashed p-0",children:[e.jsx(Ms,{order:s}),e.jsx(Ts,{order:s,payments:t,refunds:a,currencyCode:s.currency_code}),e.jsx(Fs,{payments:t,currencyCode:s.currency_code})]})},Ms=({order:s})=>{const{t}=x(),{label:a,color:i}=Oe(t,s.payment_status);return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{level:"h2",children:t("orders.payment.title")}),e.jsx(N,{color:i,className:"text-nowrap",children:a})]})},be=({refund:s,currencyCode:t})=>{const{t:a}=x(),i=e.jsx(We,{size:"2xsmall",className:"cursor-default select-none capitalize",children:s.reason}),r=s.note?e.jsx(F,{content:s.note,children:i}):i;return e.jsxs("div",{className:"bg-ui-bg-subtle text-ui-fg-subtle grid grid-cols-[1fr_1fr_1fr_1fr_20px] items-center gap-x-4 px-6 py-4",children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"self-center pr-3",children:e.jsx(q,{className:"text-ui-fg-muted"})}),e.jsxs("div",{children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",children:a("orders.payment.refund")}),e.jsx(n,{size:"small",leading:"compact",children:k(new Date(s.created_at),"dd MMM, yyyy, HH:mm:ss")})]})]}),e.jsx("div",{className:"flex items-center justify-end"}),e.jsx("div",{className:"flex items-center justify-end",children:r}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(n,{size:"small",leading:"compact",children:["- ",f(s.amount,t)]})})]})},Rs=({order:s,payment:t,refunds:a,currencyCode:i})=>{const{t:r}=x(),l=H(),{mutateAsync:c}=Ke(t.id),d=async()=>{await l({title:r("orders.payment.capture"),description:r("orders.payment.capturePayment",{amount:U(t.amount,i)}),confirmText:r("actions.confirm"),cancelText:r("actions.cancel"),variant:"confirmation"})&&await c({amount:t.amount},{onSuccess:()=>{O.success(r("orders.payment.capturePaymentSuccess",{amount:U(t.amount,i)}))},onError:$=>{O.error($.message)}})},[o,m]=t.captured_at?["Captured","green"]:["Pending","orange"],h=t.id.replace("pay_",""),w=t.captured_at===null&&t.canceled_at===null;return e.jsxs("div",{className:"divide-y divide-dashed",children:[e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-[1fr_1fr_1fr_1fr_20px] items-center gap-x-4 px-6 py-4",children:[e.jsxs("div",{className:"w-full overflow-hidden",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",className:"truncate",children:h}),e.jsx(n,{size:"small",leading:"compact",children:k(new Date(t.created_at),"dd MMM, yyyy, HH:mm:ss")})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(n,{size:"small",leading:"compact",className:"capitalize",children:t.provider_id})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(N,{color:m,className:"text-nowrap",children:o})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(n,{size:"small",leading:"compact",children:f(t.amount,t.currency_code)})}),e.jsx(_,{groups:[{actions:[{label:r("orders.payment.refund"),icon:e.jsx(D,{}),to:`/orders/${s.id}/payments/${t.id}/refund`,disabled:!t.captured_at}]}]})]}),w&&e.jsxs("div",{className:"bg-ui-bg-subtle flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(q,{className:"text-ui-fg-muted"}),e.jsx(n,{size:"small",leading:"compact",children:r("orders.payment.isReadyToBeCaptured",{id:h})})]}),e.jsx(S,{size:"small",variant:"secondary",onClick:d,children:r("orders.payment.capture")})]}),a.map(g=>e.jsx(be,{refund:g,currencyCode:i},g.id))]})},Ts=({order:s,payments:t,refunds:a,currencyCode:i})=>{const l=[...a.filter(c=>c.payment_id===null),...t].sort((c,d)=>new Date(c.created_at).getTime()-new Date(d.created_at).getTime()).map(c=>({event:c,type:c.id.startsWith("pay_")?"payment":"refund"}));return e.jsx("div",{className:"flex flex-col divide-y divide-dashed",children:l.map(({type:c,event:d})=>{switch(c){case"payment":return e.jsx(Rs,{order:s,payment:d,refunds:a.filter(o=>o.payment_id===d.id),currencyCode:i},d.id);case"refund":return e.jsx(be,{refund:d,currencyCode:i},d.id)}})})},Fs=({payments:s,currencyCode:t})=>{const{t:a}=x(),i=s.reduce((c,d)=>c+d.amount,0),r=s.reduce((c,d)=>c+(d.amount_refunded||0),0),l=i-r;return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(n,{size:"small",weight:"plus",leading:"compact",children:a("orders.payment.totalPaidByCustomer")}),e.jsx(n,{size:"small",weight:"plus",leading:"compact",children:R(l,t)})]})},Ds=({groups:s,children:t})=>e.jsxs(j,{children:[e.jsx(j.Trigger,{asChild:!0,children:t}),e.jsx(j.Content,{children:s.map((a,i)=>{if(!a.actions.length)return null;const r=i===s.length-1;return e.jsxs(j.Group,{children:[a.actions.map((l,c)=>l.onClick?e.jsxs(j.Item,{disabled:l.disabled,onClick:d=>{d.stopPropagation(),l.onClick()},className:B("[&_svg]:text-ui-fg-subtle flex items-center gap-x-2",{"[&_svg]:text-ui-fg-disabled":l.disabled}),children:[l.icon,e.jsx("span",{children:l.label})]},c):e.jsx("div",{children:e.jsx(j.Item,{className:B("[&_svg]:text-ui-fg-subtle flex items-center gap-x-2",{"[&_svg]:text-ui-fg-disabled":l.disabled}),asChild:!0,disabled:l.disabled,children:e.jsxs(T,{to:l.to,onClick:d=>d.stopPropagation(),children:[l.icon,e.jsx("span",{children:l.label})]})})},c)),!r&&e.jsx(j.Separator,{})]},i)})})]}),qs=({order:s})=>{const{t}=x(),a=ne(),{reservations:i}=ce({line_item_id:s.items.map(d=>d.id)}),{returns:r=[]}=M({status:"requested",order_id:s.id,fields:"+received_at"}),l=!!r.length,c=u.useMemo(()=>{var o;if(!i)return!1;const d=new Map(i.map(m=>[m.line_item_id,m.id]));for(const m of s.items)if((o=m.variant)!=null&&o.manage_inventory&&m.quantity-m.detail.fulfilled_quantity>0&&!d.has(m.id))return!0;return!1},[i]);return e.jsxs(v,{className:"divide-y divide-dashed p-0",children:[e.jsx(Hs,{order:s}),e.jsx(Us,{order:s}),e.jsx(Ws,{order:s}),e.jsx(Ks,{order:s}),c||l&&e.jsxs("div",{className:"bg-ui-bg-subtle flex items-center justify-end rounded-b-xl px-4 py-4",children:[l&&e.jsx(Ds,{groups:[{actions:r.map(d=>({label:t("orders.returns.receive.receive",{label:`#${d.id.slice(-7)}`}),icon:e.jsx(me,{}),to:`/orders/${s.id}/returns/${d.id}/receive`}))}],children:e.jsx(S,{variant:"secondary",size:"small",children:t("orders.returns.receive.action")})}),c&&e.jsx(S,{onClick:()=>a("./allocate-items"),variant:"secondary",children:t("orders.allocateItems.action")})]})]})},Hs=({order:s})=>{const{t}=x();return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(y,{level:"h2",children:t("fields.summary")}),e.jsx(_,{groups:[{actions:[{label:t("orders.returns.create"),to:`/orders/${s.id}/returns`,icon:e.jsx(Fe,{})},{label:t("orders.claims.create"),to:`/orders/${s.id}/claims`,icon:e.jsx(De,{})}]}]})]})},Vs=({item:s,currencyCode:t,reservation:a,returns:i})=>{var c;const{t:r}=x(),l=s.variant.manage_inventory;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center gap-x-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-start gap-x-4",children:[e.jsx(re,{src:s.thumbnail}),e.jsxs("div",{children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-base",children:s.title}),s.variant_sku&&e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(n,{size:"small",children:s.variant_sku}),e.jsx(b,{content:s.variant_sku,className:"text-ui-fg-muted"})]}),e.jsx(n,{size:"small",children:(c=s.variant)==null?void 0:c.options.map(d=>d.value).join(" · ")})]})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-x-4",children:[e.jsx("div",{className:"flex items-center justify-end gap-x-4",children:e.jsx(n,{size:"small",children:f(s.unit_price,t)})}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx("div",{className:"w-fit min-w-[27px]",children:e.jsxs(n,{size:"small",children:[e.jsx("span",{className:"tabular-nums",children:s.quantity}),"x"]})}),e.jsx("div",{className:"overflow-visible",children:l&&e.jsx(N,{color:a?"green":"orange",className:"text-nowrap",children:r(a?"orders.reservations.allocatedLabel":"orders.reservations.notAllocatedLabel")})})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(n,{size:"small",className:"pt-[1px]",children:f(s.subtotal||0,t)})})]})]},s.id),i.map(d=>e.jsx(Qs,{orderReturn:d,itemId:s.id},d.id))]})},Us=({order:s})=>{const{reservations:t}=ce({line_item_id:s.items.map(r=>r.id)}),{returns:a}=M({order_id:s.id,fields:"*items"}),i=u.useMemo(()=>{var l;if(!a)return{};const r={};return(l=s.items)==null||l.forEach(c=>{a.forEach(d=>{d.items.some(o=>o.item_id===c.id)&&(r[c.id]?r[c.id].push(d):r[c.id]=[d])})}),r},[a]);return e.jsx("div",{children:s.items.map(r=>{const l=t?t.find(c=>c.line_item_id===r.id):null;return e.jsx(Vs,{item:r,currencyCode:s.currency_code,reservation:l,returns:i[r.id]||[]},r.id)})})},ae=({label:s,value:t,secondaryValue:a})=>e.jsxs("div",{className:"grid grid-cols-3 items-center",children:[e.jsx(n,{size:"small",leading:"compact",children:s}),e.jsx("div",{className:"text-right",children:e.jsx(n,{size:"small",leading:"compact",children:a})}),e.jsx("div",{className:"text-right",children:e.jsx(n,{size:"small",leading:"compact",children:t})})]}),Ws=({order:s})=>{const{t}=x();return e.jsxs("div",{className:"text-ui-fg-subtle flex flex-col gap-y-2 px-6 py-4",children:[e.jsx(ae,{label:t("fields.discount"),value:s.discount_total>0?`- ${f(s.discount_total,s.currency_code)}`:"-"}),e.jsx(ae,{label:t("fields.shipping"),secondaryValue:s.shipping_methods.map(a=>a.name).join(", "),value:f(s.shipping_total,s.currency_code)})]})},Qs=({orderReturn:s,itemId:t})=>{const{t:a}=x(),{getRelativeDate:i}=le();if(!["requested","received","partially_received"].includes(s.status))return null;const r=s.status==="requested";return e.jsxs("div",{className:"text-ui-fg-subtle bg-ui-bg-subtle flex flex-row justify-between gap-y-2 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"text-ui-fg-muted"}),e.jsx(n,{size:"small",className:"text-ui-fg-subtle",children:a(`orders.returns.${r?"returnRequestedInfo":"returnReceivedInfo"}`,{requestedItemsCount:s.items.find(l=>l.item_id===t)[r?"quantity":"received_quantity"]})})]}),r&&e.jsx(n,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:i(r?s.created_at:s.received_at)})]},s.id)},Ks=({order:s})=>{const{t}=x();return e.jsxs("div",{className:" flex flex-col gap-y-2 px-6 py-4",children:[e.jsxs("div",{className:"text-ui-fg-base flex items-center justify-between",children:[e.jsx(n,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:t("fields.total")}),e.jsx(n,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:R(s.total,s.currency_code)})]}),e.jsxs("div",{className:"text-ui-fg-base flex items-center justify-between",children:[e.jsx(n,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:t("fields.paidTotal")}),e.jsx(n,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:"-"})]})]})},St=()=>{const s=Pe(),{id:t}=Se(),{order:a,isLoading:i,isError:r,error:l}=Ae(t,{fields:ie},{initialData:s});if(i||!a)return e.jsx("div",{children:"Loading..."});if(r)throw l;return e.jsxs("div",{className:"flex flex-col gap-y-3",children:[ms.widgets.map((c,d)=>e.jsx("div",{children:e.jsx(c.Component,{data:a})},d)),e.jsxs("div",{className:"flex flex-col gap-x-4 lg:flex-row xl:items-start",children:[e.jsxs("div",{className:"flex w-full flex-col gap-y-3",children:[e.jsx(Is,{order:a}),e.jsx(qs,{order:a}),e.jsx(Bs,{order:a}),e.jsx(Ps,{order:a}),os.widgets.map((c,d)=>e.jsx("div",{children:e.jsx(c.Component,{data:a})},d)),e.jsx("div",{className:"hidden xl:block",children:e.jsx(Q,{data:a})})]}),e.jsxs("div",{className:"mt-2 flex w-full max-w-[100%] flex-col gap-y-3 xl:mt-0 xl:max-w-[400px]",children:[xs.widgets.map((c,d)=>e.jsx("div",{children:e.jsx(c.Component,{data:a})},d)),e.jsx(Os,{order:a}),e.jsx(ys,{order:a}),us.widgets.map((c,d)=>e.jsx("div",{children:e.jsx(c.Component,{data:a})},d)),e.jsx("div",{className:"xl:hidden",children:e.jsx(Q,{data:a})})]})]}),e.jsx(Le,{})]})};export{St as Component,Pt as loader};
