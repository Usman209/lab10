import{u as A,a as z,b as E}from"./chunk-APWN266K-C65YEnYq.js";import{w as D,j as e,u as C,r as d,v as F,q as H,t as I,y as q}from"./index-DQ7iaOIo.js";import{u as B,D as M}from"./chunk-MOFW5DA3-BBRzwwAr.js";import"./lodash-BbEdBw2P.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{u as N,c as O}from"./chunk-YVTBRLIE-QBelkXWc.js";import{R as l,u as Q}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as K,H as L}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{t as V}from"./zod-DqtdDTUb.js";import{o as $,a as Z,s as J}from"./index-yuYasa5Y.js";import{B as y}from"./label-DsyTUQgE.js";import{C as S}from"./checkbox-BXdKf1Kl.js";import{c as U}from"./index-DW7vLJga.js";import"./chunk-C76H5USB-BzcnRuay.js";import"./chunk-IQRVIEMV-CAyGAynz.js";import"./chunk-P3UUX2T6-OlAXa1VC.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./plus-mini-DfhjBeEB.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./format-CJ2FegFx.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangle-left-mini-o3U9ykef.js";import"./chunk-RYVWLLZ2-CmEHdxLZ.js";import"./prompt-BKfKBHyN.js";import"./index-CIxKSFC7.js";var W=$({customer_group_ids:Z(J()).min(1)}),p=10,X=({customerId:a})=>{const{t:c}=C(),{handleSuccess:g}=Q(),[r,i]=d.useState(!1),u=K({defaultValues:{customer_group_ids:[]},resolver:V(W)}),{setValue:m}=u,[o,x]=d.useState({});d.useEffect(()=>{m("customer_group_ids",Object.keys(o).filter(s=>o[s]),{shouldDirty:!0,shouldTouch:!0})},[o,m]);const{searchParams:j,raw:_}=A({pageSize:p}),b=z(),{customer_groups:v,count:h,isPending:w,isError:P,error:T}=N({fields:"*customers",...j}),R=s=>{const t=typeof s=="function"?s(o):s,n=Object.keys(t);m("customer_group_ids",n,{shouldDirty:!0,shouldTouch:!0}),x(t)},f=ee(),{table:G}=B({data:v??[],columns:f,count:h,enablePagination:!0,enableRowSelection:s=>{var t;return!((t=s.original.customers)!=null&&t.map(n=>n.id).includes(a))},getRowId:s=>s.id,pageSize:p,rowSelection:{state:o,updater:R}}),k=u.handleSubmit(async s=>{i(!0);try{const t=s.customer_group_ids.map(n=>F.customerGroups.addCustomers(n,{customer_ids:[a]}));await Promise.all(t),await H.invalidateQueries({queryKey:O.lists()}),g(`/customers/${a}`)}catch(t){I.error(t.message)}finally{i(!1)}});if(P)throw T;return e.jsx(l.Form,{form:u,children:e.jsxs("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:k,children:[e.jsx(l.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[u.formState.errors.customer_group_ids&&e.jsx(L,{variant:"error",children:u.formState.errors.customer_group_ids.message}),e.jsx(l.Close,{asChild:!0,children:e.jsx(y,{variant:"secondary",size:"small",children:c("actions.cancel")})}),e.jsx(y,{type:"submit",variant:"primary",size:"small",isLoading:r,children:c("actions.save")})]})}),e.jsx(l.Body,{className:"size-full overflow-hidden",children:e.jsx(M,{table:G,columns:f,pageSize:p,count:h,filters:b,orderBy:["name","created_at","updated_at"],isLoading:w,layout:"fill",search:!0,queryObject:_,noRecords:{message:c("customers.groups.add.list.noRecordsMessage")}})})]})})},Y=U(),ee=()=>{const{t:a}=C(),c=E();return d.useMemo(()=>[Y.display({id:"select",header:({table:r})=>e.jsx(S,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:i=>r.toggleAllPageRowsSelected(!!i)}),cell:({row:r})=>{const i=!r.getCanSelect(),u=r.getIsSelected()||i,m=e.jsx(S,{checked:u,disabled:i,onCheckedChange:o=>r.toggleSelected(!!o),onClick:o=>{o.stopPropagation()}});return i?e.jsx(q,{content:a("customers.groups.alreadyAddedTooltip"),side:"right",children:m}):m}}),...c],[a,c])},Fe=()=>{const{id:a}=D();return e.jsx(l,{children:e.jsx(X,{customerId:a})})};export{Fe as Component};
