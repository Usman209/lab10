import{C as R}from"./chunk-IWBW3RD4-e8c8ZIRc.js";import{i as B}from"./chunk-54IEHX46-DWMq7yL7.js";import{H as A}from"./chunk-7OYLCEKK-C8uLZ1da.js";import{R as j,u as $}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as W,F as t,a as k}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{a as q,u as G}from"./chunk-2FB644HY-BHty38NP.js";import{d as J,j as e,u as M,r as p,t as L,H as K,T as O,I as Q}from"./index-DQ7iaOIo.js";import{t as U}from"./zod-DqtdDTUb.js";import{z as c}from"./index-yuYasa5Y.js";import{P as g}from"./progress-tabs-nihPaPnN.js";import{B as w}from"./label-DsyTUQgE.js";import{T as X}from"./textarea-BWm6luAN.js";import{S as n}from"./select-CYzOnLAx.js";import"./_baseIsEqual-DdDy9tKi.js";import"./index-LtR7LJbL.js";import"./folder-illustration-8yBiBsTN.js";import"./dots-six-BVceUXpb.js";import"./prompt-BKfKBHyN.js";import"./chunk-4N7PLYUW-DRfoew5M.js";import"./chunk-DMYZ6SLX-CvGU_oYL.js";import"./index-CIxKSFC7.js";import"./triangles-mini-BMU6OfpM.js";var Y=({form:r})=>{const{t:s}=M();return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsxs("div",{children:[e.jsx(K,{children:s("categories.create.header")}),e.jsx(O,{size:"small",className:"text-ui-fg-subtle",children:s("categories.create.hint")})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(t.Field,{control:r.control,name:"name",render:({field:a})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:s("fields.title")}),e.jsx(t.Control,{children:e.jsx(Q,{autoComplete:"off",...a})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:r.control,name:"handle",render:({field:a})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,tooltip:s("collections.handleTooltip"),children:s("fields.handle")}),e.jsx(t.Control,{children:e.jsx(A,{...a})}),e.jsx(t.ErrorMessage,{})]})})]}),e.jsx(t.Field,{control:r.control,name:"description",render:({field:a})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("fields.description")}),e.jsx(t.Control,{children:e.jsx(X,{...a})}),e.jsx(t.ErrorMessage,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(t.Field,{control:r.control,name:"status",render:({field:{ref:a,onChange:o,...l}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:s("categories.fields.status.label")}),e.jsx(t.Control,{children:e.jsxs(n,{...l,onValueChange:o,children:[e.jsx(n.Trigger,{ref:a,children:e.jsx(n.Value,{})}),e.jsxs(n.Content,{children:[e.jsx(n.Item,{value:"active",children:s("categories.fields.status.active")}),e.jsx(n.Item,{value:"inactive",children:s("categories.fields.status.inactive")})]})]})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:r.control,name:"visibility",render:({field:{ref:a,onChange:o,...l}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:s("categories.fields.visibility.label")}),e.jsx(t.Control,{children:e.jsxs(n,{...l,onValueChange:o,children:[e.jsx(n.Trigger,{ref:a,children:e.jsx(n.Value,{})}),e.jsxs(n.Content,{children:[e.jsx(n.Item,{value:"public",children:s("categories.fields.visibility.public")}),e.jsx(n.Item,{value:"internal",children:s("categories.fields.visibility.internal")})]})]})}),e.jsx(t.ErrorMessage,{})]})})]})]})})},N="new-item",Z=({form:r,shouldFreeze:s})=>{const[a,o]=p.useState([]),{product_categories:l,isPending:v,isError:y,error:f}=G({parent_category_id:"null",limit:9999,fields:"id,name,parent_category_id,rank,category_children",include_descendants_tree:!0},{refetchInterval:1/0}),h=k({control:r.control,name:"parent_category_id"}),i=k({control:r.control,name:"rank"}),x=k({control:r.control,name:"name"}),b=p.useMemo(()=>B(l??[],{id:N,name:x,parent_category_id:h,rank:i,category_children:null}),[l,x,h,i]),C=({parent_category_id:d,rank:_},S)=>{r.setValue("parent_category_id",d,{shouldDirty:!0,shouldTouch:!0}),r.setValue("rank",_,{shouldDirty:!0,shouldTouch:!0}),o(S)};if(y)throw f;return e.jsx(R,{value:s?a:b,onChange:C,enableDrag:d=>d.id===N,showBadge:d=>d.id===N,isLoading:v||!l})},H=c.object({name:c.string().min(1),description:c.string().optional(),handle:c.string().optional(),status:c.enum(["active","inactive"]),visibility:c.enum(["public","internal"])}),ee=c.object({rank:c.number().nullable(),parent_category_id:c.string().nullable()}).merge(H),te=({parentCategoryId:r})=>{var D,V;const{t:s}=M(),{handleSuccess:a}=$(),[o,l]=p.useState("details"),[v,y]=p.useState(!1),[f,h]=p.useState(!1),i=W({defaultValues:{name:"",description:"",handle:"",status:"active",visibility:"public",rank:r?0:null,parent_category_id:r},resolver:U(ee)}),x=m=>{if(m==="organize"){const{name:T,handle:I,description:F,status:z,visibility:E}=i.getValues(),u=H.safeParse({name:T,handle:I,description:F,status:z,visibility:E});if(!u.success){u.error.errors.forEach(P=>{i.setError(P.path.join("."),{type:"manual",message:P.message})});return}i.clearErrors(),y(!0)}l(m)},{mutateAsync:b,isPending:C}=q(),d=i.handleSubmit(m=>{const{visibility:T,status:I,parent_category_id:F,rank:z,...E}=m;h(!0),b({...E,parent_category_id:F??void 0,rank:z??void 0,is_active:I==="active",is_internal:T==="internal"},{onSuccess:({product_category:u})=>{L.success(s("categories.create.successToast",{name:u.name})),a(`/categories/${u.id}`)},onError:u=>{L.error(u.message),h(!1)}})}),_=(D=i.getFieldState("parent_category_id"))!=null&&D.isDirty||(V=i.getFieldState("rank"))!=null&&V.isDirty||o==="organize"?"in-progress":"not-started",S=v?"completed":"in-progress";return e.jsx(j.Form,{form:i,children:e.jsx(g,{value:o,onValueChange:m=>x(m),children:e.jsxs("form",{onSubmit:d,children:[e.jsx(j.Header,{children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("div",{className:"-my-2 w-fit border-l",children:e.jsxs(g.List,{className:"grid w-full grid-cols-4",children:[e.jsx(g.Trigger,{value:"details",status:S,children:s("categories.create.tabs.details")}),e.jsx(g.Trigger,{value:"organize",status:_,children:s("categories.create.tabs.organize")})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(j.Close,{asChild:!0,children:e.jsx(w,{size:"small",variant:"secondary",children:s("actions.cancel")})}),o==="organize"?e.jsx(w,{size:"small",variant:"primary",type:"submit",isLoading:C,children:s("actions.save")},"submit-btn"):e.jsx(w,{size:"small",variant:"primary",type:"button",onClick:()=>x("organize"),children:s("actions.continue")},"continue-btn")]})]})}),e.jsxs(j.Body,{children:[e.jsx(g.Content,{value:"details",children:e.jsx(Y,{form:i})}),e.jsx(g.Content,{value:"organize",children:e.jsx(Z,{form:i,shouldFreeze:f})})]})]})})})},Se=()=>{const[r]=J(),s=r.get("parent_category_id");return e.jsx(j,{children:e.jsx(te,{parentCategoryId:s})})};export{Se as Component};
