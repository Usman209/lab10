import{P as D}from"./chunk-AGUNF3MD-BO3tVJlQ.js";import{u as N,w as P,j as e,H as A,t as w,D as v,g as F,aM as E,T,n as M,X as k}from"./index-DQ7iaOIo.js";import"./chunk-MOFW5DA3-BBRzwwAr.js";import"./lodash-BbEdBw2P.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{c as G,e as H}from"./chunk-MSD3WROE-DDuIqIqG.js";import{u as O}from"./chunk-YVTBRLIE-QBelkXWc.js";import{a as d,u as I,b as z,c as m}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as R,b as B,F as r}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{t as V}from"./zod-DqtdDTUb.js";import{z as u}from"./index-yuYasa5Y.js";import{D as L}from"./date-picker-BsdoIRhX.js";import{B as _}from"./label-DsyTUQgE.js";import"./chunk-APWN266K-C65YEnYq.js";import"./chunk-C76H5USB-BzcnRuay.js";import"./chunk-IQRVIEMV-CAyGAynz.js";import"./chunk-P3UUX2T6-OlAXa1VC.js";import"./index-DW7vLJga.js";import"./checkbox-BXdKf1Kl.js";import"./index-CIxKSFC7.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./plus-mini-DfhjBeEB.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./format-CJ2FegFx.js";import"./_baseIsEqual-DdDy9tKi.js";import"./x-mark-mini-DjxzaqmQ.js";import"./chunk-4N7PLYUW-DRfoew5M.js";import"./chunk-DMYZ6SLX-CvGU_oYL.js";import"./chunk-RYVWLLZ2-CmEHdxLZ.js";import"./prompt-BKfKBHyN.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./triangle-left-mini-o3U9ykef.js";var X=u.object({ends_at:u.date().nullable(),starts_at:u.date().nullable(),customer_group_id:u.array(u.object({id:u.string(),name:u.string()}))}),C="cg",K=({priceList:c,customerGroups:f})=>{const{t:s}=N(),{handleSuccess:x}=I(),{setIsOpen:h}=z(),o=R({defaultValues:{ends_at:c.ends_at?new Date(c.ends_at):null,starts_at:c.starts_at?new Date(c.starts_at):null,customer_group_id:f},resolver:V(X)}),{fields:t,remove:p,append:j}=B({control:o.control,name:"customer_group_id",keyName:"cg_id"}),g=i=>{if(!i.length){o.setValue("customer_group_id",[]),h(C,!1);return}const l=i.map(a=>a.id),n=i.filter(a=>!t.some(S=>S.id===a.id));for(const a of t)l.includes(a.id)||p(t.indexOf(a));j(n),h(C,!1)},{mutateAsync:b}=H(c.id),y=o.handleSubmit(async i=>{var l,n;await b({starts_at:((l=i.starts_at)==null?void 0:l.toISOString())||null,ends_at:((n=i.ends_at)==null?void 0:n.toISOString())||null,rules:{customer_group_id:i.customer_group_id.map(a=>a.id)}},{onSuccess:()=>{w.success(s("priceLists.configuration.edit.successToast")),x()},onError:a=>w.error(a.message)})});return e.jsxs(d.Form,{form:o,children:[e.jsx(d.Description,{className:"sr-only",children:s("priceLists.configuration.edit.description")}),e.jsxs("form",{className:"flex flex-1 flex-col overflow-hidden",onSubmit:y,children:[e.jsxs(d.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsx(r.Field,{control:o.control,name:"starts_at",render:({field:i})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.startsAt.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.startsAt.hint")})]}),e.jsx(r.Control,{children:e.jsx(L,{granularity:"minute",shouldCloseOnSelect:!1,...i})})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(v,{}),e.jsx(r.Field,{control:o.control,name:"ends_at",render:({field:i})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.endsAt.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.endsAt.hint")})]}),e.jsx(r.Control,{children:e.jsx(L,{granularity:"minute",shouldCloseOnSelect:!1,...i})})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(v,{}),e.jsx(r.Field,{control:o.control,name:"customer_group_id",render:({field:i})=>e.jsxs(r.Item,{children:[e.jsxs("div",{children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.customerAvailability.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.customerAvailability.hint")})]}),e.jsx(r.Control,{children:e.jsxs("div",{className:F("bg-ui-bg-component shadow-elevation-card-rest transition-fg grid gap-1.5 rounded-xl py-1.5","aria-[invalid='true']:shadow-borders-error"),role:"application",ref:i.ref,children:[e.jsxs("div",{className:"text-ui-fg-subtle grid gap-1.5 px-1.5 md:grid-cols-2",children:[e.jsx("div",{className:"bg-ui-bg-field shadow-borders-base txt-compact-small rounded-md px-2 py-1.5",children:s("priceLists.fields.customerAvailability.attribute")}),e.jsx("div",{className:"bg-ui-bg-field shadow-borders-base txt-compact-small rounded-md px-2 py-1.5",children:s("operators.in")})]}),e.jsx("div",{className:"flex items-center gap-1.5 px-1.5",children:e.jsxs(m,{id:C,children:[e.jsx(m.Trigger,{asChild:!0,children:e.jsxs("button",{type:"button",className:"bg-ui-bg-field shadow-borders-base txt-compact-small text-ui-fg-muted flex flex-1 items-center gap-x-2 rounded-md px-2 py-1.5",children:[e.jsx(E,{}),s("priceLists.fields.customerAvailability.placeholder")]})}),e.jsx(m.Trigger,{asChild:!0,children:e.jsx(_,{variant:"secondary",children:s("actions.browse")})}),e.jsxs(m.Content,{children:[e.jsxs(m.Header,{children:[e.jsx(m.Title,{asChild:!0,children:e.jsx(A,{children:s("priceLists.fields.customerAvailability.header")})}),e.jsx(m.Description,{className:"sr-only",children:s("priceLists.fields.customerAvailability.hint")})]}),e.jsx(D,{type:"drawer",setState:g,state:t})]})]})}),t.length>0?e.jsxs("div",{className:"flex flex-col gap-y-1.5",children:[e.jsx(v,{variant:"dashed"}),e.jsx("div",{className:"flex flex-col gap-y-1.5 px-1.5",children:t.map((l,n)=>e.jsxs("div",{className:"bg-ui-bg-field-component shadow-borders-base flex items-center justify-between gap-2 rounded-md px-2 py-0.5",children:[e.jsx(T,{size:"small",leading:"compact",children:l.name}),e.jsx(M,{size:"small",variant:"transparent",type:"button",onClick:()=>p(n),children:e.jsx(k,{})})]},l.cg_id))})]}):null]})}),e.jsx(r.ErrorMessage,{})]})})]}),e.jsx(d.Footer,{className:"shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(_,{size:"small",variant:"secondary",children:s("actions.cancel")})}),e.jsx(_,{size:"small",type:"submit",children:s("actions.save")})]})})]})]})},Pe=()=>{const{t:c}=N(),{id:f}=P(),{price_list:s,isPending:x,isError:h,error:o}=G(f),t=s==null?void 0:s.rules.customer_group_id,{customer_groups:p,isPending:j,isError:g,error:b}=O({id:t},{enabled:!!(t!=null&&t.length)}),y=(p==null?void 0:p.map(n=>({id:n.id,name:n.name})))||[],i=x?!1:!(t!=null&&t.length&&j),l=!x&&!!s&&i;if(h)throw o;if(g)throw b;return e.jsxs(d,{children:[e.jsx(d.Header,{children:e.jsx(d.Title,{asChild:!0,children:e.jsx(A,{children:c("priceLists.configuration.edit.header")})})}),l&&e.jsx(K,{priceList:s,customerGroups:y})]})};export{Pe as Component};
