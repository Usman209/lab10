import{u as I}from"./chunk-YFWOU2UG-B6wOGF41.js";import{D as $}from"./chunk-FUHEDN6F-DJm8RBCj.js";import{w as D,N as k,j as i,u as A,m as G,r as S,o as H,t as E}from"./index-DQ7iaOIo.js";import"./index.esm-C23H4hs_.js";import{u as U}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{c as v}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{u as V,c as Z}from"./chunk-RJJ3HJT5-0qvBrSK4.js";import{R as u,u as P}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as q}from"./chunk-QHCOJC4V-B0UJ2So3.js";import{t as J}from"./zod-DqtdDTUb.js";import{o as K,r as R,s as d,n as w}from"./index-yuYasa5Y.js";import{B as b}from"./label-DsyTUQgE.js";import"./chunk-VZRDVNEY-twUt44Gw.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./chunk-GH77ZQI2-CyzKiLW4.js";import"./index-DW7vLJga.js";import"./index-LtR7LJbL.js";import"./chunk-3UMDCRM2-NSGJIubw.js";import"./prompt-BKfKBHyN.js";var Q=e=>{const s={};return e.forEach(r=>{r.price_rules.length||(s[r.currency_code]=r.amount)}),s},W=e=>{const s={};return e.forEach(r=>{if(r.price_rules.length){const n=r.price_rules[0].value;s[n]=r.amount}}),s},X=K({region_prices:R(d(),d().or(w()).optional()),currency_prices:R(d(),d().or(w()).optional())});function Y({shippingOption:e}){const{t:s}=A(),{handleSuccess:r}=P(),n=U({defaultValues:{region_prices:W(e.prices),currency_prices:Q(e.prices)},resolver:J(X)}),{mutateAsync:a,isPending:m}=Z(e.id),{store:p,isLoading:rr,isError:C,error:O}=G(),l=S.useMemo(()=>{var c;return((c=p==null?void 0:p.supported_currencies)==null?void 0:c.map(g=>g.currency_code))||[]},[p]),{regions:f,isLoading:er,isError:L,error:N}=q({fields:"id,name,currency_code",limit:999}),{price_preferences:T}=H({}),{setCloseOnEscape:F}=P(),M=I({currencies:l,regions:f,pricePreferences:T}),z=S.useMemo(()=>[[...l||[],...f||[]]],[l,f]),y=n.handleSubmit(async c=>{const g=Object.entries(c.currency_prices).map(([o,t])=>{if(t===""||t===void 0)return;const h=v(t),x={currency_code:o,amount:h},j=e.prices.find(_=>_.currency_code===o&&!_.price_rules.length);return j&&(x.id=j.id),x}).filter(o=>!!o),B=Object.entries(c.region_prices).map(([o,t])=>{if(t===""||t===void 0)return;const h=v(t);return{region_id:o,amount:h}}).filter(o=>!!o);await a({prices:[...g,...B]},{onSuccess:()=>{E.success(s("general.success")),r()},onError:o=>{E.error(o.message)}})});if(C)throw O;if(L)throw N;return i.jsx(u.Form,{form:n,children:i.jsxs("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:y,children:[i.jsx(u.Header,{children:i.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[i.jsx(u.Close,{asChild:!0,children:i.jsx(b,{variant:"secondary",size:"small",children:s("actions.cancel")})}),i.jsx(b,{size:"small",className:"whitespace-nowrap",isLoading:m,onClick:y,type:"button",children:s("actions.save")})]})}),i.jsx(u.Body,{children:i.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:i.jsx($,{data:z,columns:M,state:n,onEditingChange:c=>F(!c)})})})]})})}function Sr(){const{so_id:e,location_id:s}=D(),{shipping_options:r,isPending:n}=V({id:[e],fields:"*prices,*prices.price_rules"}),a=r==null?void 0:r.find(m=>m.id===e);if(!n&&!a)throw k(`Shipping option with id: ${e} not found`,{status:404});return i.jsx(u,{prev:`/settings/locations/${s}`,children:a&&i.jsx(Y,{shippingOption:a})})}export{Sr as Component};
