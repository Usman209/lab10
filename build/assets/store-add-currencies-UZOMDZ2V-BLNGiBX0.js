import{u as V,a as K,b as L}from"./chunk-WL3E5WGF-DlT5cRnz.js";import{m as O,o as U,j as e,u as I,r as j,cq as G,t as T,q as X,bM as Z,y as $,k as J}from"./index-DQ7iaOIo.js";import{u as W,D as Y}from"./chunk-MOFW5DA3-BBRzwwAr.js";import"./lodash-BbEdBw2P.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{R as h,u as ee}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as re,H as se}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{o as te,a as oe,s as ie,r as ce,b as ae}from"./index-yuYasa5Y.js";import{t as ne}from"./zod-DqtdDTUb.js";import{B as k}from"./label-DsyTUQgE.js";import{C as R}from"./checkbox-BXdKf1Kl.js";import{S as le}from"./switch-CHhgpYt_.js";import{c as de}from"./index-DW7vLJga.js";import"./chunk-IQRVIEMV-CAyGAynz.js";import"./chunk-P3UUX2T6-OlAXa1VC.js";import"./chunk-C76H5USB-BzcnRuay.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./plus-mini-DfhjBeEB.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./format-CJ2FegFx.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangle-left-mini-o3U9ykef.js";import"./prompt-BKfKBHyN.js";import"./index-CIxKSFC7.js";var ue=te({currencies:oe(ie()).min(1),pricePreferences:ce(ae())}),E=50,S="ac",me=({store:t,pricePreferences:n})=>{var b;const{t:c}=I(),{handleSuccess:m}=ee(),{raw:s,searchParams:i}=V({pageSize:50,prefix:S}),{currencies:l,count:a,isPending:d,isError:x,error:y}=K(i,{placeholderData:J}),p=re({defaultValues:{currencies:[],pricePreferences:n==null?void 0:n.reduce((r,o)=>(o.value&&(r[o.value]=o.is_tax_inclusive),r),{})},resolver:ne(ue)}),[v,N]=j.useState({}),{setValue:g,watch:D}=p,q=D("pricePreferences"),z=r=>{const o=typeof r=="function"?r(v):r,f=Object.keys(o);g("currencies",f,{shouldDirty:!0,shouldTouch:!0}),N(o)},C=((b=t.supported_currencies)==null?void 0:b.map(r=>r.currency_code))??[],F=j.useCallback(r=>{g("pricePreferences",r)},[g]),P=pe(q,F),{table:H}=W({data:l??[],columns:P,count:a,getRowId:r=>r.code,enableRowSelection:r=>!C.includes(r.original.code),enablePagination:!0,pageSize:E,prefix:S,rowSelection:{state:v,updater:z}}),{mutateAsync:B,isPending:M}=G(t.id),Q=p.handleSubmit(async r=>{var w,_;const o=Array.from(new Set([...r.currencies,...C]));let f=(_=(w=t.supported_currencies)==null?void 0:w.find(u=>u.is_default))==null?void 0:_.currency_code;o.includes(f??"")||(f=o==null?void 0:o[0]),await B({supported_currencies:o.map(u=>({currency_code:u,is_default:u===f,is_tax_inclusive:r.pricePreferences[u]}))},{onSuccess:()=>{T.success(c("store.toast.currenciesUpdated")),X.invalidateQueries({queryKey:Z.all}),m()},onError:u=>{T.error(u.message)}})});if(x)throw y;return e.jsx(h.Form,{form:p,children:e.jsxs("form",{onSubmit:Q,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(h.Header,{children:e.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[e.jsx("div",{className:"flex items-center",children:p.formState.errors.currencies&&e.jsx(se,{variant:"error",children:p.formState.errors.currencies.message})}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(h.Close,{asChild:!0,children:e.jsx(k,{size:"small",variant:"secondary",children:c("actions.cancel")})}),e.jsx(k,{size:"small",type:"submit",isLoading:M,children:c("actions.save")})]})]})}),e.jsx(h.Body,{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx(Y,{table:H,pageSize:E,count:a,columns:P,layout:"fill",pagination:!0,search:!0,prefix:S,orderBy:["code","name"],isLoading:d,queryObject:s})})]})})},A=de(),pe=(t,n)=>{const{t:c}=I(),m=L();return j.useMemo(()=>[A.display({id:"select",header:({table:s})=>e.jsx(R,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:i=>s.toggleAllPageRowsSelected(!!i)}),cell:({row:s})=>{const i=!s.getCanSelect(),l=s.getIsSelected()||i,a=e.jsx(R,{checked:l,disabled:i,onCheckedChange:d=>s.toggleSelected(!!d),onClick:d=>{d.stopPropagation()}});return i?e.jsx($,{content:c("store.currencyAlreadyAdded"),side:"right",children:a}):a}}),...m,A.display({id:"select",header:()=>e.jsx("div",{className:"whitespace-nowrap",children:c("fields.taxInclusivePricing")}),cell:({row:s})=>{const i=!s.getCanSelect(),l=t[s.original.code];return e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(le,{disabled:i,checked:l??!1,onCheckedChange:a=>{n({...t,[s.original.code]:a})}})})}})],[c,m,t,n])},Ge=()=>{var x;const{store:t,isPending:n,isError:c,error:m}=O(),{price_preferences:s,isPending:i,isError:l,error:a}=U({attribute:"currency_code",value:(x=t==null?void 0:t.supported_currencies)==null?void 0:x.map(y=>y.currency_code)},{enabled:!!t}),d=!!t&&!n&&!!s&&!i;if(c)throw m;if(l)throw a;return e.jsx(h,{children:d&&e.jsx(me,{store:t,pricePreferences:s})})};export{Ge as Component};
