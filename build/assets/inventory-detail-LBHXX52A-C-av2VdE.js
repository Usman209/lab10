import{I as E}from"./chunk-LX4JNAOB-CU2Xgz-I.js";import{g as Q}from"./chunk-OIAPXGI2-CCQfJ697.js";import{S as d}from"./chunk-ULQT3HE4-paLl-SNk.js";import{J as S}from"./chunk-3IW4HYUP-DTbTbYs9.js";import{T as H}from"./chunk-PHMALPVO-BXYfPvrg.js";import{u as M,D as T}from"./chunk-MOFW5DA3-BBRzwwAr.js";import{w as J,h as $,j as e,N as B,O as F,q,u as l,C as y,H as j,A as w,L as P,b as G,n as K,s as V,r as _,y as W,t as L}from"./index-DQ7iaOIo.js";import"./lodash-BbEdBw2P.js";import{P as o}from"./chunk-P3UUX2T6-OlAXa1VC.js";import{u as z}from"./chunk-C76H5USB-BzcnRuay.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{b as Y,i as Z,e as U,f as X}from"./chunk-DMYZ6SLX-CvGU_oYL.js";import{b as ee}from"./chunk-3UMDCRM2-NSGJIubw.js";import{u as te,b as se}from"./chunk-KWVVOB4B-Ch3DSjg4.js";import{f as k}from"./format-CJ2FegFx.js";import{P as I}from"./pencil-square-C2dQ88SM.js";import{A as ae}from"./arrow-up-right-on-box-CErxVq_8.js";import{T as C}from"./trash-AHlgA58B.js";import{u as D}from"./use-prompt-DSUtE_64.js";import{B as A}from"./label-DsyTUQgE.js";import{c as O}from"./index-DW7vLJga.js";import"./Trans-LG4CmYWt.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangle-down-mini-CMQwg4p-.js";import"./square-two-stack-0Hf-pV3m.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./plus-mini-DfhjBeEB.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./triangle-left-mini-o3U9ykef.js";import"./prompt-BKfKBHyN.js";var ie=({inventoryItem:s})=>{const{t}=l();return e.jsxs(y,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(j,{level:"h2",children:t("products.attributes")}),e.jsx(w,{groups:[{actions:[{label:t("actions.edit"),to:"attributes",icon:e.jsx(I,{})}]}]})]}),e.jsx(d,{title:t("fields.height"),value:s.height}),e.jsx(d,{title:t("fields.width"),value:s.width}),e.jsx(d,{title:t("fields.length"),value:s.length}),e.jsx(d,{title:t("fields.weight"),value:s.weight}),e.jsx(d,{title:t("fields.midCode"),value:s.mid_code}),e.jsx(d,{title:t("fields.hsCode"),value:s.hs_code}),e.jsx(d,{title:t("fields.countryOfOrigin"),value:Q(s.origin_country)})]})},re=({pageSize:s=20,prefix:t})=>{const a=z(["id","location_id","stocked_quantity","reserved_quantity","incoming_quantity","available_quantity","*stock_locations"],t),{reserved_quantity:i,stocked_quantity:r,available_quantity:n,...c}=a;return{searchParams:{limit:s,reserved_quantity:i?JSON.parse(i):void 0,stocked_quantity:r?JSON.parse(r):void 0,available_quantity:n?JSON.parse(n):void 0,...c},raw:a}},ne=({level:s})=>{const{t}=l(),a=D(),{mutateAsync:i}=X(s.inventory_item_id,s.location_id),r=async()=>{await a({title:t("general.areYouSure"),description:t("inventory.deleteWarning"),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await i()};return e.jsx(w,{groups:[{actions:[{icon:e.jsx(I,{}),label:t("actions.edit"),to:`locations/${s.location_id}`}]},{actions:[{icon:e.jsx(C,{}),label:t("actions.delete"),onClick:r}]}]})},v=O(),oe=()=>{const{t:s}=l();return _.useMemo(()=>[v.accessor("stock_locations.0.name",{header:s("fields.location"),cell:({getValue:t})=>{const a=t();return a?e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a.toString()})}):e.jsx(o,{})}}),v.accessor("reserved_quantity",{header:s("inventory.reserved"),cell:({getValue:t})=>{const a=t();return Number.isNaN(a)?e.jsx(o,{}):e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a})})}}),v.accessor("stocked_quantity",{header:s("fields.inStock"),cell:({getValue:t})=>{const a=t();return Number.isNaN(a)?e.jsx(o,{}):e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a})})}}),v.accessor("available_quantity",{header:s("inventory.available"),cell:({getValue:t})=>{const a=t();return Number.isNaN(a)?e.jsx(o,{}):e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a})})}}),v.display({id:"actions",cell:({row:t})=>e.jsx(ne,{level:t.original})})],[s])},N=20,le=({inventory_item_id:s})=>{const{searchParams:t,raw:a}=re({pageSize:N}),{inventory_levels:i,count:r,isPending:n,isError:c,error:f}=U(s,{...t,fields:"*stock_locations"}),u=oe(),{table:g}=M({data:i??[],columns:u,count:r,enablePagination:!0,getRowId:h=>h.id,pageSize:N});if(c)throw f;return e.jsx(T,{table:g,columns:u,pageSize:N,count:r,isLoading:n,pagination:!0,queryObject:a})},ce=({inventoryItem:s})=>{const{t}=l();return e.jsxs(y,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(j,{children:t("inventory.locationLevels")}),e.jsx(A,{size:"small",variant:"secondary",asChild:!0,children:e.jsx(P,{to:"locations",children:t("inventory.manageLocations")})})]}),e.jsx(le,{inventory_item_id:s.id})]})},de=({reservation:s})=>{const{t}=l(),a=D(),{mutateAsync:i}=se(s.id),r=async()=>{await a({title:t("general.areYouSure"),description:t("inventory.deleteWarning"),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await i(void 0,{onSuccess:()=>{L.success(t("inventory.reservation.deleteSuccessToast"))},onError:c=>{L.error(c.message)}})};return e.jsx(w,{groups:[{actions:[{icon:e.jsx(I,{}),label:t("actions.edit"),to:`/reservations/${s.id}/edit`}]},{actions:[{icon:e.jsx(C,{}),label:t("actions.delete"),onClick:r}]}]})},me=({date:s})=>{if(!s)return e.jsx(o,{});const t=new Date(s);t.setMinutes(t.getMinutes()-t.getTimezoneOffset());const i=Intl.DateTimeFormat().resolvedOptions().hour12?"dd MMM yyyy hh:MM a":"dd MMM yyyy HH:MM";return e.jsx("div",{className:"flex h-full w-full items-center overflow-hidden",children:e.jsx(W,{className:"z-10",content:e.jsx("span",{className:"text-pretty",children:`${k(t,i)}`}),children:e.jsx("span",{className:"truncate",children:k(t,"dd MMM yyyy")})})})},m=O(),ue=({sku:s})=>{const{t}=l();return _.useMemo(()=>[m.display({header:t("fields.sku"),cell:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:s})})}),m.accessor("line_item.order_id",{header:t("inventory.reservation.orderID"),cell:({getValue:a})=>{const i=a();return i?e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:i})}):e.jsx(o,{})}}),m.accessor("description",{header:t("fields.description"),cell:({getValue:a})=>{const i=a();return i?e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:i})}):e.jsx(o,{})}}),m.accessor("location.name",{header:t("inventory.reservation.location"),cell:({getValue:a})=>{const i=a();return i?e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:i})}):e.jsx(o,{})}}),m.accessor("created_at",{header:t("fields.createdAt"),cell:({getValue:a})=>e.jsx(me,{date:a()})}),m.display({id:"actions",cell:({row:a})=>e.jsx(de,{reservation:a.original})})],[t])},xe=({pageSize:s=20,prefix:t})=>{const a=z(["id","location_id","inventory_item_id","quantity","line_item_id","description","created_by"],t),{quantity:i,...r}=a;return{searchParams:{limit:s,quantity:i?JSON.parse(i):void 0,...r},raw:a}},b=20,pe=({inventoryItem:s})=>{const{searchParams:t,raw:a}=xe({pageSize:b}),{reservations:i,count:r,isPending:n,isError:c,error:f}=te({...t,inventory_item_id:[s.id]}),{stock_locations:u}=ee({id:(i||[]).map(x=>x.location_id)}),g=_.useMemo(()=>{const x=new Map((u||[]).map(p=>[p.id,p]));return(i||[]).map(p=>({...p,location:x.get(p.location_id)}))},[i,u]),h=ue({sku:s.sku}),{table:R}=M({data:g??[],columns:h,count:r,enablePagination:!0,getRowId:x=>x.id,pageSize:b});if(c)throw f;return e.jsx(T,{table:R,columns:h,pageSize:b,count:r,isLoading:n,pagination:!0,queryObject:a})},ve=({inventoryItem:s})=>{const{t}=l();return e.jsxs(y,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(j,{children:t("reservations.domain")}),e.jsx(A,{size:"small",variant:"secondary",asChild:!0,children:e.jsx(P,{to:`/reservations/create?item_id=${s.id}`,children:t("actions.create")})})]}),e.jsx(pe,{inventoryItem:s})]})},fe=({variants:s})=>{const{t}=l(),a=G();return s!=null&&s.length?e.jsxs(y,{className:"p-0",children:[e.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:e.jsx(j,{level:"h2",children:t("inventory.associatedVariants")})}),e.jsx("div",{className:"txt-small flex flex-col gap-2 px-2 pb-2",children:s.map(i=>{var r;return e.jsx("div",{className:"shadow-elevation-card-rest bg-ui-bg-component rounded-md px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"shadow-elevation-card-rest rounded-md",children:e.jsx(H,{src:(r=i.product)==null?void 0:r.thumbnail})}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx("span",{className:"text-ui-fg-base font-medium",children:i.title}),e.jsx("span",{className:"text-ui-fg-subtle",children:i.options.map(n=>n.value).join(" â‹… ")})]}),e.jsx(K,{size:"2xsmall",variant:"transparent",type:"button",onClick:()=>a(`/products/${i.product.id}/variants/${i.id}`),children:e.jsx(ae,{className:"text-ui-fg-muted"})})]})},i.id)})})]}):null},at=()=>{const{id:s}=J(),t=$(),{inventory_item:a,isPending:i,isError:r,error:n}=Y(s,{fields:"*variants,*variants.product,*variants.options"},{initialData:t});if(i)return e.jsx("div",{children:"Loading..."});if(r||!a)throw n||B("An unknown error occurred",500);return e.jsx("div",{className:"flex flex-col gap-y-2",children:e.jsxs("div",{className:"flex flex-col gap-x-4 lg:flex-row lg:items-start",children:[e.jsxs("div",{className:"flex w-full flex-col gap-y-3",children:[e.jsx(E,{inventoryItem:a}),e.jsx(ce,{inventoryItem:a}),e.jsx(ve,{inventoryItem:a}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(S,{data:a})}),e.jsx(F,{})]}),e.jsxs("div",{className:"mt-2 flex w-full max-w-[100%] flex-col gap-y-2 lg:mt-0 lg:max-w-[400px]",children:[e.jsx(fe,{variants:a.variants}),e.jsx(ie,{inventoryItem:a}),e.jsx("div",{className:"lg:hidden",children:e.jsx(S,{data:a})})]})]})})},he=s=>({queryKey:Z.detail(s),queryFn:async()=>V.admin.inventoryItem.retrieve(s,{fields:"*variants,*variants.product,*variants.options"})}),it=async({params:s})=>{const t=s.id,a=he(t);return q.getQueryData(a.queryKey)??await q.fetchQuery(a)};export{at as Component,it as loader};
