import{u as D,a as N,b as q}from"./chunk-NOAFLTPV-B2feSq4-.js";import{L}from"./chunk-I3VB6NM2-DUTkn0yW.js";import{f as z}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{S as f}from"./chunk-ULQT3HE4-paLl-SNk.js";import{J as Q}from"./chunk-3IW4HYUP-DTbTbYs9.js";import{c as H}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{u as O,D as B}from"./chunk-MOFW5DA3-BBRzwwAr.js";import{q as w,h as K,w as M,o as W,j as s,O as Y,s as G,u as v,r as _,C as P,H as R,A as h,B as J,T as U,b as F,t as d}from"./index-DQ7iaOIo.js";import"./lodash-BbEdBw2P.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{c as V,r as X,d as E,a as Z}from"./chunk-QHCOJC4V-B0UJ2So3.js";import{P as $}from"./plus-mini-DfhjBeEB.js";import{P as ee}from"./pencil-square-C2dQ88SM.js";import{T as k}from"./trash-AHlgA58B.js";import{u as C}from"./use-prompt-DSUtE_64.js";import{C as b}from"./checkbox-BXdKf1Kl.js";import{c as se}from"./index-DW7vLJga.js";import"./chunk-C76H5USB-BzcnRuay.js";import"./arrow-up-right-on-box-CErxVq_8.js";import"./Trans-LG4CmYWt.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangle-down-mini-CMQwg4p-.js";import"./square-two-stack-0Hf-pV3m.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./label-DsyTUQgE.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./format-CJ2FegFx.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./triangle-left-mini-o3U9ykef.js";import"./prompt-BKfKBHyN.js";import"./index-CIxKSFC7.js";const te={widgets:[]},re={widgets:[]};var ie=r=>({queryKey:X.detail(r),queryFn:async()=>G.admin.region.retrieve(r,{fields:"*payment_providers"})}),Ve=async({params:r})=>{const t=r.id,e=ie(t);return w.getQueryData(e.queryKey)??await w.fetchQuery(e)},y="c",j=10,oe=({region:r})=>{const{t}=v(),e=C(),[i,a]=_.useState({}),{searchParams:o,raw:m}=D({pageSize:j,prefix:y}),{countries:c,count:n}=N({countries:r.countries||[],...o}),u=ne(),{table:p}=O({data:c||[],columns:u,count:n,enablePagination:!0,enableRowSelection:!0,getRowId:x=>x.iso_2,pageSize:j,rowSelection:{state:i,updater:a},prefix:y,meta:{region:r}}),{mutateAsync:g}=E(r.id),A=async()=>{var S;const x=Object.keys(i).filter(l=>i[l]);if(!await e({title:t("general.areYouSure"),description:t("regions.removeCountriesWarning",{count:x.length}),verificationText:t("actions.remove"),verificationInstruction:t("general.typeToConfirm"),cancelText:t("actions.cancel"),confirmText:t("actions.remove")}))return;const I=(S=r.countries)==null?void 0:S.filter(l=>!x.includes(l.iso_2)).map(l=>l.iso_2);await g({countries:I},{onSuccess:()=>{d.success(t("regions.toast.countries"))},onError:l=>{d.error(l.message)}})};return s.jsxs(P,{className:"divide-y p-0",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsx(R,{level:"h2",children:t("fields.countries")}),s.jsx(h,{groups:[{actions:[{label:t("regions.addCountries"),icon:s.jsx($,{}),to:"countries/add"}]}]})]}),s.jsx(B,{table:p,columns:u,pageSize:j,count:n,orderBy:["name","code"],search:!0,pagination:!0,queryObject:m,prefix:y,commands:[{action:A,label:t("actions.remove"),shortcut:"r"}]})]})},ae=({country:r,region:t})=>{var c;const{t:e}=v(),i=C(),{mutateAsync:a}=E(t.id),o=(c=t.countries)==null?void 0:c.filter(n=>n.iso_2!==r.iso_2).map(n=>n.iso_2),m=async()=>{await i({title:e("general.areYouSure"),description:e("regions.removeCountryWarning",{name:r.display_name}),verificationText:r.display_name,verificationInstruction:e("general.typeToConfirm"),cancelText:e("actions.cancel"),confirmText:e("actions.remove")})&&await a({countries:o},{onSuccess:()=>{d.success(e("regions.toast.countries"))},onError:u=>{d.error(u.message)}})};return s.jsx(h,{groups:[{actions:[{label:e("actions.remove"),onClick:m,icon:s.jsx(k,{})}]}]})},T=se(),ne=()=>{const r=q();return _.useMemo(()=>[T.display({id:"select",header:({table:t})=>s.jsx(b,{checked:t.getIsSomePageRowsSelected()?"indeterminate":t.getIsAllPageRowsSelected(),onCheckedChange:e=>t.toggleAllPageRowsSelected(!!e)}),cell:({row:t})=>s.jsx(b,{checked:t.getIsSelected(),onCheckedChange:e=>t.toggleSelected(!!e),onClick:e=>{e.stopPropagation()}})}),...r,T.display({id:"actions",cell:({row:t,table:e})=>{const{region:i}=e.options.meta;return s.jsx(ae,{country:t.original,region:i})}})],[r])},ce=({region:r,pricePreferences:t})=>{var a;const{t:e}=v(),i=t==null?void 0:t.find(o=>o.attribute==="region_id"&&o.value===r.id);return s.jsxs(P,{className:"divide-y p-0",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[s.jsx(R,{children:r.name}),s.jsx(le,{region:r})]}),s.jsx(f,{title:e("fields.currency"),value:s.jsxs("div",{className:"flex items-center gap-x-2",children:[s.jsx(J,{size:"2xsmall",className:"uppercase",children:r.currency_code}),s.jsx(U,{size:"small",leading:"compact",children:H[r.currency_code.toUpperCase()].name})]})}),s.jsx(f,{title:e("fields.automaticTaxes"),value:r.automatic_taxes?e("fields.true"):e("fields.false")}),s.jsx(f,{title:e("fields.taxInclusivePricing"),value:i!=null&&i.is_tax_inclusive?e("fields.true"):e("fields.false")}),s.jsx(f,{title:e("fields.paymentProviders"),value:s.jsx("div",{className:"inline-flex",children:(a=r.payment_providers)!=null&&a.length?s.jsx(L,{list:r.payment_providers.map(o=>z(o.id))}):"-"})})]})},le=({region:r})=>{const t=F(),{t:e}=v(),{mutateAsync:i}=Z(r.id),a=C(),o=async()=>{await a({title:e("general.areYouSure"),description:e("regions.deleteRegionWarning",{name:r.name}),verificationText:r.name,verificationInstruction:e("general.typeToConfirm"),confirmText:e("actions.delete"),cancelText:e("actions.cancel")})&&await i(void 0,{onSuccess:()=>{d.success(e("regions.toast.delete")),t("/settings/regions",{replace:!0})},onError:c=>{d.error(c.message)}})};return s.jsx(h,{groups:[{actions:[{icon:s.jsx(ee,{}),label:e("actions.edit"),to:`/settings/regions/${r.id}/edit`}]},{actions:[{icon:s.jsx(k,{}),label:e("actions.delete"),onClick:o}]}]})},Xe=()=>{const r=K(),{id:t}=M(),{region:e,isPending:i,isError:a,error:o}=V(t,{fields:"*payment_providers,*countries"},{initialData:r}),{price_preferences:m,isPending:c,isError:n,error:u}=W({attribute:"region_id",value:t},{enabled:!!e});if(i||c||!e)return s.jsx("div",{children:"Loading..."});if(a)throw o;if(n)throw u;return s.jsxs("div",{className:"flex flex-col gap-y-2",children:[re.widgets.map((p,g)=>s.jsx("div",{children:s.jsx(p.Component,{data:e})},g)),s.jsx(ce,{region:e,pricePreferences:m??[]}),s.jsx(oe,{region:e}),te.widgets.map((p,g)=>s.jsx("div",{children:s.jsx(p.Component,{data:e})},g)),s.jsx(Q,{data:e}),s.jsx(Y,{})]})};export{Xe as Component,Ve as loader};
