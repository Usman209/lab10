import{u as _,a as A,b as E}from"./chunk-APWN266K-C65YEnYq.js";import{S as I}from"./chunk-FGHVNTU2-B17BbdmQ.js";import"./chunk-3IW4HYUP-DTbTbYs9.js";import{w as Q,h as L,j as e,cl as M,q as f,u as S,b as B,C as b,H as T,A as P,T as d,r as k,k as K,aC as a,L as O,s as H,t as p,v as F}from"./index-DQ7iaOIo.js";import{u as $,D as J}from"./chunk-MOFW5DA3-BBRzwwAr.js";import"./lodash-BbEdBw2P.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{u as Y,c as Z,a as U}from"./chunk-YVTBRLIE-QBelkXWc.js";import{b as V,d as W}from"./chunk-RYVWLLZ2-CmEHdxLZ.js";import{p as X}from"./chunk-4N7PLYUW-DRfoew5M.js";import{P as G}from"./pencil-square-C2dQ88SM.js";import{T as R}from"./trash-AHlgA58B.js";import{u as y}from"./use-prompt-DSUtE_64.js";import{S as ee}from"./status-badge-CrS-Pq0N.js";import{B as se}from"./label-DsyTUQgE.js";import{C}from"./checkbox-BXdKf1Kl.js";import{c as te}from"./index-DW7vLJga.js";import"./chunk-C76H5USB-BzcnRuay.js";import"./chunk-IQRVIEMV-CAyGAynz.js";import"./chunk-P3UUX2T6-OlAXa1VC.js";import"./arrow-up-right-on-box-CErxVq_8.js";import"./Trans-LG4CmYWt.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangle-down-mini-CMQwg4p-.js";import"./square-two-stack-0Hf-pV3m.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./plus-mini-DfhjBeEB.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./format-CJ2FegFx.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./triangle-left-mini-o3U9ykef.js";import"./chunk-DMYZ6SLX-CvGU_oYL.js";import"./prompt-BKfKBHyN.js";import"./index-CIxKSFC7.js";const re={widgets:[]},oe={widgets:[]};var ae=({customer:s})=>{const{t}=S(),r=y(),o=B(),{mutateAsync:i}=W(s.id),n=[s.first_name,s.last_name].filter(Boolean).join(" "),c=s.has_account?"green":"orange",m=s.has_account?t("customers.fields.registered"):t("customers.fields.guest"),g=async()=>{await r({title:t("customers.delete.title"),description:t("customers.delete.description",{email:s.email}),verificationInstruction:t("general.typeToConfirm"),verificationText:s.email,confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await i(void 0,{onSuccess:()=>{p.success(t("customers.delete.successToast",{email:s.email})),o("/customers",{replace:!0})},onError:x=>{p.error(x.message)}})};return e.jsxs(b,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(T,{children:s.email}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(ee,{color:c,children:m}),e.jsx(P,{groups:[{actions:[{label:t("actions.edit"),icon:e.jsx(G,{}),to:"edit"}]},{actions:[{label:t("actions.delete"),icon:e.jsx(R,{}),onClick:g}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(d,{size:"small",leading:"compact",weight:"plus",children:t("fields.name")}),e.jsx(d,{size:"small",leading:"compact",children:n||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(d,{size:"small",leading:"compact",weight:"plus",children:t("fields.company")}),e.jsx(d,{size:"small",leading:"compact",children:s.company_name||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(d,{size:"small",leading:"compact",weight:"plus",children:t("fields.phone")}),e.jsx(d,{size:"small",leading:"compact",children:s.phone||"-"})]})]})},h=10,ie=({customer:s})=>{const t=y(),[r,o]=k.useState({}),{raw:i,searchParams:n}=_({pageSize:h}),{customer_groups:c,count:m,isLoading:g,isError:j,error:x}=Y({...n,fields:"+customers.id",customers:{id:s.id}},{placeholderData:K}),D=A(),v=ce(s.id),{table:N}=$({data:c??[],columns:v,count:m,getRowId:u=>u.id,enablePagination:!0,enableRowSelection:!0,pageSize:h,rowSelection:{state:r,updater:o}}),z=async()=>{const u=Object.keys(r);if(await t({title:a("general.areYouSure"),description:a("customers.groups.removeMany",{groups:c==null?void 0:c.filter(l=>u.includes(l.id)).map(l=>l.name).join(",")}),confirmText:a("actions.remove"),cancelText:a("actions.cancel")}))try{const l=u.map(q=>F.customerGroups.removeCustomers(q,{customer_ids:[s.id]}));await Promise.all(l),await f.invalidateQueries({queryKey:Z.lists()})}catch(l){p.error(l.message)}};if(j)throw x;return e.jsxs(b,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(T,{level:"h2",children:a("customerGroups.domain")}),e.jsx(O,{to:`/customers/${s.id}/add-customer-groups`,children:e.jsx(se,{variant:"secondary",size:"small",children:a("general.add")})})]}),e.jsx(J,{table:N,columns:v,pageSize:h,isLoading:g,count:m,navigateTo:u=>`/customer-groups/${u.id}`,filters:D,search:!0,pagination:!0,orderBy:["name","created_at","updated_at"],commands:[{action:z,label:a("actions.remove"),shortcut:"r"}],queryObject:i,noRecords:{message:a("customers.groups.list.noRecordsMessage")}})]})},ne=({group:s,customerId:t})=>{const r=y(),{t:o}=S(),{mutateAsync:i}=U(s.id),n=async()=>{await r({title:o("general.areYouSure"),description:o("customers.groups.remove",{name:s.name}),confirmText:o("actions.remove"),cancelText:o("actions.cancel")})&&await i({customer_ids:[t]},{onError:m=>{p.error(m.message)}})};return e.jsx(P,{groups:[{actions:[{label:o("actions.edit"),icon:e.jsx(G,{}),to:`/customer-groups/${s.id}/edit`},{label:o("actions.remove"),onClick:n,icon:e.jsx(R,{})}]}]})},w=te(),ce=s=>{const t=E();return k.useMemo(()=>[w.display({id:"select",header:({table:r})=>e.jsx(C,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:o=>r.toggleAllPageRowsSelected(!!o)}),cell:({row:r})=>e.jsx(C,{checked:r.getIsSelected(),onCheckedChange:o=>r.toggleSelected(!!o),onClick:o=>{o.stopPropagation()}})}),...t,w.display({id:"actions",cell:({row:r})=>e.jsx(ne,{group:r.original,customerId:s})})],[t])},Xe=()=>{const{id:s}=Q(),t=L(),{customer:r,isLoading:o,isError:i,error:n}=V(s,void 0,{initialData:t});if(o||!r)return e.jsx(M,{sections:2,showJSON:!0,showMetadata:!0});if(i)throw n;return e.jsxs(I,{widgets:{before:oe,after:re},data:r,hasOutlet:!0,showJSON:!0,showMetadata:!0,children:[e.jsx(ae,{customer:r}),e.jsx(ie,{customer:r})]})},le=s=>({queryKey:X.detail(s),queryFn:async()=>H.admin.customer.retrieve(s)}),es=async({params:s})=>{const t=s.id,r=le(t);return f.getQueryData(r.queryKey)??await f.fetchQuery(r)};export{Xe as Component,es as loader};
