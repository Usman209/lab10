import{C as E}from"./chunk-FLW5D3SP-BaZq7vS1.js";import{o as C}from"./chunk-Y2QXUTMB-BX8XhJpg.js";import{D as H,a as q,u as z,b as B,c as M,d as P}from"./chunk-FUHEDN6F-DJm8RBCj.js";import{b as G}from"./chunk-3UMDCRM2-NSGJIubw.js";import{R as b,u as T}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as O,F as t,C as V}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{d as A,i as K}from"./chunk-DMYZ6SLX-CvGU_oYL.js";import{j as e,u as R,R as w,s as Q,q as $,t as S,r as y,g as D,H as k,I as c}from"./index-DQ7iaOIo.js";import{t as U}from"./zod-DqtdDTUb.js";import{o as J,s as d,b as W,r as X,n as Y}from"./index-yuYasa5Y.js";import{P as j}from"./progress-tabs-nihPaPnN.js";import{B as L}from"./label-DsyTUQgE.js";import{T as Z}from"./textarea-BWm6luAN.js";import{S as ee}from"./switch-CHhgpYt_.js";import"./triangles-mini-BMU6OfpM.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./chunk-GH77ZQI2-CyzKiLW4.js";import"./index-DW7vLJga.js";import"./index-LtR7LJbL.js";import"./prompt-BKfKBHyN.js";import"./index-CIxKSFC7.js";var te=({field:s,context:a,...i})=>{const{control:u,renderProps:l}=z({field:s,context:a,type:"number"}),{container:h,input:f}=l;return e.jsx(V,{control:u,name:s,render:({field:g})=>e.jsx(B,{...h,children:e.jsx(re,{field:g,inputProps:f,...i})})})},re=({field:s,inputProps:a,...i})=>{const{ref:u,value:l,onChange:h,onBlur:f,...g}=s,{ref:v,onChange:x,onBlur:I,onFocus:N,...r}=a,[m,o]=y.useState(l);y.useEffect(()=>{o(l)},[l]);const n=P(v,u);return e.jsx("div",{className:"size-full",children:e.jsx("input",{ref:n,value:m,onChange:p=>o(p.target.value),onBlur:()=>{f(),I(),x(m,l)},onFocus:N,type:"number",inputMode:"decimal",className:D("txt-compact-small size-full bg-transparent px-4 py-2.5 outline-none","placeholder:text-ui-fg-muted"),tabIndex:-1,...i,...g,...r})})},se=({form:s})=>{const{isPending:a,stock_locations:i=[]}=G({limit:999}),{setCloseOnEscape:u}=T(),l=le();return e.jsx("div",{className:"size-full",children:a?e.jsx("div",{children:"Loading..."}):e.jsx(H,{columns:l,data:i,state:s,onEditingChange:h=>u(!h)})})},_=M(),le=()=>{const{t:s}=R();return y.useMemo(()=>[_.column({id:"location",header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:s("locations.domain")})}),cell:({row:a})=>e.jsx(q,{children:a.original.name}),disableHiding:!0}),_.column({id:"in-stock",name:s("fields.inStock"),header:s("fields.inStock"),cell:a=>e.jsx(te,{min:0,placeholder:"0",context:a,field:`locations.${a.row.original.id}`}),disableHiding:!0,type:"number"})],[s])},ie=J({title:d().min(1),sku:d().optional(),hs_code:d().optional(),weight:C,length:C,height:C,width:C,origin_country:d().optional(),mid_code:d().optional(),material:d().optional(),description:d().optional(),requires_shipping:W().optional(),thumbnail:d().optional(),locations:X(d(),Y().optional()).optional()});function ne(){const{t:s}=R(),{handleSuccess:a}=T(),[i,u]=w.useState("details"),l=O({defaultValues:{title:"",sku:"",hs_code:"",weight:"",length:"",height:"",width:"",origin_country:"",mid_code:"",material:"",description:"",requires_shipping:!0,thumbnail:""},resolver:U(ie)}),{mutateAsync:h,isPending:f}=A(),g=l.handleSubmit(async r=>{const{locations:m,...o}=r;for(const n in o){if(o[n]===""){delete o[n];continue}["weight","length","height","width"].includes(n)&&(o[n]=parseInt(o[n]))}try{const{inventory_item:n}=await h(o);try{await Q.admin.inventoryItem.batchUpdateLevels(n.id,{create:Object.entries(m).filter(([p,F])=>!!F).map(([p,F])=>({location_id:p,stocked_quantity:F}))}),await $.invalidateQueries({queryKey:K.lists()})}catch(p){S.error(p.message)}a()}catch(n){S.error(n.message)}}),[v,x]=w.useState({availability:"not-started",details:"not-started"}),I=w.useCallback(async r=>{await l.trigger()&&u(r)},[]),N=w.useCallback(async()=>{if(await l.trigger())switch(i){case"details":{u("availability");break}}},[i]);return y.useEffect(()=>{l.formState.isDirty?x(r=>({...r,details:"in-progress"})):x(r=>({...r,details:"not-started"}))},[l.formState.isDirty]),y.useEffect(()=>{i==="details"&&l.formState.isDirty&&x(r=>({...r,details:"in-progress"})),i==="availability"&&x(r=>({...r,details:"completed",availability:"in-progress"}))},[i]),e.jsx(b.Form,{form:l,children:e.jsx("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:g,children:e.jsxs(j,{value:i,className:"h-full",onValueChange:r=>I(r),children:[e.jsxs(b.Header,{children:[e.jsxs(j.List,{className:"border-ui-border-base -my-2 ml-2 min-w-0 flex-1 border-l",children:[e.jsx(j.Trigger,{value:"details",status:v.details,className:"w-full max-w-[200px]",children:e.jsx("span",{className:"w-full cursor-auto overflow-hidden text-ellipsis whitespace-nowrap",children:s("inventory.create.details")})}),e.jsx(j.Trigger,{value:"availability",className:"w-full max-w-[200px]",status:v.availability,children:e.jsx("span",{className:"w-full overflow-hidden text-ellipsis whitespace-nowrap",children:s("inventory.create.availability")})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(b.Close,{asChild:!0,children:e.jsx(L,{variant:"secondary",size:"small",children:s("actions.cancel")})}),e.jsx(L,{size:"small",className:"whitespace-nowrap",isLoading:f,onClick:i!=="availability"?N:void 0,type:i==="availability"?"submit":"button",children:s(i==="availability"?"actions.save":"general.next")},i==="availability"?"details":"pricing")]})]}),e.jsxs(b.Body,{className:D("flex h-full w-full flex-col items-center divide-y overflow-hidden",{"mx-auto":i==="details"}),children:[e.jsx(j.Content,{value:"details",className:"h-full w-full",children:e.jsxs("div",{className:"mx-auto w-[720px] px-1 py-8",children:[e.jsx(k,{level:"h2",className:"mb-12 mt-8 text-2xl",children:s("inventory.create.title")}),e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-x-3 gap-y-6 lg:grid-cols-2",children:[e.jsx(t.Field,{control:l.control,name:"title",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:s("fields.title")}),e.jsx(t.Control,{children:e.jsx(c,{...r,placeholder:s("fields.title")})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:l.control,name:"sku",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:s("fields.sku")}),e.jsx(t.Control,{children:e.jsx(c,{...r,placeholder:"sku-123"})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx(t.Field,{control:l.control,name:"description",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("products.fields.description.label")}),e.jsx(t.Control,{children:e.jsx(Z,{...r,placeholder:"The item description"})})]})})}),e.jsx("div",{className:"col-span-2",children:e.jsx(t.Field,{control:l.control,name:"requires_shipping",render:({field:{value:r,onChange:m,...o}})=>e.jsxs(t.Item,{children:[e.jsxs("div",{className:"flex flex-col gap-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(t.Label,{children:s("inventory.create.requiresShipping")}),e.jsx(t.Control,{children:e.jsx(ee,{checked:r,onCheckedChange:n=>m(!!n),...o})})]}),e.jsx(t.Hint,{children:s("inventory.create.requiresShippingHint")})]}),e.jsx(t.ErrorMessage,{})]})})})]}),e.jsx(k,{level:"h3",className:"my-6",children:s("inventory.create.attributes")}),e.jsxs("div",{className:"grid grid-cols-1 gap-x-4 gap-y-8 lg:grid-cols-2",children:[e.jsx(t.Field,{control:l.control,name:"width",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("products.fields.width.label")}),e.jsx(t.Control,{children:e.jsx(c,{...r,type:"number",min:0,placeholder:"100"})})]})}),e.jsx(t.Field,{control:l.control,name:"length",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("products.fields.length.label")}),e.jsx(t.Control,{children:e.jsx(c,{...r,type:"number",min:0,placeholder:"100"})})]})}),e.jsx(t.Field,{control:l.control,name:"height",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("products.fields.height.label")}),e.jsx(t.Control,{children:e.jsx(c,{...r,type:"number",min:0,placeholder:"100"})})]})}),e.jsx(t.Field,{control:l.control,name:"weight",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("products.fields.weight.label")}),e.jsx(t.Control,{children:e.jsx(c,{...r,type:"number",min:0,placeholder:"100"})})]})}),e.jsx(t.Field,{control:l.control,name:"mid_code",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("products.fields.mid_code.label")}),e.jsx(t.Control,{children:e.jsx(c,{...r})})]})}),e.jsx(t.Field,{control:l.control,name:"hs_code",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("products.fields.hs_code.label")}),e.jsx(t.Control,{children:e.jsx(c,{...r})})]})}),e.jsx(t.Field,{control:l.control,name:"origin_country",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("products.fields.countryOrigin.label")}),e.jsx(t.Control,{children:e.jsx(E,{...r})})]})}),e.jsx(t.Field,{control:l.control,name:"material",render:({field:r})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("products.fields.material.label")}),e.jsx(t.Control,{children:e.jsx(c,{...r})})]})})]})]})]})}),e.jsx(j.Content,{value:"availability",className:"size-full",children:e.jsx(se,{form:l})})]})]})})})}function ke(){return e.jsx(b,{children:e.jsx(ne,{})})}export{ke as Component};
