import{u as q}from"./chunk-YFWOU2UG-B6wOGF41.js";import{S as B}from"./chunk-OUAFSZKF-BpzSoAuD.js";import{f as H}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{S as A}from"./chunk-ARXK2O3B-CLA1-3Mx.js";import{u as k}from"./chunk-KKUJQ3HN-B-RHKr58.js";import{C as F}from"./chunk-UY4EBCIZ-BkMu1ycI.js";import{D as G}from"./chunk-FUHEDN6F-DJm8RBCj.js";import{w as K,d as Z,N as J,j as e,r as O,u as V,t as z,s as D,H as Q,T as U,I as W,D as X,m as Y,o as ee}from"./index-DQ7iaOIo.js";import"./index.esm-C23H4hs_.js";import{u as se,F as i}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{c as I}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{b as ie}from"./chunk-RJJ3HJT5-0qvBrSK4.js";import{u as re}from"./chunk-3UMDCRM2-NSGJIubw.js";import{R as C,u as R}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as oe}from"./chunk-QHCOJC4V-B0UJ2So3.js";import{t as te}from"./zod-DqtdDTUb.js";import{z as p}from"./index-yuYasa5Y.js";import{P as v}from"./progress-tabs-nihPaPnN.js";import{B as N}from"./label-DsyTUQgE.js";import{R as P}from"./radio-group-CqMTuXTE.js";import"./chunk-VZRDVNEY-twUt44Gw.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./switch-CHhgpYt_.js";import"./index-CIxKSFC7.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangles-mini-BMU6OfpM.js";import"./plus-mini-DfhjBeEB.js";import"./chunk-GH77ZQI2-CyzKiLW4.js";import"./index-DW7vLJga.js";import"./index-LtR7LJbL.js";import"./prompt-BKfKBHyN.js";var ne=({form:t,isReturn:l=!1,zone:g,locationId:h})=>{const{t:r}=V(),n=k({queryFn:s=>D.admin.shippingProfile.list(s),queryKey:["shipping_profiles"],getOptions:s=>s.shipping_profiles.map(m=>({label:m.name,value:m.id}))}),a=k({queryFn:s=>D.admin.fulfillmentProvider.list({...s,stock_location_id:h}),queryKey:["fulfillment_providers"],getOptions:s=>s.fulfillment_providers.map(m=>({label:H(m.id),value:m.id}))});return e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16",children:[e.jsxs("div",{children:[e.jsx(Q,{children:r(`stockLocations.shippingOptions.create.${l?"returns":"shipping"}.header`,{zone:g.name})}),e.jsx(U,{size:"small",className:"text-ui-fg-subtle",children:r(`stockLocations.shippingOptions.create.${l?"returns":"shipping"}.hint`)})]}),e.jsx(i.Field,{control:t.control,name:"price_type",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:r("stockLocations.shippingOptions.fields.priceType.label")}),e.jsx(i.Control,{children:e.jsxs(P,{className:"grid grid-cols-1 gap-4 md:grid-cols-2",...s,onValueChange:s.onChange,children:[e.jsx(P.ChoiceBox,{className:"flex-1",value:"flat",label:r("stockLocations.shippingOptions.fields.priceType.options.fixed.label"),description:r("stockLocations.shippingOptions.fields.priceType.options.fixed.hint")}),e.jsx(P.ChoiceBox,{className:"flex-1",value:"calculated",label:r("stockLocations.shippingOptions.fields.priceType.options.calculated.label"),description:r("stockLocations.shippingOptions.fields.priceType.options.calculated.hint")})]})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:e.jsx(i.Field,{control:t.control,name:"name",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:r("fields.name")}),e.jsx(i.Control,{children:e.jsx(W,{...s})}),e.jsx(i.ErrorMessage,{})]})})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(i.Field,{control:t.control,name:"shipping_profile_id",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:r("stockLocations.shippingOptions.fields.profile")}),e.jsx(i.Control,{children:e.jsx(F,{...s,options:n.options,searchValue:n.searchValue,onSearchValueChange:n.onSearchValueChange,disabled:n.disabled})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:t.control,name:"provider_id",render:({field:s})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{tooltip:r("stockLocations.fulfillmentProviders.shippingOptionsTooltip"),children:r("stockLocations.shippingOptions.fields.provider")}),e.jsx(i.Control,{children:e.jsx(F,{...s,options:a.options,searchValue:a.searchValue,onSearchValueChange:a.onSearchValueChange,disabled:a.disabled})}),e.jsx(i.ErrorMessage,{})]})})]}),e.jsx(X,{}),e.jsx(A,{control:t.control,name:"enabled_in_store",label:r("stockLocations.shippingOptions.fields.enableInStore.label"),description:r("stockLocations.shippingOptions.fields.enableInStore.hint")})]})})},ae=({form:t})=>{const{store:l,isLoading:g,isError:h,error:r}=Y(),n=O.useMemo(()=>{var u;return((u=l==null?void 0:l.supported_currencies)==null?void 0:u.map(L=>L.currency_code))||[]},[l]),{regions:a,isLoading:s,isError:m,error:o}=oe({fields:"id,name,currency_code",limit:999}),{price_preferences:_}=ee({}),{setCloseOnEscape:j}=R(),x=q({currencies:n,regions:a,pricePreferences:_}),b=O.useMemo(()=>[[...n||[],...a||[]]],[n,a]);if(h)throw r;if(m)throw o;return e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx(G,{data:b,columns:x,state:t,onEditingChange:u=>j(!u)})})},M=p.object({name:p.string().min(1),price_type:p.nativeEnum(B),enabled_in_store:p.boolean(),shipping_profile_id:p.string().min(1),provider_id:p.string().min(1)}),le=p.object({region_prices:p.record(p.string(),p.string().optional()),currency_prices:p.record(p.string(),p.string().optional())}).merge(M);function ce({zone:t,isReturn:l,locationId:g}){var E,T;const[h,r]=O.useState("details"),[n,a]=O.useState(!1),{t:s}=V(),{handleSuccess:m}=R(),o=se({defaultValues:{name:"",price_type:"flat",enabled_in_store:!0,shipping_profile_id:"",provider_id:"",region_prices:{},currency_prices:{}},resolver:te(le)}),_=o.watch("price_type")==="calculated",{mutateAsync:j,isPending:x}=ie(),b=o.handleSubmit(async d=>{const w=Object.entries(d.currency_prices).map(([c,f])=>{const S=f?I(f):void 0;return{currency_code:c,amount:S}}).filter(c=>!!c.amount),y=Object.entries(d.region_prices).map(([c,f])=>{const S=f?I(f):void 0;return{region_id:c,amount:S}}).filter(c=>!!c.amount);await j({name:d.name,price_type:d.price_type,service_zone_id:t.id,shipping_profile_id:d.shipping_profile_id,provider_id:d.provider_id,prices:[...w,...y],rules:[{value:l?'"true"':'"false"',attribute:"is_return",operator:"eq"},{value:d.enabled_in_store?'"true"':'"false"',attribute:"enabled_in_store",operator:"eq"}],type:{label:"Type label",description:"Type description",code:"type-code"}},{onSuccess:({shipping_option:c})=>{z.success(s(`stockLocations.shippingOptions.create.${l?"returns":"shipping"}.successToast`,{name:c.name})),m(`/settings/locations/${g}`)},onError:c=>{z.error(c.message)}})}),u=d=>{if(d==="pricing"){o.clearErrors();const w=M.safeParse({...o.getValues()});if(!w.success){const[y,...c]=w.error.errors;for(const f of c){const S=f.path.join(".");o.setError(S,{message:f.message,type:f.code})}o.setError(y.path.join("."),{message:y.message,type:y.code},{shouldFocus:!0}),a(!1);return}a(!0)}r(d)},L=(E=o.getFieldState("currency_prices"))!=null&&E.isDirty||(T=o.getFieldState("region_prices"))!=null&&T.isDirty||h==="pricing"?"in-progress":"not-started",$=n?"completed":"in-progress";return e.jsx(C.Form,{form:o,children:e.jsx(v,{value:h,className:"flex h-full flex-col overflow-hidden",onValueChange:d=>u(d),children:e.jsxs("form",{className:"flex h-full flex-col",onSubmit:b,children:[e.jsxs(C.Header,{children:[e.jsxs(v.List,{className:"border-ui-border-base -my-2 ml-2 min-w-0 flex-1 border-l",children:[e.jsx(v.Trigger,{value:"details",status:$,className:"w-full max-w-[200px]",children:e.jsx("span",{className:"w-full cursor-auto overflow-hidden text-ellipsis whitespace-nowrap",children:s("stockLocations.shippingOptions.create.tabs.details")})}),!_&&e.jsx(v.Trigger,{value:"pricing",status:L,className:"w-full max-w-[200px]",children:e.jsx("span",{className:"w-full overflow-hidden text-ellipsis whitespace-nowrap",children:s("stockLocations.shippingOptions.create.tabs.prices")})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(C.Close,{asChild:!0,children:e.jsx(N,{variant:"secondary",size:"small",children:s("actions.cancel")})}),h==="pricing"||_?e.jsx(N,{size:"small",className:"whitespace-nowrap",isLoading:x,type:"submit",children:s("actions.save")},"submit-btn"):e.jsx(N,{size:"small",className:"whitespace-nowrap",isLoading:x,onClick:()=>u("pricing"),type:"button",children:s("actions.continue")},"continue-btn")]})]}),e.jsxs(C.Body,{className:"size-full overflow-hidden",children:[e.jsx(v.Content,{value:"details",className:"size-full overflow-y-auto",children:e.jsx(ne,{form:o,zone:t,isReturn:l,locationId:g})}),e.jsx(v.Content,{value:"pricing",className:"size-full",children:e.jsx(ae,{form:o})})]})]})})})}var pe="*fulfillment_sets,*fulfillment_sets.service_zones,*fulfillment_sets.service_zones.shipping_options";function Be(){var j,x,b;const{location_id:t,fset_id:l,zone_id:g}=K(),[h]=Z(),r=h.has("is_return"),{stock_location:n,isPending:a,isError:s,error:m}=re(t,{fields:pe}),o=(b=(x=(j=n==null?void 0:n.fulfillment_sets)==null?void 0:j.find(u=>u.id===l))==null?void 0:x.service_zones)==null?void 0:b.find(u=>u.id===g);if(!a&&!o)throw J({message:`Service zone with ID ${g} was not found`},404);if(s)throw m;const _=!a&&!!o;return e.jsx(C,{prev:`/settings/locations/${t}`,children:_&&e.jsx(ce,{zone:o,isReturn:r,locationId:t})})}export{Be as Component};
