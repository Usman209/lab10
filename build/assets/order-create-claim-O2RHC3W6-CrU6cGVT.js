import{g as _e,u as Le,C as He,D as Ke}from"./chunk-QNWSMO7D-Dwyc1LHH.js";import{D as ze}from"./chunk-HCRBCECO-DmzhLN6S.js";import{M as Be}from"./chunk-LHJ6JQGA-DbSCtxtF.js";import{a as $}from"./chunk-FSMQADBD-DQ6u7KYm.js";import{P as Ve,a as Oe}from"./chunk-6XHB4MRO-D_LOUyOE.js";import{T as Ue}from"./chunk-PHMALPVO-BXYfPvrg.js";import{C as oe}from"./chunk-UY4EBCIZ-BkMu1ycI.js";import{c as $e}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{u as Ge,D as Xe}from"./chunk-MOFW5DA3-BBRzwwAr.js";import{w as Je,b as Ye,u as G,a3 as We,c0 as Ze,r as b,j as e,a0 as et,s as M,Q as L,q as y,a4 as N,t as w,H as me,T as Z,n as le,a1 as tt,I as pe,A as nt,X as fe}from"./index-DQ7iaOIo.js";import"./lodash-BbEdBw2P.js";import{u as st}from"./chunk-C76H5USB-BzcnRuay.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{u as it}from"./chunk-RJJ3HJT5-0qvBrSK4.js";import{b as at}from"./chunk-3UMDCRM2-NSGJIubw.js";import{R as K,u as rt,b as ot,S as U}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as lt,b as dt,F as m}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{t as ct}from"./zod-DqtdDTUb.js";import{z as A}from"./index-yuYasa5Y.js";import{P as ut}from"./pencil-square-C2dQ88SM.js";import{X as mt}from"./x-circle-DtLjBqH9.js";import{B as W}from"./label-DsyTUQgE.js";import{A as pt}from"./alert-BDVUsyGc.js";import{C as ft}from"./currency-input-YdrMuETU.js";import{S as xt}from"./switch-CHhgpYt_.js";import{C as xe}from"./checkbox-BXdKf1Kl.js";import{c as ht}from"./index-DW7vLJga.js";import"./chunk-P3UUX2T6-OlAXa1VC.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangles-mini-BMU6OfpM.js";import"./plus-mini-DfhjBeEB.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./format-CJ2FegFx.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./triangle-left-mini-o3U9ykef.js";import"./prompt-BKfKBHyN.js";import"./index.esm-C23H4hs_.js";import"./index-CIxKSFC7.js";var gt="claims",ee=tt(gt),vt=(s,a,r)=>{const{data:t,...d}=et({queryFn:async()=>M.admin.claim.retrieve(s,a),queryKey:ee.detail(s,a),...r});return{...t,...d}},bt=(s,a)=>L({mutationFn:r=>M.admin.claim.create(r),onSuccess:(r,t,d)=>{y.invalidateQueries({queryKey:N.details()}),y.invalidateQueries({queryKey:N.lists()}),y.invalidateQueries({queryKey:N.preview(s)}),y.invalidateQueries({queryKey:ee.lists()})},...a}),yt=(s,a,r)=>L({mutationFn:t=>M.admin.claim.addInboundItems(s,t),onSuccess:(t,d,c)=>{y.invalidateQueries({queryKey:N.preview(a)})},...r}),_t=(s,a,r)=>L({mutationFn:({actionId:t,...d})=>M.admin.claim.updateInboundItem(s,t,d),onSuccess:(t,d,c)=>{y.invalidateQueries({queryKey:N.preview(a)})},...r}),jt=(s,a,r)=>L({mutationFn:t=>M.admin.claim.removeInboundItem(s,t),onSuccess:(t,d,c)=>{y.invalidateQueries({queryKey:N.preview(a)}),y.invalidateQueries({queryKey:N.all})},...r}),It=(s,a,r)=>L({mutationFn:t=>M.admin.claim.addInboundShipping(s,t),onSuccess:(t,d,c)=>{y.invalidateQueries({queryKey:N.preview(a)})},...r}),Ct=(s,a,r)=>L({mutationFn:({actionId:t,...d})=>M.admin.claim.updateInboundShipping(s,t,d),onSuccess:(t,d,c)=>{y.invalidateQueries({queryKey:N.preview(a)})},...r}),Nt=(s,a,r)=>L({mutationFn:t=>M.admin.claim.deleteInboundShipping(s,t),onSuccess:(t,d,c)=>{y.invalidateQueries({queryKey:N.preview(a)})},...r}),St=(s,a,r)=>L({mutationFn:()=>M.admin.claim.cancelRequest(s),onSuccess:(t,d,c)=>{y.invalidateQueries({queryKey:N.details()}),y.invalidateQueries({queryKey:N.lists()}),y.invalidateQueries({queryKey:N.preview(a)}),y.invalidateQueries({queryKey:ee.details()}),y.invalidateQueries({queryKey:ee.lists()})},...r}),V=ht(),qt=s=>{const{t:a}=G();return b.useMemo(()=>[V.display({id:"select",header:({table:r})=>e.jsx(xe,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:t=>r.toggleAllPageRowsSelected(!!t)}),cell:({row:r})=>{const t=r.getCanSelect();return e.jsx(xe,{disabled:!t,checked:r.getIsSelected(),onCheckedChange:d=>r.toggleSelected(!!d),onClick:d=>{d.stopPropagation()}})}}),V.display({id:"product",header:()=>e.jsx(Ve,{}),cell:({row:r})=>e.jsx(Oe,{product:r.original.variant.product})}),V.accessor("variant.sku",{header:a("fields.sku"),cell:({getValue:r})=>r()||"-"}),V.accessor("variant.title",{header:a("fields.variant")}),V.accessor("quantity",{header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:a("fields.quantity")})}),cell:({getValue:r,row:t})=>_e(t.original)}),V.accessor("refundable_total",{header:()=>e.jsx("div",{className:"flex size-full items-center justify-end overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:a("fields.price")})}),cell:({getValue:r})=>{const t=r()||0,d=$(t,s);return e.jsx("div",{className:"flex size-full items-center justify-end overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:d})})}})],[a,s])},wt=()=>{const{t:s}=G();return[{key:"returnable_quantity",label:s("orders.returns.returnableQuantityLabel"),type:"number"},{key:"refundable_amount",label:s("orders.returns.refundableAmountLabel"),type:"number"},{key:"created_at",label:s("fields.createdAt"),type:"date"},{key:"updated_at",label:s("fields.updatedAt"),type:"date"}]},Et=({pageSize:s=50,prefix:a})=>{const r=st(["q","offset","order","created_at","updated_at","returnable_quantity","refundable_amount"],a),{offset:t,created_at:d,updated_at:c,refundable_amount:u,returnable_quantity:g,...v}=r;return{searchParams:{...v,limit:s,offset:t?Number(t):0,created_at:d?JSON.parse(d):void 0,updated_at:c?JSON.parse(c):void 0,refundable_amount:u?JSON.parse(u):void 0,returnable_quantity:g?JSON.parse(g):void 0},raw:r}},se=50,he="rit",Pt=({onSelectionChange:s,selectedItems:a,items:r,currencyCode:t})=>{const[d,c]=b.useState(a.reduce((p,q)=>(p[q]=!0,p),{})),u=p=>{const q=typeof p=="function"?p(d):p;c(q),s(Object.keys(q))},{searchParams:g,raw:v}=Et({pageSize:se,prefix:he}),h=b.useMemo(()=>{const{order:p,offset:q,limit:D,q:_,created_at:T,updated_at:E,refundable_amount:P,returnable_quantity:X}=g;let j=r;if(_&&(j=j.filter(H=>{var z;return H.variant.product.title.toLowerCase().includes(_.toLowerCase())||H.variant.title.toLowerCase().includes(_.toLowerCase())||((z=H.variant.sku)==null?void 0:z.toLowerCase().includes(_.toLowerCase()))})),p){const H=p[0]==="-"?"desc":"asc",z=p.replace("-","");j=kt(j,z,H)}return T&&(j=ge(j,T,"created_at")),E&&(j=ge(j,E,"updated_at")),X&&(j=be(j,X,"returnable_quantity",t)),P&&(j=be(j,P,"refundable_amount",t)),j.slice(q,q+D)},[r,t,g]),I=qt(t),F=wt(),{table:S}=Ge({data:h,columns:I,count:h.length,enablePagination:!0,getRowId:p=>p.id,pageSize:se,enableRowSelection:p=>_e(p.original)>0,rowSelection:{state:d,updater:u}});return e.jsx("div",{className:"flex size-full flex-col overflow-hidden",children:e.jsx(Xe,{table:S,columns:I,pageSize:se,count:h.length,filters:F,pagination:!0,layout:"fill",search:!0,orderBy:["product_title","variant_title","sku","returnable_quantity","refundable_amount"],prefix:he,queryObject:v})})},kt=(s,a,r)=>s.sort((t,d)=>{let c,u;return a==="product_title"?(c=t.variant.product.title,u=d.variant.product.title):a==="variant_title"?(c=t.variant.title,u=d.variant.title):a==="sku"?(c=t.variant.sku,u=d.variant.sku):a==="returnable_quantity"?(c=t.quantity-(t.returned_quantity||0),u=d.quantity-(d.returned_quantity||0)):a==="refundable_amount"&&(c=t.refundable||0,u=d.refundable||0),c<u?r==="asc"?-1:1:c>u?r==="asc"?1:-1:0}),ge=(s,a,r)=>{const{gt:t,gte:d,lt:c,lte:u}=a;return s.filter(g=>{const v=new Date(g[r]);let h=!0;return t&&(h=h&&v>new Date(t)),d&&(h=h&&v>=new Date(d)),c&&(h=h&&v<new Date(c)),u&&(h=h&&v<=new Date(u)),h})},ve={eq:void 0,gt:void 0,gte:void 0,lt:void 0,lte:void 0},be=(s,a,r,t)=>{const{eq:d,gt:c,lt:u,gte:g,lte:v}=typeof a=="object"?{...ve,...a}:{...ve,eq:a};return s.filter(h=>{const I=h.quantity-(h.returned_quantity||0),F=$(h.refundable||0,t),S=r==="returnable_quantity"?I:F;if(d)return S===d;let p=!0;return c&&(p=p&&S>c),g&&(p=p&&S>=g),u&&(p=p&&S<u),v&&(p=p&&S<=v),p})};function Rt({item:s,previewItem:a,currencyCode:r,form:t,onRemove:d,onUpdate:c,index:u}){var S,p,q;const{t:g}=G(),{return_reasons:v=[]}=Le({fields:"+label"}),h=t.watch(`inbound_items.${u}`),I=typeof h.reason_id=="string",F=typeof h.note=="string";return e.jsxs("div",{className:"bg-ui-bg-subtle shadow-elevation-card-rest my-2 rounded-xl ",children:[e.jsxs("div",{className:"flex flex-col items-center gap-x-2 gap-y-2 border-b p-3 text-sm md:flex-row",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-x-3",children:[e.jsx(Ue,{src:s.thumbnail}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsxs(Z,{className:"txt-small",as:"span",weight:"plus",children:[s.title," "]}),((S=s.variant)==null?void 0:S.sku)&&e.jsxs("span",{children:["(",s.variant.sku,")"]})]}),e.jsx(Z,{as:"div",className:"text-ui-fg-subtle txt-small",children:(q=(p=s.variant)==null?void 0:p.product)==null?void 0:q.title})]})]}),e.jsxs("div",{className:"flex flex-1 justify-between",children:[e.jsxs("div",{className:"flex flex-grow items-center gap-2",children:[e.jsx(m.Field,{control:t.control,name:`inbound_items.${u}.quantity`,render:({field:D})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(pe,{...D,className:"bg-ui-bg-base txt-small w-[67px] rounded-lg",min:1,max:s.quantity,type:"number",onBlur:_=>{const T=_.target.value,E=T===""?null:Number(T);D.onChange(E),E&&c({quantity:E})}})}),e.jsx(m.ErrorMessage,{})]})}),e.jsx(Z,{className:"txt-small text-ui-fg-subtle",children:g("fields.qty")})]}),e.jsx("div",{className:"text-ui-fg-subtle txt-small mr-2 flex flex-shrink-0",children:e.jsx(Be,{currencyCode:r,amount:a.return_requested_total})}),e.jsx(nt,{groups:[{actions:[!I&&{label:g("actions.addReason"),onClick:()=>t.setValue(`inbound_items.${u}.reason_id`,""),icon:e.jsx(He,{})},!F&&{label:g("actions.addNote"),onClick:()=>t.setValue(`inbound_items.${u}.note`,""),icon:e.jsx(Ke,{})},{label:g("actions.remove"),onClick:d,icon:e.jsx(mt,{})}].filter(Boolean)}]})]})]}),e.jsxs(e.Fragment,{children:[I&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:g("orders.returns.reason")}),e.jsx(m.Hint,{className:"!mt-1",children:g("orders.returns.reasonHint")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(m.Field,{control:t.control,name:`inbound_items.${u}.reason_id`,render:({field:{ref:D,value:_,onChange:T,...E}})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(oe,{className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",value:_,onChange:P=>{c({reason_id:P}),T(P)},...E,options:v.map(P=>({label:P.label,value:P.id}))})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx(le,{type:"button",className:"flex-shrink",variant:"transparent",onClick:()=>{t.setValue(`inbound_items.${u}.reason_id`,null),c({reason_id:null})},children:e.jsx(fe,{className:"text-ui-fg-muted"})})]})]}),F&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:g("orders.returns.note")}),e.jsx(m.Hint,{className:"!mt-1",children:g("orders.returns.noteHint")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(m.Field,{control:t.control,name:`inbound_items.${u}.note`,render:({field:{ref:D,..._}})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(pe,{..._,onBlur:()=>{_.onChange(_.value),c({internal_note:_.value})},className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover"})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx(le,{type:"button",className:"flex-shrink",variant:"transparent",onClick:()=>{t.setValue(`inbound_items.${u}.note`,null),c({internal_note:null})},children:e.jsx(fe,{className:"text-ui-fg-muted"})})]})]})]})]})}var At=A.object({inbound_items:A.array(A.object({item_id:A.string(),quantity:A.number(),reason_id:A.string().nullish(),note:A.string().nullish()})),location_id:A.string().optional(),inbound_option_id:A.string().nullish(),send_notification:A.boolean().optional()}),ie=[],ye=[],ae=!1,Mt=({order:s,preview:a,claim:r})=>{const{t}=G(),{handleSuccess:d}=rt(),{setIsOpen:c}=ot(),[u,g]=b.useState(!1),[v,h]=b.useState(0),[I,F]=b.useState({}),{stock_locations:S=[]}=at({limit:999}),{shipping_options:p=[]}=it({limit:999,fields:"*prices,+service_zone.fulfillment_set.location.id"}),{mutateAsync:q,isPending:D}={},{mutateAsync:_,isPending:T}=St(r.id,s.id),{mutateAsync:E,isPending:P}={},{mutateAsync:X,isPending:j}=It(r.id,s.id),{mutateAsync:H,isPending:z}=Ct(r.id,s.id),{mutateAsync:je,isPending:Ie}=Nt(r.id,s.id),{mutateAsync:Ce,isPending:Ne}=yt(r.id,s.id),{mutateAsync:Se,isPending:qe}=_t(r.id,s.id),{mutateAsync:de,isPending:we}=jt(r.id,s.id),Ee=D||T||j||z||Ie||Ne||we||qe||P,Q=b.useMemo(()=>{var i;return(i=a==null?void 0:a.items)==null?void 0:i.filter(o=>{var n;return!!((n=o.actions)!=null&&n.find(l=>l.claim_id===r.id))})},[a.items]),te=b.useMemo(()=>{var i;return new Map((i=s==null?void 0:s.items)==null?void 0:i.map(o=>[o.id,o]))},[s.items]),ce=b.useMemo(()=>new Map(Q.map(i=>[i.id,i])),[Q]),k=lt({defaultValues:()=>{const i=a.shipping_methods.find(o=>{var n;return!!((n=o.actions)!=null&&n.find(l=>l.action==="SHIPPING_ADD"))});return Promise.resolve({inbound_items:Q.map(o=>{var l,f;const n=(l=o.actions)==null?void 0:l.find(x=>x.action==="RETURN_ITEM");return{item_id:o.id,quantity:o.detail.return_requested_quantity,note:n==null?void 0:n.internal_note,reason_id:(f=n==null?void 0:n.details)==null?void 0:f.reason_id}}),inbound_option_id:i?i.shipping_option_id:"",location_id:"",send_notification:!1})},resolver:ct(At)}),{fields:C,append:Pe,remove:ke,update:Re}=dt({name:"inbound_items",control:k.control});b.useEffect(()=>{const i={};Q.forEach(o=>{var l,f;const n=C.findIndex(x=>x.item_id===o.id);if(i[o.id]=!0,n>-1){if(C[n].quantity!==o.detail.return_requested_quantity){const x=(l=o.actions)==null?void 0:l.find(R=>R.action==="RETURN_ITEM");Re(n,{...C[n],quantity:o.detail.return_requested_quantity,note:x==null?void 0:x.internal_note,reason_id:(f=x==null?void 0:x.details)==null?void 0:f.reason_id})}}else Pe({item_id:o.id,quantity:o.detail.return_requested_quantity})}),C.forEach((o,n)=>{o.item_id in i||ke(n)})},[Q]),b.useEffect(()=>{const i=a.shipping_methods.find(o=>{var n;return!!((n=o.actions)!=null&&n.find(l=>l.action==="SHIPPING_ADD"))});i&&k.setValue("inbound_option_id",i.shipping_option_id)},[a.shipping_methods]);const J=!C.length,B=k.watch("location_id"),Ae=k.watch("inbound_option_id"),Me=k.handleSubmit(async i=>{try{await q({no_notification:!i.send_notification}),d()}catch(o){w.error(t("general.error"),{description:o.message})}}),Te=async()=>{var i,o,n;ie.length&&await Ce({items:ie.map(l=>({id:l,quantity:1}))},{onError:l=>{w.error(l.message)}});for(const l of ye){const f=(n=(o=(i=Q.find(x=>x.id===l))==null?void 0:i.actions)==null?void 0:o.find(x=>x.action==="RETURN_ITEM"))==null?void 0:n.id;f&&await de(f,{onError:x=>{w.error(x.message)}})}c("items",!1)},Fe=async i=>{await E({location_id:i})},De=async i=>{const o=a.shipping_methods.map(n=>{var l,f;return(f=(l=n.actions)==null?void 0:l.find(x=>x.action==="SHIPPING_ADD"))==null?void 0:f.id}).filter(Boolean).map(je);await Promise.all(o),await X({shipping_option_id:i},{onError:n=>{w.error(n.message)}})};b.useEffect(()=>{var i;u&&((i=document.getElementById("js-shipping-input"))==null||i.focus())},[u]);const Qe=b.useMemo(()=>B?!C.map(o=>{var l;const n=te.get(o.item_id);return!(n!=null&&n.variant_id)||!(n!=null&&n.variant)||!n.variant.manage_inventory?!0:(l=I[n.variant_id])==null?void 0:l.find(f=>f.location_id===B)}).every(Boolean):!1,[C,I,B]);b.useEffect(()=>{(async()=>{const o={};return C.length&&(await Promise.all(C.map(async n=>{var f;const l=te.get(n.item_id);if(!(!l.variant_id||!((f=l.variant)!=null&&f.product)))return await M.admin.product.retrieveVariant(l.variant.product.id,l.variant_id,{fields:"*inventory,*inventory.location_levels"})}))).filter(n=>!!(n!=null&&n.variant)).forEach(n=>{var x;const{variant:l}=n,f=(x=l.inventory[0])==null?void 0:x.location_levels;f&&(o[l.id]=f)}),o})().then(o=>{F(o)})},[C]),b.useEffect(()=>()=>{ae&&(_(void 0,{onSuccess:()=>{w.success(t("orders.claims.actions.cancelClaim.successToast"))},onError:i=>{w.error(i.message)}}),ae=!1)},[]);const ue=b.useMemo(()=>{const i=a.shipping_methods.find(o=>{var n;return!!((n=o.actions)!=null&&n.find(l=>l.action==="SHIPPING_ADD"))});return(i==null?void 0:i.total)||0},[a.shipping_methods]),Y=a.return_requested_total,ne=Y-ue;return e.jsx(K.Form,{form:k,children:e.jsxs("form",{onSubmit:Me,className:"flex h-full flex-col",children:[e.jsx(K.Header,{}),e.jsx(K.Body,{className:"flex size-full justify-center overflow-y-auto",children:e.jsxs("div",{className:"mt-16 w-[720px] max-w-[100%] px-4 md:p-0",children:[e.jsx(me,{level:"h1",children:t("orders.claims.create")}),e.jsxs("div",{className:"mt-8 flex items-center justify-between",children:[e.jsx(me,{level:"h2",children:t("orders.returns.inbound")}),e.jsxs(U,{id:"items",children:[e.jsx(U.Trigger,{asChild:!0,children:e.jsx("a",{className:"focus-visible:shadow-borders-focus transition-fg txt-compact-small-plus cursor-pointer text-blue-500 outline-none hover:text-blue-400",children:t("actions.addItems")})}),e.jsxs(U.Content,{children:[e.jsx(U.Header,{}),e.jsx(Pt,{items:s.items,selectedItems:C.map(i=>i.item_id),currencyCode:s.currency_code,onSelectionChange:i=>{const o=C.map(n=>n.item_id);ie=i.filter(n=>!o.includes(n)),ye=o.filter(n=>!i.includes(n))}}),e.jsx(U.Footer,{children:e.jsx("div",{className:"flex w-full items-center justify-end gap-x-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(K.Close,{asChild:!0,children:e.jsx(W,{type:"button",variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(W,{type:"submit",variant:"primary",size:"small",role:"button",onClick:async()=>await Te(),children:t("actions.save")},"submit-button")]})})})]})]})]}),J&&e.jsx("div",{style:{background:"repeating-linear-gradient(-45deg, rgb(212, 212, 216, 0.15), rgb(212, 212, 216,.15) 10px, transparent 10px, transparent 20px)"},className:"bg-ui-bg-field mt-4 block h-[56px] w-full rounded-lg border border-dashed"}),C.map((i,o)=>ce.get(i.item_id)&&e.jsx(Rt,{item:te.get(i.item_id),previewItem:ce.get(i.item_id),currencyCode:s.currency_code,form:k,onRemove:()=>{var l,f,x;const n=(x=(f=(l=Q.find(R=>R.id===i.item_id))==null?void 0:l.actions)==null?void 0:f.find(R=>R.action==="RETURN_ITEM"))==null?void 0:x.id;n&&de(n,{onError:R=>{w.error(R.message)}})},onUpdate:n=>{var f,x,R;const l=(R=(x=(f=Q.find(O=>O.id===i.item_id))==null?void 0:f.actions)==null?void 0:x.find(O=>O.action==="RETURN_ITEM"))==null?void 0:R.id;l&&Se({...n,actionId:l},{onError:O=>{w.error(O.message)}})},index:o},i.id)),!J&&e.jsxs("div",{className:"mt-8 flex flex-col gap-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:t("orders.returns.location")}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.locationHint")})]}),e.jsx(m.Field,{control:k.control,name:"location_id",render:({field:{value:i,onChange:o,...n}})=>e.jsx(m.Item,{children:e.jsx(m.Control,{children:e.jsx(oe,{value:i,onChange:l=>{o(l),Fe(l)},...n,options:(S??[]).map(l=>({label:l.name,value:l.id}))})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:t("orders.returns.inboundShipping")}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.inboundShippingHint")})]}),e.jsx(m.Field,{control:k.control,name:"inbound_option_id",render:({field:{value:i,onChange:o,...n}})=>e.jsx(m.Item,{children:e.jsx(m.Control,{children:e.jsx(oe,{value:i??void 0,onChange:l=>{o(l),l&&De(l)},...n,options:(p??[]).filter(l=>(B?l.service_zone.fulfillment_set.location.id===B:!0)&&!!l.rules.find(f=>f.attribute==="is_return"&&f.value==="true")).map(l=>({label:l.name,value:l.id})),disabled:!B})})})})]})]}),Qe&&e.jsxs(pt,{variant:"warning",dismissible:!0,className:"mt-4 p-5",children:[e.jsx("div",{className:"text-ui-fg-subtle txt-small pb-2 font-medium leading-[20px]",children:t("orders.returns.noInventoryLevel")}),e.jsx(Z,{className:"text-ui-fg-subtle txt-small leading-normal",children:t("orders.returns.noInventoryLevelDesc")})]}),e.jsxs("div",{className:"mt-8 border-y border-dotted py-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:t("orders.returns.returnTotal")}),e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:$(Y&&-1*Y,s.currency_code)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:t("orders.returns.inboundShipping")}),e.jsxs("span",{className:"txt-small text-ui-fg-subtle flex items-center",children:[!u&&e.jsx(le,{onClick:()=>g(!0),variant:"transparent",className:"text-ui-fg-muted",disabled:J||!Ae,children:e.jsx(ut,{})}),u?e.jsx(ft,{id:"js-shipping-input",onBlur:()=>{let i;a.shipping_methods.forEach(o=>{if(o.actions)for(let n of o.actions)n.action==="SHIPPING_ADD"&&(i=n.id)}),i&&H({actionId:i,custom_price:typeof v=="string"?null:v},{onError:o=>{w.error(o.message)}}),g(!1)},symbol:$e[s.currency_code.toUpperCase()].symbol_native,code:s.currency_code,onValueChange:i=>i&&h(parseInt(i)),value:v,disabled:J}):$(ue,s.currency_code)]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between border-t border-dotted pt-4",children:[e.jsx("span",{className:"txt-small font-medium",children:t("orders.claims.refundAmount")}),e.jsx("span",{className:"txt-small font-medium",children:$(ne&&-1*ne,s.currency_code)})]})]}),e.jsx("div",{className:"bg-ui-bg-field mt-8 rounded-lg border py-2 pl-2 pr-4",children:e.jsx(m.Field,{control:k.control,name:"send_notification",render:({field:{onChange:i,value:o,...n}})=>e.jsxs(m.Item,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m.Control,{className:"mr-4 self-start",children:e.jsx(xt,{className:"mt-[2px]",checked:!!o,onCheckedChange:i,...n})}),e.jsxs("div",{className:"block",children:[e.jsx(m.Label,{children:t("orders.returns.sendNotification")}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.sendNotificationHint")})]})]}),e.jsx(m.ErrorMessage,{})]})})})]})}),e.jsx(K.Footer,{children:e.jsx("div",{className:"flex w-full items-center justify-end gap-x-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(K.Close,{asChild:!0,children:e.jsx(W,{type:"button",onClick:()=>ae=!0,variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(W,{type:"submit",variant:"primary",size:"small",isLoading:Ee,children:t("actions.save")},"submit-button")]})})})]})})},re=!1,En=()=>{const{id:s}=Je(),a=Ye(),{t:r}=G(),{order:t}=We(s,{fields:ze}),{order:d}=Ze(s),[c,u]=b.useState(),{mutateAsync:g}=bt(t.id),{claim:v}=vt(c,void 0,{enabled:!!c});return b.useEffect(()=>{async function h(){if(!(re||!d)){if(d.order_change){d.order_change.change_type==="claim"?u(d.order_change.claim_id):(a(`/orders/${d.id}`,{replace:!0}),w.error(r("orders.claims.activeChangeError")));return}re=!0;try{const{claim:I}=await g({order_id:d.id,type:"replace"});u(I.id)}catch(I){w.error(I.message),a(`/orders/${d.id}`,{replace:!0})}finally{re=!1}}}h()},[d]),e.jsx(K,{children:v&&d&&t&&e.jsx(Mt,{order:t,claim:v,preview:d})})};export{En as Component};
