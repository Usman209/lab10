import{g as ce,u as Ae,C as Ee,D as Me}from"./chunk-QNWSMO7D-Dwyc1LHH.js";import{k as De,a as Te,l as He,m as Le,n as Fe,o as ze,p as Be,q as Ve,r as Oe,s as Ue,t as $e}from"./chunk-JCVALELX-CXrRyc-h.js";import{D as Ge}from"./chunk-HCRBCECO-DmzhLN6S.js";import{M as Qe}from"./chunk-LHJ6JQGA-DbSCtxtF.js";import{a as L}from"./chunk-FSMQADBD-DQ6u7KYm.js";import{P as Xe,a as Je}from"./chunk-6XHB4MRO-D_LOUyOE.js";import{T as We}from"./chunk-PHMALPVO-BXYfPvrg.js";import{C as Z}from"./chunk-UY4EBCIZ-BkMu1ycI.js";import{c as Ze}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{u as Ke,D as Ye}from"./chunk-MOFW5DA3-BBRzwwAr.js";import{w as et,b as tt,u as F,a3 as st,c0 as nt,r as _,j as e,t as K,H as te,T as Q,n as Y,I as se,A as it,X as ne,s as rt}from"./index-DQ7iaOIo.js";import"./lodash-BbEdBw2P.js";import{u as at}from"./chunk-C76H5USB-BzcnRuay.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{u as ot}from"./chunk-RJJ3HJT5-0qvBrSK4.js";import{b as lt}from"./chunk-3UMDCRM2-NSGJIubw.js";import{R as E,u as dt,b as ct,S as H}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as ut,b as mt,F as m}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{t as pt}from"./zod-DqtdDTUb.js";import{z as C}from"./index-yuYasa5Y.js";import{P as ft}from"./pencil-square-C2dQ88SM.js";import{C as ht}from"./currency-input-YdrMuETU.js";import{X as xt}from"./x-circle-DtLjBqH9.js";import{B as G}from"./label-DsyTUQgE.js";import{A as gt}from"./alert-BDVUsyGc.js";import{S as bt}from"./switch-CHhgpYt_.js";import{C as ie}from"./checkbox-BXdKf1Kl.js";import{c as jt}from"./index-DW7vLJga.js";import"./chunk-P3UUX2T6-OlAXa1VC.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangles-mini-BMU6OfpM.js";import"./plus-mini-DfhjBeEB.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./format-CJ2FegFx.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./triangle-left-mini-o3U9ykef.js";import"./prompt-BKfKBHyN.js";import"./index.esm-C23H4hs_.js";import"./index-CIxKSFC7.js";var _t=C.object({items:C.array(C.object({item_id:C.string(),quantity:C.number(),reason_id:C.string().optional().nullable(),note:C.string().optional().nullable()})),location_id:C.string().optional(),option_id:C.string(),send_notification:C.boolean().optional(),receive_now:C.boolean().optional()}),T=jt(),vt=i=>{const{t:l}=F();return _.useMemo(()=>[T.display({id:"select",header:({table:o})=>e.jsx(ie,{checked:o.getIsSomePageRowsSelected()?"indeterminate":o.getIsAllPageRowsSelected(),onCheckedChange:t=>o.toggleAllPageRowsSelected(!!t)}),cell:({row:o})=>{const t=o.getCanSelect();return e.jsx(ie,{disabled:!t,checked:o.getIsSelected(),onCheckedChange:c=>o.toggleSelected(!!c),onClick:c=>{c.stopPropagation()}})}}),T.display({id:"product",header:()=>e.jsx(Xe,{}),cell:({row:o})=>e.jsx(Je,{product:o.original.variant.product})}),T.accessor("variant.sku",{header:l("fields.sku"),cell:({getValue:o})=>o()||"-"}),T.accessor("variant.title",{header:l("fields.variant")}),T.accessor("quantity",{header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:l("fields.quantity")})}),cell:({getValue:o,row:t})=>ce(t.original)}),T.accessor("refundable_total",{header:()=>e.jsx("div",{className:"flex size-full items-center justify-end overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:l("fields.price")})}),cell:({getValue:o})=>{const t=o()||0,c=L(t,i);return e.jsx("div",{className:"flex size-full items-center justify-end overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:c})})}})],[l,i])},yt=()=>{const{t:i}=F();return[{key:"returnable_quantity",label:i("orders.returns.returnableQuantityLabel"),type:"number"},{key:"refundable_amount",label:i("orders.returns.refundableAmountLabel"),type:"number"},{key:"created_at",label:i("fields.createdAt"),type:"date"},{key:"updated_at",label:i("fields.updatedAt"),type:"date"}]},Nt=({pageSize:i=50,prefix:l})=>{const o=at(["q","offset","order","created_at","updated_at","returnable_quantity","refundable_amount"],l),{offset:t,created_at:c,updated_at:p,refundable_amount:d,returnable_quantity:h,...b}=o;return{searchParams:{...b,limit:i,offset:t?Number(t):0,created_at:c?JSON.parse(c):void 0,updated_at:p?JSON.parse(p):void 0,refundable_amount:d?JSON.parse(d):void 0,returnable_quantity:h?JSON.parse(h):void 0},raw:o}},J=50,re="rit",It=({onSelectionChange:i,selectedItems:l,items:o,currencyCode:t})=>{const[c,p]=_.useState(l.reduce((u,j)=>(u[j]=!0,u),{})),d=u=>{const j=typeof u=="function"?u(c):u;p(j),i(Object.keys(j))},{searchParams:h,raw:b}=Nt({pageSize:J,prefix:re}),f=_.useMemo(()=>{const{order:u,offset:j,limit:P,q:I,created_at:z,updated_at:B,refundable_amount:V,returnable_quantity:O}=h;let v=o;if(I&&(v=v.filter(k=>{var M;return k.variant.product.title.toLowerCase().includes(I.toLowerCase())||k.variant.title.toLowerCase().includes(I.toLowerCase())||((M=k.variant.sku)==null?void 0:M.toLowerCase().includes(I.toLowerCase()))})),u){const k=u[0]==="-"?"desc":"asc",M=u.replace("-","");v=Rt(v,M,k)}return z&&(v=ae(v,z,"created_at")),B&&(v=ae(v,B,"updated_at")),O&&(v=le(v,O,"returnable_quantity",t)),V&&(v=le(v,V,"refundable_amount",t)),v.slice(j,j+P)},[o,t,h]),y=vt(t),w=yt(),{table:N}=Ke({data:f,columns:y,count:f.length,enablePagination:!0,getRowId:u=>u.id,pageSize:J,enableRowSelection:u=>ce(u.original)>0,rowSelection:{state:c,updater:d}});return e.jsx("div",{className:"flex size-full flex-col overflow-hidden",children:e.jsx(Ye,{table:N,columns:y,pageSize:J,count:f.length,filters:w,pagination:!0,layout:"fill",search:!0,orderBy:["product_title","variant_title","sku","returnable_quantity","refundable_amount"],prefix:re,queryObject:b})})},Rt=(i,l,o)=>i.sort((t,c)=>{let p,d;return l==="product_title"?(p=t.variant.product.title,d=c.variant.product.title):l==="variant_title"?(p=t.variant.title,d=c.variant.title):l==="sku"?(p=t.variant.sku,d=c.variant.sku):l==="returnable_quantity"?(p=t.quantity-(t.returned_quantity||0),d=c.quantity-(c.returned_quantity||0)):l==="refundable_amount"&&(p=t.refundable||0,d=c.refundable||0),p<d?o==="asc"?-1:1:p>d?o==="asc"?1:-1:0}),ae=(i,l,o)=>{const{gt:t,gte:c,lt:p,lte:d}=l;return i.filter(h=>{const b=new Date(h[o]);let f=!0;return t&&(f=f&&b>new Date(t)),c&&(f=f&&b>=new Date(c)),p&&(f=f&&b<new Date(p)),d&&(f=f&&b<=new Date(d)),f})},oe={eq:void 0,gt:void 0,gte:void 0,lt:void 0,lte:void 0},le=(i,l,o,t)=>{const{eq:c,gt:p,lt:d,gte:h,lte:b}=typeof l=="object"?{...oe,...l}:{...oe,eq:l};return i.filter(f=>{const y=f.quantity-(f.returned_quantity||0),w=L(f.refundable||0,t),N=o==="returnable_quantity"?y:w;if(c)return N===c;let u=!0;return p&&(u=u&&N>p),h&&(u=u&&N>=h),d&&(u=u&&N<d),b&&(u=u&&N<=b),u})};function St({item:i,previewItem:l,currencyCode:o,form:t,onRemove:c,onUpdate:p,index:d}){const{t:h}=F(),{return_reasons:b=[]}=Ae({fields:"+label"}),f=t.watch(`items.${d}`),y=typeof f.reason_id=="string",w=typeof f.note=="string";return e.jsxs("div",{className:"bg-ui-bg-subtle shadow-elevation-card-rest my-2 rounded-xl ",children:[e.jsxs("div",{className:"flex flex-col items-center gap-x-2 gap-y-2 border-b p-3 text-sm md:flex-row",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-x-3",children:[e.jsx(We,{src:i.thumbnail}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsxs(Q,{className:"txt-small",as:"span",weight:"plus",children:[i.title," "]}),i.variant.sku&&e.jsxs("span",{children:["(",i.variant.sku,")"]})]}),e.jsx(Q,{as:"div",className:"text-ui-fg-subtle txt-small",children:i.variant.product.title})]})]}),e.jsxs("div",{className:"flex flex-1 justify-between",children:[e.jsxs("div",{className:"flex flex-grow items-center gap-2",children:[e.jsx(m.Field,{control:t.control,name:`items.${d}.quantity`,render:({field:N})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(se,{className:"bg-ui-bg-base txt-small w-[67px] rounded-lg",min:1,max:i.quantity,type:"number",...N,onChange:u=>{const j=u.target.value,P=j===""?null:Number(j);N.onChange(P),P&&p({quantity:P})}})}),e.jsx(m.ErrorMessage,{})]})}),e.jsx(Q,{className:"txt-small text-ui-fg-subtle",children:h("fields.qty")})]}),e.jsx("div",{className:"text-ui-fg-subtle txt-small mr-2 flex flex-shrink-0",children:e.jsx(Qe,{currencyCode:o,amount:l.return_requested_total})}),e.jsx(it,{groups:[{actions:[!y&&{label:h("actions.addReason"),onClick:()=>t.setValue(`items.${d}.reason_id`,""),icon:e.jsx(Ee,{})},!w&&{label:h("actions.addNote"),onClick:()=>t.setValue(`items.${d}.note`,""),icon:e.jsx(Me,{})},{label:h("actions.remove"),onClick:c,icon:e.jsx(xt,{})}].filter(Boolean)}]})]})]}),e.jsxs(e.Fragment,{children:[y&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:h("orders.returns.reason")}),e.jsx(m.Hint,{className:"!mt-1",children:h("orders.returns.reasonHint")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(m.Field,{control:t.control,name:`items.${d}.reason_id`,render:({field:{ref:N,value:u,onChange:j,...P}})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(Z,{className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",value:u,onChange:I=>{p({reason_id:I}),j(I)},...P,options:b.map(I=>({label:I.label,value:I.id}))})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx(Y,{type:"button",className:"flex-shrink",variant:"transparent",onClick:()=>{p({reason_id:null}),t.setValue(`items.${d}.reason_id`,null)},children:e.jsx(ne,{className:"text-ui-fg-muted"})})]})]}),w&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:h("orders.returns.note")}),e.jsx(m.Hint,{className:"!mt-1",children:h("orders.returns.noteHint")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(m.Field,{control:t.control,name:`items.${d}.note`,render:({field:{ref:N,onChange:u,...j}})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(se,{onChange:u,...j,onBlur:()=>p({internal_note:j.value}),className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover"})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx(Y,{type:"button",className:"flex-shrink",variant:"transparent",onClick:()=>{t.setValue(`items.${d}.note`,{shouldDirty:!0,shouldTouch:!0}),p({internal_note:null})},children:e.jsx(ne,{className:"text-ui-fg-muted"})})]})]})]})]})}var de=[],Ct=({order:i,preview:l,activeReturn:o})=>{const{t}=F(),{handleSuccess:c}=dt(),p=_.useMemo(()=>new Map(i.items.map(s=>[s.id,s])),[i.items]),d=_.useMemo(()=>l.items.filter(s=>{var r;return!!((r=s.actions)!=null&&r.find(n=>n.return_id===o.id))}),[l.items]),h=_.useMemo(()=>new Map(d.map(s=>[s.id,s])),[d]),{setIsOpen:b}=ct(),[f,y]=_.useState(!1),[w,N]=_.useState(0),[u,j]=_.useState({}),{stock_locations:P=[]}=lt({limit:999}),{shipping_options:I=[]}=ot({limit:999,fields:"*prices,+service_zone.fulfillment_set.location.id"}),{mutateAsync:z,isPending:B}=He(o.id,i.id),{mutateAsync:V,isPending:O}=Le(o.id,i.id),{mutateAsync:v,isPending:k}=Fe(o.id,i.id),{mutateAsync:M,isPending:ue}=ze(o.id,i.id),{mutateAsync:me,isPending:pe}=Be(o.id,i.id),{mutateAsync:fe,isPending:he}=Ve(o.id,i.id),{mutateAsync:xe,isPending:ge}=Oe(o.id,i.id),{mutateAsync:be,isPending:je}=Ue(o.id,i.id),{mutateAsync:_e,isPending:ve}=$e(o.id,i.id),ye=B||O||ue||pe||he||ge||je||ve||k,q=ut({defaultValues:()=>{const s=l.shipping_methods.find(r=>{var n;return!!((n=r.actions)!=null&&n.find(a=>a.action==="SHIPPING_ADD"))});return Promise.resolve({items:d.map(r=>{var n,a,x,g,S;return{item_id:r.id,quantity:r.detail.return_requested_quantity,note:(a=(n=r.actions)==null?void 0:n.find(A=>A.action==="RETURN_ITEM"))==null?void 0:a.internal_note,reason_id:(S=(g=(x=r.actions)==null?void 0:x.find(A=>A.action==="RETURN_ITEM"))==null?void 0:g.details)==null?void 0:S.reason_id}}),option_id:s?s.shipping_option_id:"",location_id:"",send_notification:!1})},resolver:pt(_t)}),{fields:R,append:Ne,remove:Ie,update:Re}=mt({name:"items",control:q.control});_.useEffect(()=>{const s={};d.forEach(r=>{var a,x;const n=R.findIndex(g=>g.item_id===r.id);if(r.detail.return_requested_quantity)if(s[r.id]=!0,n>-1){if(R[n].quantity!==r.detail.return_requested_quantity){const g=(a=r.actions)==null?void 0:a.find(S=>S.action==="RETURN_ITEM");Re(n,{...R[n],quantity:r.detail.return_requested_quantity,note:g==null?void 0:g.internal_note,reason_id:(x=g==null?void 0:g.details)==null?void 0:x.reason_id})}}else Ne({item_id:r.id,quantity:r.detail.return_requested_quantity})}),R.forEach((r,n)=>{r.item_id in s||Ie(n)})},[d]),_.useEffect(()=>{const s=l.shipping_methods.find(r=>{var n;return!!((n=r.actions)!=null&&n.find(a=>a.action==="SHIPPING_ADD"))});s&&q.setValue("option_id",s.shipping_option_id)},[l.shipping_methods]);const U=!R.length,D=q.watch("location_id"),Se=q.watch("option_id"),Ce=q.handleSubmit(async s=>{try{await z({no_notification:!s.send_notification}),c()}catch(r){K.error(t("general.error"),{description:r.message,dismissLabel:t("actions.close")})}}),we=()=>{xe({items:de.map(s=>({id:s,quantity:1}))}),b("items",!1)},qe=async s=>{await v({location_id:s})},Pe=async s=>{const r=l.shipping_methods.map(n=>{var a,x;return(x=(a=n.actions)==null?void 0:a.find(g=>g.action==="SHIPPING_ADD"))==null?void 0:x.id}).filter(Boolean).map(fe);await Promise.all(r),await M({shipping_option_id:s})};_.useEffect(()=>{f&&document.getElementById("js-shipping-input").focus()},[f]);const ke=_.useMemo(()=>D?!R.map(r=>{var a;const n=p.get(r.item_id);return!(n!=null&&n.variant_id)||!n.variant.manage_inventory?!0:(a=u[n.variant_id])==null?void 0:a.find(x=>x.location_id===D)}).every(Boolean):!1,[R,u,D]);_.useEffect(()=>{(async()=>{const r={};return R.length&&(await Promise.all(R.map(async n=>{const a=p.get(n.item_id);if(a.variant_id)return await rt.admin.product.retrieveVariant(a.variant.product.id,a.variant_id,{fields:"*inventory,*inventory.location_levels"})}))).filter(n=>n==null?void 0:n.variant).forEach(n=>{var g;const{variant:a}=n,x=(g=a.inventory[0])==null?void 0:g.location_levels;x&&(r[a.id]=x)}),r})().then(r=>{j(r)})},[R]);const $=l.return_requested_total,ee=_.useMemo(()=>{const s=l.shipping_methods.find(r=>{var n;return!!((n=r.actions)!=null&&n.find(a=>a.action==="SHIPPING_ADD"))});return(s==null?void 0:s.total)||0},[l.shipping_methods]),X=$-ee;return e.jsx(E.Form,{form:q,onClose:s=>{s||V()},children:e.jsxs("form",{onSubmit:Ce,className:"flex h-full flex-col",children:[e.jsx(E.Header,{}),e.jsx(E.Body,{className:"flex size-full justify-center overflow-y-auto",children:e.jsxs("div",{className:"mt-16 w-[720px] max-w-[100%] px-4 md:p-0",children:[e.jsx(te,{level:"h1",children:t("orders.returns.create")}),e.jsxs("div",{className:"mt-8 flex items-center justify-between",children:[e.jsx(te,{level:"h2",children:t("orders.returns.inbound")}),e.jsxs(H,{id:"items",children:[e.jsx(H.Trigger,{asChild:!0,children:e.jsx("a",{className:"focus-visible:shadow-borders-focus transition-fg txt-compact-small-plus cursor-pointer text-blue-500 outline-none hover:text-blue-400",children:t("actions.addItems")})}),e.jsxs(H.Content,{children:[e.jsx(H.Header,{}),e.jsx(It,{items:i.items,selectedItems:R.map(s=>s.item_id),currencyCode:i.currency_code,onSelectionChange:s=>de=s}),e.jsx(H.Footer,{children:e.jsx("div",{className:"flex w-full items-center justify-end gap-x-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(E.Close,{asChild:!0,children:e.jsx(G,{type:"button",variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(G,{type:"submit",variant:"primary",size:"small",role:"button",onClick:()=>we(),children:t("actions.save")},"submit-button")]})})})]})]})]}),U&&e.jsx("div",{style:{background:"repeating-linear-gradient(-45deg, rgb(212, 212, 216, 0.15), rgb(212, 212, 216,.15) 10px, transparent 10px, transparent 20px)"},className:"bg-ui-bg-field mt-4 block h-[56px] w-full rounded-lg border border-dashed"}),R.filter(s=>!!h.get(s.item_id)).map((s,r)=>e.jsx(St,{item:p.get(s.item_id),previewItem:h.get(s.item_id),currencyCode:i.currency_code,form:q,onRemove:()=>{var a,x,g;const n=(g=(x=(a=d.find(S=>S.id===s.item_id))==null?void 0:a.actions)==null?void 0:x.find(S=>S.action==="RETURN_ITEM"))==null?void 0:g.id;n&&be(n)},onUpdate:n=>{var x,g,S;const a=(S=(g=(x=d.find(A=>A.id===s.item_id))==null?void 0:x.actions)==null?void 0:g.find(A=>A.action==="RETURN_ITEM"))==null?void 0:S.id;a&&_e({...n,actionId:a})},index:r},s.id)),!U&&e.jsxs("div",{className:"mt-8 flex flex-col gap-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:t("orders.returns.location")}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.locationHint")})]}),e.jsx(m.Field,{control:q.control,name:"location_id",render:({field:{value:s,onChange:r,...n}})=>e.jsx(m.Item,{children:e.jsx(m.Control,{children:e.jsx(Z,{value:s,onChange:a=>{r(a),qe(a)},...n,options:(P??[]).map(a=>({label:a.name,value:a.id}))})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:t("orders.returns.inboundShipping")}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.inboundShippingHint")})]}),e.jsx(m.Field,{control:q.control,name:"option_id",render:({field:{value:s,onChange:r,...n}})=>e.jsx(m.Item,{children:e.jsx(m.Control,{children:e.jsx(Z,{value:s,onChange:a=>{r(a),Pe(a)},...n,options:(I??[]).filter(a=>(D?a.service_zone.fulfillment_set.location.id===D:!0)&&!!a.rules.find(x=>x.attribute==="is_return"&&x.value==="true")).map(a=>({label:a.name,value:a.id})),disabled:!D})})})})]})]}),ke&&e.jsxs(gt,{variant:"warning",dismissible:!0,className:"mt-4 p-5",children:[e.jsx("div",{className:"text-ui-fg-subtle txt-small pb-2 font-medium leading-[20px]",children:t("orders.returns.noInventoryLevel")}),e.jsx(Q,{className:"text-ui-fg-subtle txt-small leading-normal",children:t("orders.returns.noInventoryLevelDesc")})]}),e.jsxs("div",{className:"mt-8 border-y border-dotted py-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:t("orders.returns.returnTotal")}),e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:L($&&-1*$,i.currency_code)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:t("orders.returns.inboundShipping")}),e.jsxs("span",{className:"txt-small text-ui-fg-subtle flex items-center",children:[!f&&e.jsx(Y,{onClick:()=>y(!0),variant:"transparent",className:"text-ui-fg-muted",disabled:U||!Se,children:e.jsx(ft,{})}),f?e.jsx(ht,{id:"js-shipping-input",onBlur:()=>{let s;l.shipping_methods.forEach(r=>{if(r.actions)for(let n of r.actions)n.action==="SHIPPING_ADD"&&(s=n.id)}),s&&me({actionId:s,custom_price:typeof w=="string"?null:w}),y(!1)},symbol:Ze[i.currency_code.toUpperCase()].symbol_native,code:i.currency_code,onValueChange:s=>N(s?parseInt(s):""),value:w,disabled:U}):L(ee,i.currency_code)]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between border-t border-dotted pt-4",children:[e.jsx("span",{className:"txt-small font-medium",children:t("orders.returns.refundAmount")}),e.jsx("span",{className:"txt-small font-medium",children:L(X&&-1*X,i.currency_code)})]})]}),e.jsx("div",{className:"bg-ui-bg-field mt-8 rounded-lg border py-2 pl-2 pr-4",children:e.jsx(m.Field,{control:q.control,name:"send_notification",render:({field:{onChange:s,value:r,...n}})=>e.jsxs(m.Item,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m.Control,{className:"mr-4 self-start",children:e.jsx(bt,{className:"mt-[2px]",checked:!!r,onCheckedChange:s,...n})}),e.jsxs("div",{className:"block",children:[e.jsx(m.Label,{children:t("orders.returns.sendNotification")}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.sendNotificationHint")})]})]}),e.jsx(m.ErrorMessage,{})]})})})]})}),e.jsx(E.Footer,{children:e.jsx("div",{className:"flex w-full items-center justify-end gap-x-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(E.Close,{asChild:!0,children:e.jsx(G,{type:"button",variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(G,{type:"submit",variant:"primary",size:"small",isLoading:ye,children:t("actions.save")},"submit-button")]})})})]})})},W=!1,ys=()=>{const{id:i}=et(),l=tt(),{t:o}=F(),{order:t}=st(i,{fields:Ge}),{order:c}=nt(i,void 0),[p,d]=_.useState(),{mutateAsync:h}=De(t.id),{return:b}=Te(p,void 0,{enabled:!!p});return _.useEffect(()=>{async function f(){if(!(W||!c)){if(c.order_change){c.order_change.change_type==="return_request"?d(c.order_change.return_id):(l(`/orders/${t.id}`,{replace:!0}),K.error(o("orders.returns.activeChangeError")));return}W=!0;try{const y=await h({order_id:t.id});d(y.id)}catch(y){l(`/orders/${t.id}`,{replace:!0}),K.error(y.message)}finally{W=!1}}}f()},[c]),e.jsx(E,{children:b&&c&&t&&e.jsx(Ct,{order:t,activeReturn:b,preview:c})})};export{ys as Component};
