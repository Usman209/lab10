import{u as Q,a as $}from"./chunk-XDVPCCFF-DPhfBuez.js";import{u as F}from"./chunk-LSEYENCI-CbqWCFFl.js";import{J as N}from"./chunk-3IW4HYUP-DTbTbYs9.js";import{r as d,aP as f,h as V,w as G,ch as J,j as t,O as U,q as C,u,C as h,H as j,A as y,T as l,b as W,cg as Z,B as X,c3 as Y,ci as M,L as ee,P as te,cj as se,v as re,t as P}from"./index-DQ7iaOIo.js";import{c as ie}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{u as oe,D as ae}from"./chunk-MOFW5DA3-BBRzwwAr.js";import"./lodash-BbEdBw2P.js";import"./chunk-7LAPOKHJ-CJKFdgcT.js";import"./chunk-M566SHKI-CpCecA-q.js";import{f as ne}from"./format-CJ2FegFx.js";import{P as b}from"./pencil-square-C2dQ88SM.js";import{T as O}from"./Trans-LG4CmYWt.js";import{T as E}from"./trash-AHlgA58B.js";import{u as w}from"./use-prompt-DSUtE_64.js";import{S as le}from"./status-badge-CrS-Pq0N.js";import{B as ce}from"./label-DsyTUQgE.js";import{C as S}from"./checkbox-BXdKf1Kl.js";import{c as de}from"./index-DW7vLJga.js";import"./chunk-KDXAFTVE-BIJQy-Te.js";import"./chunk-IQRVIEMV-CAyGAynz.js";import"./chunk-P3UUX2T6-OlAXa1VC.js";import"./chunk-ADOCJB6L-DwJI6LYz.js";import"./chunk-C76H5USB-BzcnRuay.js";import"./arrow-up-right-on-box-CErxVq_8.js";import"./x-mark-mini-DjxzaqmQ.js";import"./triangle-down-mini-CMQwg4p-.js";import"./square-two-stack-0Hf-pV3m.js";import"./chunk-5FUV23JF-BunLQmqw.js";import"./chunk-RKBIB2RM-cgj6pqOB.js";import"./chunk-WX2SMNCD-CYp4yo3d.js";import"./plus-mini-DfhjBeEB.js";import"./command-bar-B4tNt0in.js";import"./index-T2cn0UOM.js";import"./chunk-QAF7PVQE-D70u5tsT.js";import"./_baseIsEqual-DdDy9tKi.js";import"./date-picker-BsdoIRhX.js";import"./clsx-B-dksMZM.js";import"./popover-C1ro1ubo.js";import"./triangle-left-mini-o3U9ykef.js";import"./prompt-BKfKBHyN.js";import"./index-CIxKSFC7.js";var me=Object.defineProperty,g=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,T=(e,s,r)=>s in e?me(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r,ue=(e,s)=>{for(var r in s||(s={}))k.call(s,r)&&T(e,r,s[r]);if(g)for(var r of g(s))R.call(s,r)&&T(e,r,s[r]);return e},pe=(e,s)=>{var r={};for(var i in e)k.call(e,i)&&s.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&g)for(var i of g(e))s.indexOf(i)<0&&R.call(e,i)&&(r[i]=e[i]);return r};const A=d.forwardRef((e,s)=>{var r=e,{color:i="currentColor"}=r,o=pe(r,["color"]);return d.createElement("svg",ue({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:s},o),d.createElement("g",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,clipPath:"url(#a)"},d.createElement("path",{d:"M13.368 10.167a6.446 6.446 0 1 1-8.535-8.535"}),d.createElement("path",{d:"M13.944 7.5A6.444 6.444 0 0 0 7.5 1.056V7.5z"})),d.createElement("defs",null,d.createElement("clipPath",{id:"a"},d.createElement("path",{fill:"#fff",d:"M0 0h15v15H0z"}))))});A.displayName="ChartPie";function xe(e,s){const r=f(e),i=f(s);return r.getTime()>i.getTime()}function fe(e,s){const r=f(e),i=f(s);return+r<+i}const ge={widgets:[]},he={widgets:[]},je={widgets:[]},ve={widgets:[]};var ye=({campaign:e})=>{var r,i,o;const{t:s}=u();return t.jsxs(h,{className:"flex flex-col gap-y-4 px-6 py-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("div",{className:"flex-grow",children:[t.jsx("div",{className:"float-left bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md",children:t.jsx("div",{className:"bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]",children:t.jsx(A,{className:"text-ui-fg-subtle"})})}),t.jsx(j,{className:"ml-10 mt-[1.5px] font-normal text-ui-fg-subtle",level:"h3",children:s("campaigns.fields.budget_limit")})]}),t.jsx(y,{groups:[{actions:[{icon:t.jsx(b,{}),label:s("actions.edit"),to:"edit-budget"}]}]})]}),t.jsx("div",{children:t.jsx(l,{className:"text-ui-fg-subtle border-l-4 border-ui-border-strong pl-3",size:"small",leading:"compact",children:t.jsx(O,{i18nKey:"campaigns.totalSpend",values:{amount:((r=e==null?void 0:e.budget)==null?void 0:r.limit)||"no limit",currency:((i=e==null?void 0:e.budget)==null?void 0:i.type)==="spend"&&(e!=null&&e.budget.limit)?(o=e.budget)==null?void 0:o.currency_code:""},components:[t.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus text-lg"},"amount"),t.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus text-lg"},"currency")]})})})]})};function z(e){const s=new Date(e);s.setMinutes(s.getMinutes()-s.getTimezoneOffset());const i=Intl.DateTimeFormat().resolvedOptions().hour12?"dd MMM yyyy hh:MM a":"dd MMM yyyy HH:MM";return ne(s,i)}function be(e){return e.ends_at&&fe(new Date(e.ends_at),new Date)?"expired":e.starts_at&&xe(new Date(e.starts_at),new Date)?"scheduled":"active"}var we=e=>{switch(e){case"expired":return"red";case"scheduled":return"orange";case"active":return"green";default:return"grey"}},_e=({campaign:e})=>{var n,p;const{t:s}=u(),r=w(),i=W(),{mutateAsync:o}=Z(e.id),c=async()=>{await r({title:s("campaigns.delete.title"),description:s("campaigns.delete.description",{name:e.name}),confirmText:s("actions.delete"),cancelText:s("actions.cancel")})&&await o(void 0,{onSuccess:()=>{P.success(s("campaigns.delete.successToast",{name:e.name})),i("/campaigns",{replace:!0})},onError:x=>{P.error(x.message)}})},a=be(e);return t.jsxs(h,{className:"divide-y p-0",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[t.jsx(j,{children:e.name}),t.jsxs("div",{className:"flex items-center gap-x-4",children:[t.jsx(le,{color:we(a),children:s(`campaigns.status.${a}`)}),t.jsx(y,{groups:[{actions:[{icon:t.jsx(b,{}),label:s("actions.edit"),to:`/campaigns/${e.id}/edit`}]},{actions:[{icon:t.jsx(E,{}),label:s("actions.delete"),onClick:c}]}]})]})]}),t.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[t.jsx(l,{size:"small",leading:"compact",weight:"plus",children:s("campaigns.fields.identifier")}),t.jsx(l,{size:"small",leading:"compact",children:e.campaign_identifier})]}),t.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[t.jsx(l,{size:"small",leading:"compact",weight:"plus",children:s("fields.description")}),t.jsx(l,{size:"small",leading:"compact",children:e.description||"-"})]}),(e==null?void 0:e.budget)&&e.budget.type==="spend"&&t.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[t.jsx(l,{size:"small",leading:"compact",weight:"plus",children:s("fields.currency")}),t.jsxs("div",{children:[t.jsx(X,{size:"xsmall",children:e==null?void 0:e.budget.currency_code}),t.jsx(l,{className:"inline pl-3",size:"small",leading:"compact",children:(p=ie[(n=e==null?void 0:e.budget.currency_code)==null?void 0:n.toUpperCase()])==null?void 0:p.name})]})]}),t.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[t.jsx(l,{size:"small",leading:"compact",weight:"plus",children:s("campaigns.fields.start_date")}),t.jsx(l,{size:"small",leading:"compact",children:e.starts_at?z(e.starts_at):"-"})]}),t.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[t.jsx(l,{size:"small",leading:"compact",weight:"plus",children:s("campaigns.fields.end_date")}),t.jsx(l,{size:"small",leading:"compact",children:e.starts_at?z(e.ends_at):"-"})]})]})},v=10,Ne=({campaign:e})=>{const[s,r]=d.useState({}),{t:i}=u(),o=w(),c=Pe(),a=F(),{searchParams:n,raw:p}=Q({pageSize:v}),{promotions:_,count:x,isLoading:I,isError:B,error:L}=Y({...n,campaign_id:e.id}),{table:q}=oe({data:_??[],columns:c,count:x,getRowId:m=>m.id,enablePagination:!0,enableRowSelection:!0,pageSize:v,rowSelection:{state:s,updater:r},meta:{campaignId:e.id}});if(B)throw L;const{mutateAsync:H}=M(e.id),K=async()=>{const m=Object.keys(s);await o({title:i("campaigns.promotions.remove.title",{count:m.length}),description:i("campaigns.promotions.remove.description",{count:m.length}),confirmText:i("actions.continue"),cancelText:i("actions.cancel")})&&await H({remove:m},{onSuccess:()=>r({})})};return t.jsxs(h,{className:"divide-y p-0",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[t.jsx(j,{level:"h2",children:i("promotions.domain")}),t.jsx(ee,{to:`/campaigns/${e.id}/add-promotions`,children:t.jsx(ce,{variant:"secondary",size:"small",children:i("general.add")})})]}),t.jsx(ae,{table:q,columns:c,pageSize:v,isLoading:I,count:x,navigateTo:m=>`/promotions/${m.id}`,filters:a,search:!0,pagination:!0,orderBy:["email","first_name","last_name","has_account","created_at","updated_at"],queryObject:p,commands:[{action:K,label:i("actions.remove"),shortcut:"r"}],noRecords:{message:i("campaigns.promotions.list.noRecordsMessage")}})]})},Ce=({promotion:e,campaignId:s})=>{const{t:r}=u(),{mutateAsync:i}=M(s),o=w(),c=async()=>{await o({title:r("campaigns.promotions.remove.title",{count:1}),description:r("campaigns.promotions.remove.description",{count:1}),confirmText:r("actions.continue"),cancelText:r("actions.cancel")})&&await i({remove:[e.id]})};return t.jsx(y,{groups:[{actions:[{icon:t.jsx(b,{}),label:r("actions.edit"),to:`/promotions/${e.id}/edit`}]},{actions:[{icon:t.jsx(E,{}),label:r("actions.remove"),onClick:c}]}]})},D=de(),Pe=()=>{const e=$();return d.useMemo(()=>[D.display({id:"select",header:({table:s})=>t.jsx(S,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:r=>s.toggleAllPageRowsSelected(!!r)}),cell:({row:s})=>t.jsx(S,{checked:s.getIsSelected(),onCheckedChange:r=>s.toggleSelected(!!r),onClick:r=>{r.stopPropagation()}})}),...e,D.display({id:"actions",cell:({row:s,table:r})=>{const{campaignId:i}=r.options.meta;return t.jsx(Ce,{promotion:s.original,campaignId:i})}})],[e])},Se=({campaign:e})=>{var r,i,o,c;const{t:s}=u();return t.jsxs(h,{className:"flex flex-col gap-y-4 px-6 py-4",children:[t.jsxs("div",{className:"grid grid-cols-[28px_1fr] items-center gap-x-3 mb-2",children:[t.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md",children:t.jsx("div",{className:"bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]",children:t.jsx(te,{className:"text-ui-fg-subtle"})})}),t.jsx(j,{level:"h3",className:"font-normal text-ui-fg-subtle",children:((r=e.budget)==null?void 0:r.type)==="spend"?s("campaigns.fields.total_spend"):s("campaigns.fields.total_used")})]}),t.jsx("div",{children:t.jsx(l,{className:"text-ui-fg-subtle border-l-4 border-ui-border-strong pl-3",size:"small",leading:"compact",children:t.jsx(O,{i18nKey:"campaigns.totalSpend",values:{amount:((i=e==null?void 0:e.budget)==null?void 0:i.used)||0,currency:((o=e==null?void 0:e.budget)==null?void 0:o.type)==="spend"?(c=e==null?void 0:e.budget)==null?void 0:c.currency_code:""},components:[t.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus text-lg"},"amount"),t.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus text-lg"},"currency")]})})})]})},ht=()=>{const e=V(),{id:s}=G(),{campaign:r,isLoading:i,isError:o,error:c}=J(s,{fields:"+promotions.id"},{initialData:e});if(i||!r)return t.jsx("div",{children:"Loading..."});if(o)throw c;return t.jsxs("div",{className:"flex flex-col gap-y-2",children:[he.widgets.map((a,n)=>t.jsx("div",{children:t.jsx(a.Component,{data:r})},n)),t.jsxs("div",{className:"flex flex-col gap-x-4 xl:flex-row xl:items-start",children:[t.jsxs("div",{className:"flex w-full flex-col gap-y-3",children:[t.jsx(_e,{campaign:r}),t.jsx(Ne,{campaign:r}),ge.widgets.map((a,n)=>t.jsx("div",{children:t.jsx(a.Component,{data:r})},n)),t.jsx("div",{className:"hidden xl:block",children:t.jsx(N,{data:r})})]}),t.jsxs("div",{className:"mt-2 flex w-full max-w-[100%] flex-col gap-y-2 xl:mt-0 xl:max-w-[400px]",children:[ve.widgets.map((a,n)=>t.jsx("div",{children:t.jsx(a.Component,{data:r})},n)),t.jsx(Se,{campaign:r}),t.jsx(ye,{campaign:r}),je.widgets.map((a,n)=>t.jsx("div",{children:t.jsx(a.Component,{data:r})},n)),t.jsx("div",{className:"xl:hidden",children:t.jsx(N,{data:r})})]})]}),t.jsx(U,{})]})},Te=e=>({queryKey:se.detail(e),queryFn:async()=>re.campaigns.retrieve(e,{fields:"+promotions.id"})}),jt=async({params:e})=>{const s=e.id,r=Te(s);return C.getQueryData(r.queryKey)??await C.fetchQuery(r)};export{ht as Component,jt as loader};
