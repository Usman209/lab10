import{b as N}from"./chunk-3UMDCRM2-NSGJIubw.js";import{a as p,u as _}from"./chunk-RLLZZQKN-CuYY48Je.js";import{u as z,b as S}from"./chunk-C7RYT3S3-DvWl1ixb.js";import{b as k,h as C}from"./chunk-DMYZ6SLX-CvGU_oYL.js";import{w as F,u as w,j as e,H as I,r as j,t as v,T as n,g as E}from"./index-DQ7iaOIo.js";import{t as B}from"./zod-DqtdDTUb.js";import{z as x}from"./index-yuYasa5Y.js";import{B as y}from"./label-DsyTUQgE.js";import{C as M}from"./checkbox-BXdKf1Kl.js";import"./prompt-BKfKBHyN.js";import"./index-CIxKSFC7.js";var T=({selected:a,onSelect:l,location:s})=>{var t,d,o;return e.jsxs("div",{className:E("flex w-full cursor-pointer gap-x-2 rounded-lg border px-2 py-2",{"border-ui-border-interactive ":a}),onClick:()=>l(!a),children:[e.jsx("div",{className:"h-5 w-5",children:e.jsx(M,{onClick:r=>{r.stopPropagation(),l(!a)},checked:a})}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx(n,{size:"small",leading:"compact",weight:"plus",children:s.name}),e.jsx(n,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:[(t=s.address)==null?void 0:t.address_1,(d=s.address)==null?void 0:d.city,(o=s.address)==null?void 0:o.country_code].filter(r=>!!r).join(", ")})]})]})},A=x.object({locations:x.array(x.object({id:x.string(),location_id:x.string(),selected:x.boolean()}))}),b=(a,l)=>({locations:a.map(s=>({...s,location_id:s.id,selected:l.has(s.id)}))}),D=({item:a,locations:l})=>{const s=j.useMemo(()=>{var i;return new Set(((i=a.location_levels)==null?void 0:i.map(u=>u.location_id))??[])},a.location_levels),{t}=w(),{handleSuccess:d}=_(),o=z({defaultValues:b(l,s),resolver:B(A)}),{fields:r,update:h}=S({control:o.control,name:"locations"});j.useEffect(()=>{o.setValue("locations",b(l,s).locations)},[s,l]);const{mutateAsync:f}=C(a.id),L=o.handleSubmit(async({locations:i})=>{const[u,g]=i.reduce((c,m)=>(!m.selected&&!s.has(m.location_id)||m.selected&&s.has(m.location_id)||(m.selected?c[0].push(m.location_id):c[1].push(m.location_id)),c),[[],[]]);if(u.length===0&&g.length===0)return d();await f({create:u.map(c=>({location_id:c})),delete:g},{onSuccess:()=>{v.success(t("inventory.toast.updateLocations")),d()},onError:c=>{v.error(c.message)}})});return e.jsx(p.Form,{form:o,children:e.jsxs("form",{onSubmit:L,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(p.Body,{className:"flex flex-1 flex-col gap-y-4 overflow-auto",children:[e.jsxs("div",{className:"text-ui-fg-subtle shadow-elevation-card-rest grid grid-rows-2 divide-y rounded-lg border",children:[e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(n,{className:"px-2 py-1.5",size:"small",leading:"compact",children:t("fields.title")}),e.jsx(n,{className:"px-2 py-1.5",size:"small",leading:"compact",children:a.title??"-"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx(n,{className:"px-2 py-1.5",size:"small",leading:"compact",children:t("fields.sku")}),e.jsx(n,{className:"px-2 py-1.5",size:"small",leading:"compact",children:a.sku})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(n,{size:"small",weight:"plus",leading:"compact",children:t("locations.domain")}),e.jsxs("div",{className:"text-ui-fg-subtle flex w-full justify-between",children:[e.jsx(n,{size:"small",leading:"compact",children:t("locations.selectLocations")}),e.jsxs(n,{size:"small",leading:"compact",children:["(",t("general.countOfTotalSelected",{count:r.filter(i=>i.selected).length,total:l.length}),")"]})]})]}),r.map((i,u)=>e.jsx(T,{selected:i.selected,location:i,onSelect:()=>h(u,{...i,selected:!i.selected})},i.id))]}),e.jsx(p.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(p.Close,{asChild:!0,children:e.jsx(y,{variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(y,{type:"submit",size:"small",isLoading:!1,children:t("actions.save")})]})})]})})},Q=()=>{const{id:a}=F(),{t:l}=w(),{inventory_item:s,isPending:t,isError:d,error:o}=k(a),{stock_locations:r,isLoading:h}=N(),f=!t&&!h&&s&&r;if(d)throw o;return e.jsxs(p,{children:[e.jsx(p.Header,{children:e.jsx(I,{children:l("inventory.manageLocations")})}),f&&e.jsx(D,{item:s,locations:r})]})};export{Q as Component};
